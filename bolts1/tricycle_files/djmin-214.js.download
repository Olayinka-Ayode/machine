YAHOO.widget.Uploader.SWFURL="/images/uploader.swf";var gebi=function(c,b){var a=typeof(c);if(a=="string"){if(!b){b=document}return b.getElementById(c)}else{if(a=="object"){return c}else{return null}}},html2el=function(c){var d=djp.dce("div");d.innerHTML=c;var b=[];for(var a=0;a<d.childNodes.length;a++){b.push(d.childNodes[a])}b.each(function(){d.removeChild(this)});d=null;return b},collection2array=function(e){var b=[];for(var d=0;d<e.length;d++){b.push(e[d])}return b};Dom=YAHOO.util.Dom;Ev=YAHOO.util.Event;var sc=function(a,b){if(typeof(a)=="string"){a=gebi(a)}if(a){a.className=b}};var rsc=function(c,b,a){Dom.replaceClass(c,b,a)};var fsc=function(c,b,a){c=gebi(c);if(!c){return}if(!Dom.hasClass(c,b)){Dom.replaceClass(c,a,b)}else{Dom.replaceClass(c,b,a)}};if(typeof(Array.prototype.in_array)=="undefined"){Array.prototype.in_array=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}}}if(typeof(Array.prototype.each)=="undefined"){Array.prototype.each=function(d,a){var c,b;for(c=0;c<this.length;c++){b=d.call(typeof(this[c])=="string"?{value:this[c]}:this[c],c,a);if(b===false){break}}}}if(typeof(Array.prototype.indexOf)=="undefined"){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return false}}if(typeof(Array.prototype.remove)=="undefined"){Array.prototype.remove=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1)}}}}if(typeof(Array.prototype.clone)=="undefined"){Array.prototype.clone=function(){var a=[];for(var b=0;b<this.length;b++){if(typeof(this[b])=="object"&&this[b].clone!==undefined){a[b]=this[b].clone()}else{a[b]=this[b]}}return a}}var DJIChange=function(){};DJIChange.prototype={_ichange_haschanges:0,haschanges:function(a){if(a){this._ichange_haschanges=1}else{return this._ichange_haschanges}},valchanged:function(){if(typeof(this.onvalchanged)=="function"){this.onvalchanged()}if(!this.haschanges()){this.haschanges(true)}},onvalchanged:null,setnochanges:function(){this._ichange_haschanges=0}};var DJIDBUpdate=function(){};DJIDBUpdate.prototype={from_xml:function(){djp.status("Override from_xml() in "+this)},getDBUrl:function(){djp.status("Override getDBUrl() in "+this)},getDBXml:function(){djp.status("Override getDBXml() in "+this)},updateFromDB:function(d,b){var c=this,a=c.getDBUrl();c.updatedFromDB=false;if(a){djp.ajax.grab(a,{success:function(h){var g=h.argument[0],e=g.getDBXml(h.responseXML);g.updatedFromDB=true;if(g&&e){g.from_xml(e)}if(typeof(h.argument[1])=="function"){h.argument[1].call(g,h.argument[2])}},argument:[c,d,b]});return true}return false}};var DJIHaveUser=function(){};DJIHaveUser.prototype={_djuser:null,userLoaded:function(a){if(a&&typeof(a)=="object"){this._djuser=a}else{return this._djuser!=null}},getUserId:function(){djp.status("Override getUserId in "+this)},getUser:function(){return(this.userLoaded()?this._djuser:null)},loadUser:function(g,b,j){var e=this,h=function(k){k[0].userLoaded(this);djp.cache[c]=this;if(typeof(k[1])=="function"){k[1].call(this,k[2])}},d=[e,g,b];if(!e.userLoaded()){if(!j){j=e.getUserId()}if(j){var c="user-"+j;if(djp.cache[c]){var a=djp.cache[c];h.call(a,d)}else{var a=new DJUser({id:j});a.updatefromdb(h,d)}}}else{h.call(e.getUser(),d)}}};var DJGeoCity=function(){this.o={}};DJGeoCity.prototype={fromXML:function(a){if(!a||typeof(a)!="object"){return false}djp.clonecopy(this.o,{longitude:parseFloat(a.getAttribute("long")),latitude:parseFloat(a.getAttribute("lat")),id:parseInt(a.getAttribute("id")),name:djp.get_xmlnodeval(djp.gebtn(a,"name")[0],1),state:djp.get_xmlnodeval(djp.gebtn(a,"state")[0],1),countryCode:djp.get_xmlnodeval(djp.gebtn(a,"cc")[0],1)},1);return true},toString:function(){var a=this.o;return a.name+(a.state?", "+a.state:"")+", "+a.countryCode}};var DJPanel=function(b,a){if(!a.zIndex){a.zIndex=11}DJPanel.superclass.constructor.call(this,b,a);this.afterShowEvent=new YAHOO.util.CustomEvent("after-show",this,1,YAHOO.util.CustomEvent.FLAT);this.afterShowEvent.subscribe(this.afterShow);this.afterHideEvent=new YAHOO.util.CustomEvent("after-hide",this,1,YAHOO.util.CustomEvent.FLAT)};YAHOO.lang.extend(DJPanel,YAHOO.widget.Panel,{afterShow:function(a){a.center()},show:function(){var a=this;if(djp.has_fade_problem()&&a.cfg.getProperty("modal")){a.panel_scroll_top=Dom.getDocumentScrollTop();if(a.panel_scroll_top){window.scroll(Dom.getDocumentScrollLeft(),0)}}if(YAHOO.env.ua.gecko){Dom.setStyle(a.body,"display","none");setTimeout(function(){DJPanel.superclass.show.call(a);Dom.setStyle(a.body,"display","block");a.afterShowEvent.fire(a)},0)}else{DJPanel.superclass.show.call(a);a.afterShowEvent.fire(a)}},hide:function(){if(YAHOO.env.ua.gecko){Dom.setStyle(this.body,"display","none")}DJPanel.superclass.hide.call(this);this.afterHideEvent.fire(this);if(djp.has_fade_problem()&&this.panel_scroll_top){window.scroll(Dom.getDocumentScrollLeft(),this.panel_scroll_top)}},render:function(a){DJPanel.superclass.render.call(this,a);if(YAHOO.env.ua.gecko){Dom.addClass(this.body,"caretfix")}}});var IPopupEl=function(){};IPopupEl.prototype={getEl:function(){djp.status("Override getEl function")},showPPDelay:function(a){if(a===undefined){return(typeof(this._pp_show_delay)=="number"?this._pp_show_delay:200)}else{a=parseInt(a);if(!isNaN(a)){this._pp_show_delay=a}}},hidePPDelay:function(a){if(a===undefined){return(typeof(this._pp_hide_delay)=="number"?this._pp_hide_delay:200)}else{a=parseInt(a);if(!isNaN(a)){this._pp_hide_delay=a}}},relativePPEl:function(){return this.tt_src},initPP:function(){var b=this;b._pp_htimer=b._pp_stimer=b._pp_showing=0,el=b.getEl();var a=Ev;a.on(el,"mouseover",function(c){b.showPP(c)});a.on(el,"mouseout",function(){b.hidePP()});Dom.setStyle(el,"position","absolute")},showPP:function(c,a){var b=this;if(b._pp_htimer){clearTimeout(b._pp_htimer);b._pp_htimer=0}if(!b._pp_showing&&!b._pp_stimer){b._pp_stimer=setTimeout(function(){b.afterShowPP(true);b._pp_showing=1},b.showPPDelay())}else{if(b._pp_showing){b.afterShowPP(true)}}},hidePP:function(){var a=this;if(a._pp_stimer){clearTimeout(a._pp_stimer);a._pp_stimer=0}if(!a._pp_htimer){a._pp_htimer=setTimeout(function(){a.afterHidePP();a._pp_showing=0},a.hidePPDelay())}},getPPDest:function(){var b=this,a=this.relativePPEl();uc=Dom.getXY(a),vp=Dom.getDocumentScrollLeft()+Dom.getViewportWidth(),dims=[Dom.getRegion(b.getEl()),Dom.getRegion(a)],elh=dims[1].bottom-dims[1].top,pph=dims[0].bottom-dims[0].top;uc[0]=Math.max(0,Math.min(uc[0],vp-(dims[0].right-dims[0].left)));uc[1]+=(uc[1]+elh+pph<Dom.getDocumentScrollTop()+Dom.getViewportHeight()?elh:-pph);return uc},afterHidePP:function(){Dom.replaceClass(this.getEl(),"vis","invis")},afterShowPP:function(b){var a=this.getEl();if(Dom.hasClass(a,"invis")){Dom.replaceClass(a,"invis","vis")}if(b===true){b=this.getPPDest()}if(b){Dom.setXY(a,b)}},isShowingPP:function(){return Dom.hasClass(this.getEl,"vis")}};var DJSimplePPPanel=function(c,a){if(!a){a={}}var d=this,b;if(typeof(c)=="string"){b=djp.dce("div");b.id=c}else{b=c}DJSimplePPPanel.superclass.constructor.call(d,b,a);d.appendTo(djp.loadtgt());var c=d.getEl();Dom.setStyle(c,"zIndex","1005");Dom.addClass(c,"invis");if(a.contents){if(typeof(a.contents)=="object"){c.innerHTML="";var b=a.contents;if(b.parentNode){b.parentNode.removeChild(b)}c.appendChild(b)}else{c.innerHTML=a.contents}}if(a.ppShowDelay){d.showPPDelay(a.ppShowDelay)}if(a.ppHideDelay){d.hidePPDelay(a.ppHideDelay)}d.initPP()};YAHOO.lang.extend(DJSimplePPPanel,YAHOO.util.Element,{getEl:function(){return this.get("element")},afterHidePP:function(){IPopupEl.prototype.afterHidePP.call(this);if(YAHOO.env.ua.ie==6){sc(this._ie_frame,"invis")}},afterShowPP:function(e){IPopupEl.prototype.afterShowPP.call(this,e);if(YAHOO.env.ua.ie==6){if(!this._ie_frame){var d=this._ie_frame=djp.dce("iframe");djp.loadtgt().appendChild(d);d.src="/images/djlogo-small.gif";Dom.setStyle(d,"zIndex","999");Dom.setStyle(d,"position","absolute")}var a=this.getEl(),d=this._ie_frame,b=Dom.getRegion(a),c=Dom.getXY(a);if(d&&b&&c){Dom.setStyle(d,"width",(b.right-b.left)+"px");Dom.setStyle(d,"height",(b.bottom-b.top)+"px");Dom.setXY(d,c);sc(d,"vis")}}}});YAHOO.lang.augment(DJSimplePPPanel,IPopupEl);var DJImgDetailsPanel=function(a,d){if(!d){d={}}var c=this,b;c.image=a;DJImgDetailsPanel.superclass.constructor.call(c,"djimgdetailspopup"+a.id,d);b=c.getEl();Dom.addClass(b,"imgdetailsppp invrs");Dom.setStyle(b,"opacity",0.8);Dom.setStyle(b,"width",d.src_el.clientWidth+"px")};YAHOO.lang.extend(DJImgDetailsPanel,DJSimplePPPanel,{getPPDest:function(){var c=this,b=Dom.getXY(c.tt_src),a=Dom.getDocumentScrollLeft()+Dom.getViewportWidth(),d=[Dom.getRegion(c.getEl()),Dom.getRegion(c.tt_src)];b[0]=Math.max(0,Math.min(b[0],a-(d[0].right-d[0].left)));b[1]+=(d[1].bottom-d[1].top)-(d[0].bottom-d[0].top);return b}});var DJPPPanel=function(d,a){var b=this;var c={width:"320px",fixedcenter:false,constraintoviewport:true,modal:false,underlay:"none",visible:false,draggable:true,close:true};djp.clonecopy(c,a,1);DJPPPanel.superclass.constructor.call(b,d,c);b.afterShowEvent.unsubscribe(b.afterShow);b.setBody("")};YAHOO.lang.extend(DJPPPanel,DJPanel,{getEl:function(){var a=this;if(!a.has_rendered){a.render(djp.loadtgt());a.has_rendered=1}return a.element},afterHidePP:function(){this.hide()},afterShowPP:function(b){var a=this;if(!a._pp_showing){a.show()}IPopupEl.prototype.afterShowPP.call(a,b)}});YAHOO.lang.augment(DJPPPanel,IPopupEl);var DJTopicPanel=function(c,b){var a=this;a.topic=new DJTopic(c);a.source_element=b;DJTopicPanel.superclass.constructor.call(a,"djtopicpopup"+djp.rndint(),{width:"400px"});a.hidePPDelay(500);a.showPPDelay(1000);a.setHeader("Topic");a.afterShowEvent.subscribe(function(){if(this.source_element){this.bringToTop()}else{this.hidePP()}});a.reload()};YAHOO.lang.extend(DJTopicPanel,DJPPPanel,{reload:function(){var a=this;a.topic.updateFromDB(function(){a.layout()})},layout:function(){var a=this,b;a.setBody(a.topic.to_html());b=djp.gebtn(a.body,"form")[0];if(b){b.afterSaveFn=function(){a.reload()}}}});var DJHelpPanel=function(c){var b=this;b.help_id=c;DJHelpPanel.superclass.constructor.call(b,"djhelppopup"+djp.rndint(),{width:"380px"});b.setHeader("Help"+(djp.user.is_admin()?' - <a href="" onclick="return false;">Edit</a>':""));b.hidePPDelay(400);var a=b.header.lastChild;if(typeof(a)=="object"&&a.tagName){a.panel=b;a.onclick=function(){var d=this.panel,e=function(){if(!this.hlpedt){djp.load_js(djp.jsfiles.HelpEditor,"HelpEditor",this,function(g){if(g){this.hlpedt=g;g.show()}else{djp.error("Could not load Help Editor")}})}else{this.hlpedt.show()}};if(!d.help_loaded){d.afterHelpLoaded=e}else{e.call(d)}return false}}b.afterShowEvent.subscribe(function(){this.makefit();this.bringToTop()});b.update()};YAHOO.lang.extend(DJHelpPanel,DJPPPanel,{update:function(){var a=this;a.setBody(djp.loading_text());djp.getinfo("page","help",{vals:{help_id:a.help_id},panel:a,quiet:1,onAfterFail:function(b){b.argument[0].onAfterSave(b)},onAfterSave:function(d){var c=djp.gebtn(d.responseXML,"helpdata"),b=d.argument[0].panel;b.help_loaded=1;b.help_title="";b.help_txt="";if(c.length){b.help_title=djp.get_xmlnodeval(djp.gebtn(c[0],"title")[0],1);b.help_txt=djp.get_xmlnodeval(djp.gebtn(c[0],"txt")[0],1);if(typeof(b.afterHelpLoaded)=="function"){b.afterHelpLoaded()}}b.setBody('<div style="height:;overflow:;">'+d.smsg+"</div>");b.makefit()}})},makefit:function(){var b=this,c=Dom.getRegion(b.getEl());if(c&&(c.bottom-c.top)>250){var a=b.body.style;a.height="200px";a.overflow="auto"}}});var DJImgPanel=function(c){var b=this;DJImgPanel.superclass.constructor.call(b,"djimgpopup"+djp.rndint(),{width:"180px"});b.setHeader("Image Preview");b.setBody(djp.loading_text());b.img=new DJImage();var a=b.img;a.id=c;a.updatefromdb(function(d){d.setBody(a.to_html({l:"alignable",align:"center",nozoom:1,pw:[150,150]}));d.afterShowEvent.subscribe(function(){var g=d.cfg.getProperty("xy");var e=d.getConstrainedXY(g[0],g[1]);d.moveTo(e[0],e[1])})},b)};YAHOO.lang.extend(DJImgPanel,DJPPPanel,{});var DJMetaDepPanel=function(b){var a=this;if(!b){b={}}a.options=b;DJMetaDepPanel.superclass.constructor.call(a,"djmetadeppp"+djp.rndint(),djp.clonecopy(b));Dom.addClass(a.getEl(),"metadepartmentpp")};YAHOO.lang.extend(DJMetaDepPanel,DJSimplePPPanel,{afterShowPP:function(){var a=this;if(!a.loading_data){a.loading_data=true;djp.getinfo("page","metadepartmentpopup",{quiet:true,vals:{rnd:djp.rndint(),meta_department:a.options.meta_department||"",department:a.options.department||""},onAfterSave:function(g){var d=a.getEl();d.innerHTML=g.smsg;var e=Dom.getElementsByClassName("preview","div",d),c=[];for(var b=0;b<e.length;b++){c.push(e[b].id)}djp.sched_load_alb_imgs(c);$(".sub-departments a.department",d).click(function(h){h.preventDefault();ga("send","event","category","subclick",$(h.target).text());djp.gotourl(this.href)});$('[data-type="article-link"]',d).click(function(h){h.preventDefault();ga("send","event","category","link",$(this).text());djp.gotourl(this.href)})}})}DJMetaDepPanel.superclass.afterShowPP.apply(a,arguments)}});var DJUsrPanel=function(c){if(!c){c={}}var m=this,j=parseInt(c.uid),h="",u=c.u,s=(djp.user.is_loggedin()&&djp.user.get_id()==j);c.pg=c.pg||(s?djp.user.cfg.perms_grp:0);djp.console("User Panel",s,j,u);if(j&&u){var n={Articles:"news","Contact me":["","djp.set_cookie('popup_contact',1);djp.gotourl(this.href);return false"]},t={Articles:{icon:"/images/article.gif",action:{href:"/user/action/article_add",title:"Post"}},Images:{icon:"/images/image.gif",action:{onclick:"var b=new DJImage();b.upload();return false;",title:"Upload"}},Events:{icon:"/images/events.gif"},"Contact me":{icon:"/images/letter.gif"}},r=["",""];if(!c.pg||c.pg==1){delete t.Articles;delete t.Images}for(var g in t){var b=g,d=t[g],q=((n[b]&&typeof(n[b])!="string")?n[b][1]:null);b=n[b]?(q?n[b][0]:n[b]):b.toLowerCase(),action=(s&&d.action?'<a class=action href="'+d.action.href+'" onclick="'+d.action.onclick+'">'+d.action.title+"</a>":"");r[0]+='<div class="upp-lnk"'+(s?' style="width:110px;"':"")+">"+action+(d.icon?'<img src="'+d.icon+'" align=absmiddle borer=0 />':"&bull;")+' <a href="/user/'+j+(b?"/"+b:"")+'"'+(q?' onclick="'+q+'"':"")+">"+g+"</a></div>"}if(s){var t={edit:"Settings",alerts:"Alerts",subscriptions:"Subscriptions"};if(djp.user.is_admin()){t.tools="Tools"}else{if(djp.user.is_cj()){t.money="Money"}}if(s){t.logout={lbl:"Log Out",onclick:"djp.user.logout('user');return false;"}}for(var g in t){var a="",v="",k="",e=t[g];if(typeof(e)=="string"){a="/user/"+j+"/"+g;k=e}else{v=' onclick="'+e.onclick+'"';k=e.lbl}r[1]+='<div class="upp-lnk">&bull;<img align=absmiddle src="/images/tr.gif" border="0" height=16 width=1 /> <a href="'+a+'"'+v+">"+k+"</a></div>"}}if(djp.user.is_admin()){r[0]+='<div class="upp-lnk"><img src="/images/tr.gif" align=absmiddle width=1 height=16 border=0 />id: <a href="" onclick="djp.editobj(\'user\',\'impersonate\','+j+',{ onAfterSave:function(){ djp.gotourl(\'reload\');}});return false;" title="impersonate">'+j+"</a></div>"}h='<table width="'+(c.width?(c.width+"").replace(/[^0-9]/,""):"220")+'" border=0 cellpadding=5 cellspacing=0 ><tr valign=top><td>'+r[0]+"</td>"+(r[1]?"<td>"+r[1]+"</td>":"")+"</tr></table>"}DJUsrPanel.superclass.constructor.call(m,"djusrpopup"+djp.rndint(),djp.clonecopy(c,{contents:h}));Dom.addClass(m.getEl(),"usrppp")};YAHOO.lang.extend(DJUsrPanel,DJSimplePPPanel);var DJContactPanel=function(b,d){if(!d){d={}}if(d.contact_id){d.contact_id=parseInt(d.contact_id)}if(isNaN(d.contact_id)){d.contact_id=0}DJContactPanel.superclass.constructor.call(this,"djcontactpopup-"+b+"_"+djp.rndint(),d);var c=this.getEl();Dom.addClass(c,"contactpp");c.contactPPPanel=this;var a=d.contact;if(!a){a=djp.cache.contacts[d.contact_id]}if(a){this.contact(a);this.update()}else{djp.load_js(djp.jsfiles.ContactManager,"DJContact",{panel:this,id:d.contact_id},function(e){this.panel.contact(e);e.data.id=this.id;this.panel.update()})}};YAHOO.lang.extend(DJContactPanel,DJSimplePPPanel,{contact:function(a){if(a===undefined){return this._cont}else{this._cont=a}},update:function(){var a=this.getEl(),d=this.contact(),b=function(){djp.cache.contacts[this.data.id]=this;this.contactPanel.getEl().innerHTML=this.toHTML({l:"details"})};d.contactPanel=this;a.innerHTML=djp.loading_text();if(!d.updatedFromDB){d.updateFromDB(b)}else{b.call(d)}}});var DJCal=function(b){if(!b){b={}}var a=this;this.o=b;DJCal.superclass.constructor.call(a,"djcalpanel1",{width:"200px",fixedcenter:true,constraintoviewport:true,modal:true,underlay:"shadow",visible:false,draggable:false,close:true});a.setHeader("Calendar");a.setBody("&nbsp;");a.afterShowEvent.subscribe(function(c,d){var d=c.o;if(d.selected){d.selected=(d.selected.getMonth()+1)+"/"+d.selected.getDate()+"/"+d.selected.getFullYear()}c.body.innerHTML="<div></div>";c.cal=new YAHOO.widget.Calendar("",c.body.lastChild,{selected:(d.selected?d.selected:""),maxdate:(d.nomaxdate?null:new Date()),mindate:(d.mindate?d.mindate:null),navigator:true,start_weekday:1});c.cal.render();c.cal.selectEvent.subscribe(c.onSelect,c);if(!d.afs&&d.afs_args&&d.afs_args[0].tagName.toLowerCase()=="input"){d.afs=function(h,g,e){e[0].value=djp.toMysqlDate(g[0])}}c.afs=d.afs;c.afs_args=d.afs_args},b);a.render(djp.loadtgt());a.show()};YAHOO.lang.extend(DJCal,DJPanel,{onSelect:function(c,a,e){var d=a[0];e.hide();for(var b=0;b<d.length;b++){d[b]=e.cal._toDate(d[b])}var d=a[0];if(e.afs){e.afs(e,d,e.afs_args)}}});var DJDD=function(b,a,c){if(!c){c={}}c.isTarget=false;DJDD.superclass.constructor.call(this,b.get_el(),a,c);this.w=b};YAHOO.lang.extend(DJDD,YAHOO.util.DDProxy,{origZ:0,origXY:[],origColIndex:0,origCol:null,startDrag:function(a,d){var c=this.getEl();var b=c.style;this.origZ=b.zIndex;b.zIndex=999;this.origCol=this.w.column;this.origColIndex=this.w.wcfg.col_index;this.origXY=Dom.getXY(c)},endDrag:function(a){this.getEl().style.zIndex=this.origZ},onDragDrop:function(j,k){var g=Ev;g.stopEvent(j);var h=[g.getPageX(j),g.getPageY(j)];var b=djp.get_w(k.replace(/^.+-m-(.+)$/,"$1"));var c=null;if(!b){c=gebi(k);if(c&&c.djcol){c=c.djcol;b=c.hit(h)}}else{c=b.column}var a=0;if(b){var d=b.hit(h);a=b.wcfg.col_index;if(d[1]<0){a++}}if(c&&this.w.move_to(c,a)&&!c.cfg.nocustom){djp.user.save_wcfg()}},clickValidator:function(b){var a=b.explicitOriginalTarget;if(!a){a=b.srcElement}while(a&&a.className!="yui-module"){if(a.className=="hd"){return true}a=a.parentNode}return(b.explicitOriginalTarget?b.explicitOriginalTarget.className=="hd":0)}});var DJSelImgs=function(c){if(!c){c={}}this.o=c;if(!c.imgs){c.imgs=[]}if(!c.pname){c.pname="sel_imgs_panel"}if(!c.pcfg){c.pcfg={}}if(!c.render_tgt){c.render_tgt=djp.loadtgt()}var b={width:"960px",fixedcenter:true,constraintoviewport:true,modal:true,underlay:"shadow",close:false,visible:false,draggable:false};djp.clonecopy(b,c.pcfg);c.pcfg=b;DJSelImgs.superclass.constructor.call(this,c.pname,c.pcfg);this.current=c.imgs;this.selected=[];this.lim=50;this.kw="";djp.console("pre-render");try{this.render(c.render_tgt)}catch(a){djp.console("error",a,a.stack)}djp.console("post-render");this.afterShowEvent.subscribe(function(d){d.mysrch.q.focus()},this);this.afterShowEvent.subscribe(function(d){if(!d.cur_album){d.myuploads.sel_album()}},this);djp.console("after constructor")};YAHOO.lang.extend(DJSelImgs,DJPanel,{form_url:function(a){if(!a){a="/info/type/app/mypics?suba=imgs&uid="+djp.user.get_id()}return djp.replaceinhref({lim:this.lim,q:this.kw},null,a)},update:function(c){this.current=[];var d=this,b=d.cur_album;if(!c){c=b.dataurl()}d.set_tgt_name(b.name);sc(d.prev_page,(b.cur_page?"vis":"invis"));d.tgt_el.innerHTML=djp.loading_text();djp.ajax.grab(d.form_url(c),{success:function(h){var e=h.argument[0];if(h.responseXML){var m=djp.gebtn(h.responseXML,"djimg");if(m.length){for(var l=0;l<m.length;l++){e.current.push(new DJImage(m[l]))}}sc(e.next_page,((m.length==e.lim)?"vis":"invis"));if(!e.current.length){e.tgt_el.innerHTML='<div style="padding:10px;">No images</div>';e.set_tgt_img(null)}else{e.tgt_el.innerHTML="";var q,a,s=djp.dce("table");s.width=(YAHOO.env.ua.ie?"80%":"100%");s.cellPadding=5;s.cellSpacing=0;var n=(e.current.length?e.current[0]:0);if(e.o.onselect){e.tgt_img_el.innerHTML=""}for(var l=0;l<e.current.length;l++){try{a=s.insertRow(-1);q=a.insertCell(-1);var k=e.current[l];if(l==n||n==k){e.set_tgt_img(k)}var g=k.to_html({onclick:function(t,u){var o=u.img;var r=o.panel;r.selected.push(o);r.set_tgt_img(o)},nozoom:1,cls:"even",pw:[75,75],l:"alignable",align:"center"});k.panel=e;if(g){q.appendChild(g)}}catch(j){djp.error('Error "'+j+'" in image['+k.id+"]")}}e.tgt_el.appendChild(s)}}},failure:function(a){alert("Failed to retrieve images")},argument:[d]})},set_cur_src:function(b){var a=this;if(a.cur_src){Dom.removeClass(a.cur_src,"selected")}a.cur_src=Dom.getAncestorBy(b,function(c){return Dom.hasClass(c,"ss")});Dom.addClass(a.cur_src,"selected")},set_tgt_name:function(b){var a=this;if(!a.name_tgt){return}sc(a.name_tgt,"h3");a.name_tgt.innerHTML=b},_imgfpfunc:function(b,a){a.set_tgt_img(this)},set_tgt_img:function(a){if(this.sel_img){if(this.sel_img.tooltip){this.sel_img.tooltip.destroy()}this.sel_img.focalPointChangedEvent.unsubscribe(DJSelImgs.prototype._imgfpfunc)}this.sel_img=null;if(!a){return}a.focalPointChangedEvent.subscribe(DJSelImgs.prototype._imgfpfunc,this);a.selPanel=this;a.afterUpdateFunc=function(){var c=this,d=c.selPanel;d.sel_img=c;if(d.tgt_img_el){d.tgt_img_el.innerHTML="";if(c){var g=null,b=c.hasFP()||(!c.hasFP()&&!c.uce(djp.user));if(typeof(d.o.onselect)=="function"){g=djp.dce("div");sc(g,"tac p");g.innerHTML="<div class="+(b?"good":"bad")+' style="padding:3px;"><form onsubmit="return false">'+(b?"":"Before adding this image you must set the focal point "+djp.helpstr("focal_point"))+'<input type=submit name=frm_sbmt value="Add this image" class=imp style="padding:5px;" '+(b?"":"disabled")+" /></form></div>";var e=g.firstChild.firstChild;d.sel_frm=e;e.panel=d;e.onsubmit=function(){var l=this.panel;if(l.sel_img){l.selected=[l.sel_img]}var s="";var n=l.selected;if(n.length){if(l.o.picksize){var h=new DJPanel("pick-img-size",{width:"150px",fixedcenter:true,constraintoviewport:true,modal:true,underlay:"shadow",close:false,visible:true,draggable:false});h.setHeader("Pick Image Size");var m="",k=l.o.picksize;var q=function(){var t=this.pargs[0],u=this.pargs[1],v=this.pargs[2];v.destroy();if(u.selected.length&&t){u.o.onselect(u.selected,u.o.args,t)}u.hide();return false};h.setBody("");for(var o in n[0].pw){var r=n[0].pw[o];if(k&&(k<r[0]||k<r[1])){break}var j=djp.dce("div");sc(j,"p even");j.innerHTML='<a href="" onclick="return false"><span class="imp" style="text-transform:capitalize">'+o+"</span> - "+r[0]+"x"+r[1]+"</a>";j.pargs=[o,l,h];j.onclick=q;h.body.appendChild(j);if(n[0].w<r[0]&&n[0].h<r[1]){break}}h.render(djp.loadtgt())}else{l.o.onselect(l.selected,l.o.args);l.hide()}}return false}}d.tgt_img_el.appendChild(c.to_html({abi:g,max_det_height:"375",noclick:1,nozoom:1,show:{fp:1,uploader:1},urlopt:{cachebust:c.djImgCacheBust},pw:[150,150]}));if(c.fpdiv){c.fpdiv.recenter_fp()}}}};a.afterUpdateFunc()},render:function(h){var o=this;o.setHeader('Select an Image - <a href="/user/benefits.php?b=images" target="_blank" style="color:black">View Tutorial</a> <img src="/images/external.gif" border=0 />');o.setBody("");var l=djp.dce("table");l.width="100%";l.cellPadding=0;l.cellSpacing=10;var b=l.insertRow(-1),d="tgt"+djp.rndint(),x=b.insertCell(-1);b.vAlign="top";x.width="200";x.rowSpan=2;x.innerHTML='<div class=ss><table cellpadding=0 cellspacing=0 width="100%"><tr><td><a href="" id="sel_img_uploads" onclick="return false" class="h3 nowrap">My Uploads</a>&nbsp;&nbsp;<input id="sel_img_upload_new" type=submit onclick="return false" value="Upload New" class="fancy-button" /></td></tr></table></div><div class=ss><h4 style="margin:0 0 3px 0">My Albums</h4><div id="sel_img_albs"></div></div><div class="ss"><h4 style="margin-top:0">Search Database</h4><form id="sel_img_srch" onsubmit="return false;"><input type="text" name=q value="" style="width:110px;"/> <input type=submit value="Search" class="fancy-button"/><div class=p>Sort by <input type=radio name=orderby value=latest checked /> Date <input type=radio value="" name=orderby /> Relevance</div><input type=checkbox value=1 name=byuser />Only search in My Uploads</form></div><div style="height:20px"></div>';var m=function(B){var y=B.argument[0];if(!y){y={}}if(!y.tgt){y.tgt="sel_img_albs"}var G=y.selimgs,J=gebi(y.tgt),I=djp.user,C=false;if(!J){return}for(var E in I.albums){C=true;break}if(!C){J.innerHTML="You haven't created any albums yet";return}J.innerHTML="<div></div>";var F=J.firstChild,r=function(){var t=this;if(t.tag){var a=t.parentNode.parentNode.selimgs;a.set_cur_src(t);a.cur_album=t.tag;a.cur_page=0;a.update(t.tag.dataurl(t.tag))}return false},A=0;F.selimgs=G;for(var E in I.albums){var H=I.albums[E],z=H.name,D=djp.dce("div");if(z.length>28){z=z.substring(0,25)+"..."}D.style.padding="2px 0";D.innerHTML='<a class=editfld onclick="return false;" href="">'+z+"</a>";F.appendChild(D);D=D.firstChild;D.tag=H;D.onclick=r;A++}if(A>=5){F.style.height="120px";F.style.overflow="auto"}};x=b.insertCell(-1);x.colSpan=2;o.name_tgt=x;b=l.insertRow(-1);var x=b.insertCell(-1);x.width="110";var v=djp.user;v.update_albums({afs:m,selimgs:o});x.innerHTML='<div id="'+d+'" style="width:110px;height:375px;overflow:auto;"></div>';o.tgt_el=x.firstChild;var n=djp.dce("table");n.width="100%";var s=n.insertRow(-1);var k=s.insertCell(-1);sc(k,"imp");k.width="50%";k.innerHTML='<a class=invis href="">&#x25c4;Back</a>';var q=k.firstChild;q.selimgs=o;q.onclick=function(){if(this.className!="invis"){var a=this.selimgs;a.cur_album.cur_page=Math.max(a.cur_album.cur_page-1,0);a.update(a.cur_album.dataurl())}return false};o.prev_page=q;var k=s.insertCell(-1);k.width="50%";sc(k,"imp tar");k.innerHTML='<a class=invis href="">Next&#x25ba;</a>';var q=k.firstChild;q.selimgs=o;q.onclick=function(){if(this.className!="invis"){var a=this.selimgs;a.cur_album.cur_page++;a.update(a.cur_album.dataurl())}return false};o.next_page=q;x.appendChild(n);var x=b.insertCell(-1);x.width="530";x.vAlign="middle";x.innerHTML='<div><div style="padding:50px;" class="h3"><ul><li>Upload a new image</li><li>Select one from your albums</li><li>Search through our image database</li></ul></div></div>';o.tgt_img_el=x.firstChild;var b=l.insertRow(-1),x=b.insertCell(-1);x.colSpan=3;sc(x,"tar");x.innerHTML='<input type=submit value=Close class="fancy-button" onclick="return false;" />';x.firstChild.panel=o;Ev.addListener(x.firstChild,"click",function(){this.panel.hide()});o.appendToBody(l);DJSelImgs.superclass.render.call(o,h);var j=gebi("sel_img_uploads"),w=gebi("sel_img_srch");o.myuploads=j;o.mysrch=w;j.selimgs=o;w.selimgs=o;var e=function(){var a=this.tag;if(!a){a=new DJAlbum(null,{dataurl:function(){return djp.replaceinhref("p",this.cur_page,"/info/type/app/mypics?uid="+djp.user.get_id()+"&suba=imgs&rndint="+djp.rndint())}});a.name=this.innerHTML;this.selimgs.set_cur_src(this)}this.selimgs.cur_album=a;a.cur_page=0;this.selimgs.update();return false};var g=function(){var t=gebi("sel_img_srch"),a=this.selimgs;a.set_cur_src(this);a.kw=(t.q.value+"").replace(/^\s+|\s+$/g,"");if(a.kw){var r=this.tag;if(!r){r=new DJAlbum(null,{dataurl:function(){return djp.replaceinhref("p",this.cur_page,"/search/?view=xml&mode=images&rndint="+djp.rndint()+(this.cfg.srch_byuser?"&byuser=1":"")+(this.cfg.srch_sort?"&orderby="+this.cfg.srch_sort:""))}});r.name="Search for <i>"+a.kw+"</i>"}if(r){o.cur_page=0;r.cfg.srch_byuser=t.byuser.checked;r.cfg.srch_sort=djp.getRadioVal(t,"orderby");a.cur_album=r;r.cur_page=0;a.update()}}return false};j.sel_album=e;w.sel_album=g;Ev.addListener(j,"click",e);Ev.addListener(w,"submit",g);var c=gebi("sel_img_upload_new");c.selimg=o;Ev.addListener(c,"click",function(){var a=new DJImage();a.upload_panel({selimg:this.selimg});return false})}});var DJSelUsers=function(e){var d=this;if(!e){e={}}d.o=e;if(!e.users){e.users=[]}if(!e.pname){e.pname="sel_users_panel"}if(!e.pcfg){e.pcfg={}}if(!e.render_tgt){e.render_tgt=djp.loadtgt()}d.viewOnly=(e.viewOnly?1:0);var c={width:(d.viewOnly?"300px":"600px"),fixedcenter:true,constraintoviewport:true,modal:true,underlay:"shadow",close:false,visible:false,draggable:false};djp.clonecopy(c,e.pcfg);e.pcfg=c;DJSelUsers.superclass.constructor.call(d,e.pname,e.pcfg);d.current=e.users;d.selected=[];d.skip={};if(e.skip){var b=e.skip.replace(/^,/,"").split(",");for(var a=0;a<b.length;a++){d.skip[b[a]]=1}}d.page=0;d.page_num=0;d.lim=100;d.kw="";d.render(e.render_tgt);d.update_current()};YAHOO.lang.extend(DJSelUsers,DJPanel,{form_url:function(a){if(!a){a="/info/type/user/all"}return djp.replaceinhref({lim:this.lim,page:this.page,q:this.kw},null,a)},userToHTML:function(a,b){return a.to_html({l:"to",cls:"even",opt:b})},update_current:function(){this.current=[];var a=djp.handlers;this.tgt_cur.innerHTML=djp.loading_text();djp.ajax.grab(this.form_url(),{success:a.successEO,failure:a.failedEO,argument:[{quiet:1,panel:this,onAfterFail:function(b){b.argument[0].panel.tgt_cur.innerHTML=("Failed to retrieve users")},onAfterSave:function(e){var c=e.argument[0].panel,r=c.form,m;if(e.sxml){m=djp.parse_paging(djp.get_xmlnode(e.sxml,"Paging"))||{num_p:0,p:0,num:0,lim:0};r.b_n.disabled=(m.num_p<=m.p+1);r.b_p.disabled=(m.p==0);var g=djp.gebtn(r,"label");if(g.length){g[0].innerHTML=(m.p+1)+"/"+m.num_p}var b=djp.gebtn(e.sxml,"usr");if(b.length){for(var j=0;j<b.length;j++){var t=new DJUser({xml:b[j]});t.count=b[j].getAttribute("count");if(!c.skip[t.id]){c.current.push(t)}}}}c.tgt_cur.innerHTML="";if(c.current.length){for(var j=0;j<c.current.length;j++){var d=0,t=c.current[j];if(c.viewOnly){var v=[],n=c.user_options;if(n&&n.length){for(var h=0;h<n.length;h++){var s=djp.dce("span");s.innerHTML=n[h];v.push(s)}}if(t.count&&t.count!="1"){var s=djp.dce("span");s.innerHTML=t.count;v.push(s)}d=c.userToHTML(t,v)}else{var q=djp.dce("a");q.panel=c;q.user=c.current[j];q.href="";q.innerHTML="add&#187;";d=t.to_html({l:"to",cls:"even",opt:[q]});q.el=d;q.onclick=function(){var k=this,o=k.panel,l=o.selected;l.remove(k.user);l.push(k.user);o.update_selected();return false}}c.tgt_cur.appendChild(d)}}else{c.tgt_cur.innerHTML='<div style="padding:5px" class=nimp>'+(c.o.emptytxt?c.o.emptytxt:"Nobody")+"</div>"}}}]})},update_selected:function(){var d=this;d.tgt_sel.innerHTML="";for(var c=0;c<d.selected.length;c++){var b=djp.dce("a");b.panel=d;b.user=d.selected[c];b.onclick=function(){this.panel.selected.remove(b.user);this.el.parentNode.removeChild(this.el);this.panel.update_selected();return false};b.href="";b.innerHTML="remove&#187";b.el=d.selected[c].to_html({cls:"even",l:"to",opt:[b]});d.tgt_sel.appendChild(b.el)}},render:function(j){var a,g,d=this,b="",c='<td width="50%" style="padding-right:5px;"><div class="imp" style="padding-bottom:5px;">',h='</div><div class="even selusr"></div></td>';d.setHeader("");d.setBody("");if(!d.viewOnly){b+=c+"Users"+h+c+"Selected Users"+h}else{b+='<td><div class="even selusr"></div></td>'}b='<table cellpadding=0 cellspacing=0 border=0 width="100%"><tr>'+b+"</tr></table>";if(d.o.bodytxt){b='<div style="padding-bottom:5px;" class=small>'+d.o.bodytxt+"</div>"+b}b+='<table cellpadding=0 width="100%" cellspacing=0 border=0 style="padding-top:2px;" ><tr><td><button disabled name="b_p" onclick="var p=this.form.panel;p.page--;p.update_current();return false;" class="fancy">&lt;</button>&nbsp;<label></label>&nbsp;<button disabled name="b_n" onclick="var p=this.form.panel;p.page++;p.update_current();return false;" class="fancy">&gt;</button></td><td class=tar>'+(d.viewOnly?"":'<button onclick="var p=this.form.panel;if (p.selected.length && p.o.onselect)p.o.onselect(p.selected); return false;" class="fancy">Ok</button> &nbsp; ')+'<button onclick="var p=this.form.panel; p.hide();p.destroy();return false;" class="fancy">'+(d.viewOnly?"Close":"Cancel")+"</button></td></tr></table>";b="<form>"+b+"</form>";d.setBody(b);DJSelUsers.superclass.render.call(d,j);g=d.body.firstChild;g.panel=d;d.form=g;a=Dom.getElementsByClassName("selusr","div",g);if(a.length){d.tgt_cur=a[0]}if(a.length>1){d.tgt_sel=a[1]}}});var DJSelGrpUsers=function(a){if(!a){a={}}this.group_id=parseInt(a.gid);if(isNaN(this.group_id)){this.group_id=0}DJSelGrpUsers.superclass.constructor.call(this,a)};YAHOO.lang.extend(DJSelGrpUsers,DJSelUsers,{form_url:function(a){return djp.replaceinhref("gid",this.group_id,DJSelGrpUsers.superclass.form_url.call(this,a))}});var DJSelCustomUsers=function(a,b){this.custom_url=a;DJSelCustomUsers.superclass.constructor.call(this,b)};YAHOO.lang.extend(DJSelCustomUsers,DJSelUsers,{form_url:function(){return DJSelCustomUsers.superclass.form_url.call(this,this.custom_url)}});var DJBlockedUsers=function(a){if(!a){a={}}if(!a.pcfg){a.pcfg={}}a.pcfg.width="400px";a.viewOnly=1;a.emptytxt="You are not blocking anyone";DJBlockedUsers.superclass.constructor.call(this,"/info/type/user/blocked",a)};YAHOO.lang.extend(DJBlockedUsers,DJSelCustomUsers,{preBlockStr:["not blocking","blocking"],blockStr:["block","unblock"],userToHTML:function(u,o){var dd=djp.dce("span"),pre=djp.dce("span"),d=djp.dce("a"),bs=this.blockStr,pbs=this.preBlockStr;d.href="";sc(d,"userlink imp");eval("d.onclick = function() {var u=this.currUser,val=(this.innerHTML!='"+bs[0]+"'),blockedTgt=this;djp.user.block("+u.xmlatt.blocktype+",u.id,val,function(o){ var blocked=blockedTgt.innerHTML=='"+bs[1]+"';blockedTgt.previousSibling.innerHTML=(blocked?'"+pbs[0]+"':'"+pbs[1]+"')+', ';blockedTgt.innerHTML=(blocked?'"+bs[0]+"':'"+bs[1]+"'); });return false;}");d.currUser=u;d.innerHTML=bs[1];pre.innerHTML=pbs[1]+", ";dd.appendChild(pre);dd.appendChild(d);o.unshift(dd);d=djp.dce("span");sc(d,"small");d.innerHTML=u.xmlatt.blocktypeStr;o.unshift(d);return DJBlockedUsers.superclass.userToHTML.call(this,u,o)}});var DJUser=function(a){if(!a){a={}}this.init(a);if(a.xml){this.from_xml(a.xml)}};DJUser.prototype={toString:function(){return"User["+this.id+", "+this.name+"]"},types:{c:1,cj:5,staff:3},init:function(a){this.id=(a.id?a.id:0);this.t=this.types.c;this.name="";this.avatar_ext=""},getDBUrl:function(){if(this.id){return"/info/type/user/xml?data="+this.id+"&rndint"+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"usr")},updatefromdb:function(b,a){this.updateFromDB(b,a)},from_xml:function(c){var e=this,d,b;e.xmlatt={};if(c){e.id=parseInt(c.getAttribute("id"));e.t=parseInt(c.getAttribute("t"));e.avatar_ext=c.getAttribute("avatar");e.name=djp.get_xmlnodeval(djp.get_xmlnode(c,"name"),1);for(d=0;d<c.attributes.length;d++){b=c.attributes[d];e.xmlatt[b.name]=b.value}}},to_html:function(d){if(!d){d={}}var k=this,v="",n=djp.dce;var h=djp.clone(d,1);switch(d.l){case"to":var q=n("table");q.width="100%";var b=q.insertRow(-1);var j=b.insertCell(-1);h.l="avatar";delete h.cls;j.appendChild(k.to_html(h));j=b.insertCell(-1);sc(j,"tar small");if(d.opt&&d.opt.length){for(var g=0;g<d.opt.length;g++){if(g){j.appendChild(djp.dct(" - "))}var u=d.opt[g];if(typeof(u)=="object"){u.currentUser=k}j.appendChild(u)}}if(d.cls){sc(q,d.cls)}return q;case"avatar":h.l="";if(k.avatar_ext){var m=n("span");var e=n("img");e.src="/images/avatars/small-"+k.id+"."+k.avatar_ext;e.style.paddingRight="5px";e.align="absmiddle";e.border=0;m.appendChild(e);m.appendChild(k.to_html(h));if(d.cls){sc(m,d.cls)}return m}else{return k.to_html(h)}break;default:var m=n("span");m.innerHTML='<a class="ut ut-'+k.t+'">&#x25a0;</a> '+(k.id?'<a href="/user/'+k.id+'">'+k.name+"</a>":"Visitor");var l=m.lastChild;Ev.on(l,"mouseover",function(a){djp.user.tt(this,a)});if(d.cls){sc(l,d.cls)}return m}}};YAHOO.lang.augmentProto(DJUser,DJIDBUpdate);var DJGroup=function(a,b){this.from_xml(a,b)};DJGroup.prototype={toString:function(){var a=this;return'<img src="/images/group.gif" border=0 align=absmiddle title="Group" /> <a href="'+a.url()+'">'+a.n+"</a>"},url:function(){return"/group/"+this.id},_join:function(e,d,b){if(!d){d=djp.user}if(d&&d.is_loggedin()){if(!b){b="join"}var c={quiet:1,onAfterSave:function(){djp.reload()}};c.onAfterFail=c.onAfterSave;djp.editobj("userset",b,e,c)}},_leave:function(b,a){if(!confirm("Are you sure you want to leave this Group?")){return}else{return DJGroup.prototype._join(b,a,"leave")}},_change_img:function(b){if(!b||!b.tgt||!b.gid){return}var a=b.tgt.selimgs;if(!a){a=new DJSelImgs({onselect:function(e,c){var d=c[0];d.onAfterSave=function(g){djp.gotourl("reload")};djp.editobj("userset","img",d.gid,{vals:{imgid:e[0].id},handlers:{argument:[d,e[0]]}})},args:[b]})}a.show()},from_xml:function(b,a){var c=this;if(!b){return}c.id=parseInt(b.getAttribute("id"));c.uid=parseInt(b.getAttribute("uid"));c.tid=parseInt(b.getAttribute("tid"));c.nm=parseInt(b.getAttribute("nm"));c.nb=parseInt(b.getAttribute("nb"));c.albid=parseInt(b.getAttribute("albid"));c.du=(b.getAttribute("du"));c.dc=(b.getAttribute("dc"));c.n=djp.get_xmlnodeval(djp.gebtn(b,"name")[0],1);c.e=djp.get_xmlnodeval(djp.gebtn(b,"email")[0],1);c.w=djp.get_xmlnodeval(djp.gebtn(b,"website")[0],1);c.d=djp.get_xmlnodeval(djp.gebtn(b,"descr")[0],1);c.kw=djp.get_xmlnodeval(djp.gebtn(b,"kw")[0],1)},get_img:function(c,a){var b=this;if(b.imgid){b.img=new DJImage();b.img.id=Math.abs(b.imgid);b.img.group=b;b.img.updatefromdb(c,a)}},getDBUrl:function(){if(this.id){return"/info/type/userset/"+this.id+"?rndint"+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"userset")},updatefromdb:function(b,a){this.updateFromDB(b,a)},close:function(a){if(!a){a=this}if(confirm("Are you sure that you would like to permanently close this group?\n\nMembers and administrators disbanded, group database record deleted.")){djp.editobj("userset","close",a.id,{onAfterSave:function(){djp.gotourl("/w/groups")}})}},edit:function(e){if(!djp.user.is_loggedin()){return djp.gotourl("/user/benefits.php?b=groups")}if(!e){e=this}if(e.create_panel){e.create_panel.destroy()}var b=new DJPanel("create_new_group",{width:"480px",fixedcenter:true,visible:false,constraintoviewport:true,close:false});b.setHeader(e.id?"Group Details":"Create New Group");var n=djp.dce;var h=n("form");h.method="post";h.panel=b;var o=n("table");o.width="100%",o.style.paddingTop="10px";o.cellPadding=5;o.cellSpacing=0;var a=o.insertRow(-1);sc(a,"odd");var k=a.insertCell(-1);k.width="100%";k.innerHTML="Group Name";sc(k,"h4");k=a.insertCell(-1);k.innerHTML='<input type="text" name="grp[n]" style="width:300px"/>';k.firstChild.value=e.n?e.n:"";a=o.insertRow(-1);sc(a,"even");k=a.insertCell(-1);sc(k,"h4");k.innerHTML="Description<div class=nimp></div>";k.width="300";var m=k.lastChild;k=a.insertCell(-1);k.innerHTML='<textarea name="grp[d]" rows=3 cols=30 style="width:300px;"></textarea>';var g=k.firstChild;g.value=e.d?e.d:"";g.onkeyup=function(r){var c,d=Math.max(0,1000-this.value.length);if(!d){c="Your description is too long"}else{c=d+" characters left"}m.innerHTML=c};a=o.insertRow(-1);sc(a,"odd");k=a.insertCell(-1);sc(k,"h4");k.innerHTML="Type";k=a.insertCell(-1);var l=(e.tid==3||e.tid==1);k.innerHTML='<div><input type=radio name="grp[t]"'+(!e.tid?" checked":"")+' value="0"/> <b>Open</b> - Anyone can join</div><div><input type=radio name="grp[t]"'+(l?" checked":"")+' value="1"/> <b>Private</b> - New members must be approved</div>';a=o.insertRow(-1);sc(a,"even");k=a.insertCell(-1);k.innerHTML="Track News *";sc(k,"h4");k=a.insertCell(-1);k.innerHTML='Digital Journal\'s news articles that match the following keywords will be added to the group\'s article list<div class=small><b>Examples. Simple: </b>bush iraq, <b>advanced:</b> +paris +france -hilton</div><input type="text" name="grp[k]" style="width:300px" />';k.lastChild.value=e.kw?e.kw:"";a=o.insertRow(-1);sc(a,"odd");k=a.insertCell(-1);k.innerHTML="Email (public) *";sc(k,"h4");k=a.insertCell(-1);k.innerHTML='<input type="text" name="grp[e]" style="width:300px"/>';k.lastChild.value=e.e?e.e:"";a=o.insertRow(-1);sc(a,"even");k=a.insertCell(-1);k.innerHTML="Website *";sc(k,"h4");k=a.insertCell(-1);k.innerHTML='<input type="text" name="grp[w]" style="width:300px"/>';k.lastChild.value=e.w?e.w:"";a=o.insertRow(-1);sc(a,"odd");k=a.insertCell(-1);k.innerHTML="* - optional";k=a.insertCell(-1);sc(k,"tar");k.innerHTML='<input type=hidden name="grp[id]" value="'+(e.id?e.id:0)+'"/><input type="submit" value="'+(e.id?"Save":"Create")+' Group&#187;" onclick="return false"/> <input type=submit value=Cancel onclick="return false;"/>';var q=Ev;q.addListener(k.firstChild.nextSibling,"click",function(){try{var s=this.form;var d=djp.gebtn(s,"input");var r={e:s["grp[e]"].value,w:s["grp[w]"].value,n:s["grp[n]"].value,d:s["grp[d]"].value,k:s["grp[k]"].value};if(r.d){r.d=r.d.substr(0,1000)}else{throw"Please enter a brief description of your group."}for(var c=0;c<d.length;c++){if(d[c].name=="grp[t]"&&d[c].checked){r.t=d[c].value;break}}djp.editobj("userset","save",s["grp[id]"].value,{onAfterSave:function(u){djp.gotourl("/group/"+u.scode)},vals:r,tgt:"crt_grp_st"})}catch(t){alert(t)}return false});q.addListener(k.lastChild,"click",function(){var c=this.form.panel;c.hide();c.destroy();return false});h.appendChild(djp.dct("Creating a group will allow its members to blog, share and track news about a particular subject of interest."));h.appendChild(o);var j=n("div");j.id="crt_grp_st";h.appendChild(j);b.setBody(h);b.render(djp.loadtgt());b.show();e.create_panel=b}};YAHOO.lang.augmentProto(DJGroup,DJIDBUpdate);var DJDep=function(b){var a=this;a.init();if(!b){b={}}if(b.xml){a.from_xml(b.xml)}if(b.id){a.id=parseInt(b.id)}if(b.name){a.name=b.name}};DJDep.prototype={init:function(){this.id=0;this.name=""},from_xml:function(a){this.id=parseInt(a.getAttribute("id"));this.name=djp.get_xmlnodeval(a,1)}};var DJBlog=function(b){var a=this;a.init();if(!b){b={}}if(b.xml){a.from_xml(b.xml)}if(b.gid){a.group_id=parseInt(b.gid)}if(b.tid){a.tid=parseInt(b.tid)}if(b.id){a.id=parseInt(b.id)}if(b.flags){a.flags=parseInt(b.flags)}if(b.update&&a.id){a.updatefromdb(function(){a.edit()})}};DJBlog.prototype={onclose:function(d,c){if(!c.haschanges()||confirm("Are you sure you would like to close this window even though you have some unsaved changes?")){if(!c.id&&parseInt(c.edit_form["fd[imgset_id]"].value)){djp.editobj("imgset","delete",c.edit_form["fd[imgset_id]"].value,{quiet:1})}var a=c.edit_panel;if(a){var b=a.element.parentNode;if(b.tag){b.innerHTML=b.tag}a.hide();a.destroy()}}},create_edit_panel:function(){var q=this;var l=function(){q.valchanged()};q.edit_panel=new YAHOO.widget.Module("blog-edit",{centerinviewport:true,fixedcenter:true,width:"600px",visible:false,modal:true});var u=djp.dce,w=q.edit_panel,m=u("form"),v=u("table");m.method="post";m.blog=q;m.innerHTML='<div class="p odd small" style="padding:5px">You are about to post an entry in your blog. Focus on whatever interests you and share your opinion and links to other sites with the rest of the world! You are contributing for fun (unpaid). If you want to get paid to report news articles, you can Post News as a Digital Journalist. <a href="/user/benefits.php?b=cj">Learn more</a></div>';q.edit_form=m;var g="500px";v.width="100%";v.cellSpacing=0;v.cellPadding=5;var a=v.insertRow(-1);a.vAlign="top";var o=a.insertCell(-1);sc(o,"even h4");o.innerHTML="Title";o=a.insertCell(-1);sc(o,"even");o.innerHTML='<input type=text name="fd[title]" style="width:'+g+'"/>';o.firstChild.value=q.title?q.title:"";o.firstChild.onchange=l;a=v.insertRow(-1);var o=a.insertCell(-1);sc(o,"even h4");o.innerHTML="Tags "+djp.helpstr("tags");o=a.insertCell(-1);sc(o,"even");o.innerHTML='<div id="blog_tags"></div><div class="invis"></div>';o.lastChild.innerHTML=this.tag_links?this.tag_links:"";var d=new djp.TagEditor({tgt:o.firstChild,fld_name:"fd[tags]",link_container:o.lastChild});d.tagsChanged.subscribe(l);q.tag_editor=d;a=v.insertRow(-1);o=a.insertCell(-1);sc(o,"even h4");o.innerHTML="Category";o=a.insertCell(-1);sc(o,"even");o.innerHTML='<select name="fd[dep_id]" style="zIndex:200;"></select>';var k=o.firstChild;k.style.zIndex=3000;k.options.add(new Option("Pick a Category",0,false));if(djp.deps){var j=0,n=k.options.length;for(var h=0;h<djp.deps.length;h++){var s=djp.deps[h];k.options.add(new Option(s.name,s.id));if(s.id==this.did){j=h+n}}k.selectedIndex=j}k.onchange=l;a=v.insertRow(-1);o=a.insertCell(-1);sc(o,"even h4");o.innerHTML="Body";o=a.insertCell(-1);sc(o,"even");o.innerHTML='<div></div><textarea style="width:'+g+';height:250px;line-height:150%;font-size:14px;padding:10px;" name="fd[body]" id="bbe-'+djp.rndint()+'">'+(q.body?q.body:"")+"</textarea>";o.lastChild.onchange=l;a=v.insertRow(-1);o=a.insertCell(-1);sc(o,"even h4");o.innerHTML="Publish"+(q.id?"ed in":" to");o=a.insertCell(-1);sc(o,"even");o.innerHTML="Personal Blog";m.publish_cell=o;a=v.insertRow(-1);o=a.insertCell(-1);sc(o,"odd");o.colSpan=2;sc(o,"tar");o.innerHTML='<input type=hidden name="fd[flags]" value="'+q.flags+'" /><input type=hidden name="fd[gid]" value="'+q.group_id+'" /><input type=hidden name="fd[imgset_id]" value="'+(q.aid?q.aid:"")+'" onchange="this.form.valchange(this)" /><input type=hidden name="fd[id]" value="'+(q.id?q.id:"")+'" /><input type=hidden name="fd[type_id]" value="'+(q.tid?q.tid:0)+'" /><input type=submit onclick="djp.spellchk(null,this,{ group:\'blog_fields\'});return false;" value="'+djp.splchk_str[0]+'" /> &nbsp; &nbsp; <input name=sbmt type=submit value="'+(q.id?"Save &amp; View":"Post")+'" /> <input type=submit value="Cancel" onclick="return false;"/>';o.lastChild.onclick=function(){var c=this.form.blog;c.onclose(null,c);return false};m.appendChild(v);m.onsubmit=function(){var c=this,r=function(t){if(t&&t.argument&&t.argument.length){t.argument[0].form.blog.setnochanges()}djp.gotourl(t.scode?"/blog/"+t.scode:djp.replaceinhref("tp").replace(/#.*$/,""))};if(c.splchk_inprogress){djp.error("Please click '"+djp.splchk_str[1]+"' first")}else{if(!c.blog.haschanges()){djp.error("You haven't made any changes yet")}else{if(c.blog.tag_editor&&c.blog.tag_editor.tags.length<2){djp.error("Please provide at least 2 tags")}else{c.sbmt.disabled=true;c.action="/edit/blog-save-"+(c["fd[id]"].value?parseInt(c["fd[id]"].value):"");djp.ajax.formSubmit(c,{submit_mode:"EO",form:c,onAfterFail:function(t){t.argument[0].form.sbmt.disabled=false},onAfterSave:r})}}}return false};w.setHeader("Edit Blog");w.setBody(m);var e=gebi("djframe");e.tag=e.innerHTML;e.innerHTML='<div class="blockind"></div>';w.render(e.firstChild);var w=q.edit_panel;var b=q.edit_form["fd[body]"];dje.attachtoelement(b,b.previousSibling,{ichange:q,allow_imgs:1,skip_spell:1});djp.addsplchk(b,{group:"blog_fields",ichange:q,hidelnk:1});djp.addsplchk(q.edit_form["fd[title]"],{group:"blog_fields",ichange:q,hidelnk:1});w.hideEvent.subscribe(function(){Ev.removeListener(window,"beforeunload")})},init:function(){var a=this;a.id=0;a.uid=0;a.tid=0;a.did=0;a.flags=0;a.title="";a.body="";a.kw="";a.dp=0},from_xml:function(a){var b=this,d=djp.gebtn,c=djp.get_xmlnode,e=djp.get_xmlnodeval;b.id=parseInt(a.getAttribute("id"));b.uid=parseInt(a.getAttribute("uid"));b.tid=parseInt(a.getAttribute("tid"));b.did=parseInt(a.getAttribute("did"));b.flags=parseInt(a.getAttribute("flags"));b.aid=parseInt(a.getAttribute("imgsetid"));b.dp=djp.parseMysqlDate(a.getAttribute("dp"));b.title=e(d(a,"title")[0],1);b.body=e(d(a,"body")[0],1);b.kw=e(d(a,"kw")[0],1);b.tag_links=e(d(a,"tags")[0],1)},_edit_wbul:function(d,a){var c=null;if(a.haschanges()){c="All unsaved changes will be lost."}return c},edit:function(c){if(!c){c={}}if(!djp.deps&&!c.skipdeps){djp.get_deps(function(d){d.edit({skipdeps:1})},this);return}var b=this;if(!b.edit_panel){b.create_edit_panel()}var a=b.edit_panel;a.setHeader('<h3 style="margin:0;padding-left:10px;">'+(b.id?"Edit":"Create")+" blog entry</h3>");Ev.addListener(window,"beforeunload",b._edit_wbul,b);a.show();djp.user.update_groups(function(h){var k=b.edit_form.publish_cell,j="",d=djp.user.groups;if(b.id){var g=null;if(b.group_id){for(var e=0;e<d.length;e++){if(d[e].id==b.group_id){g=d[e];break}}}if(g){k.innerHTML=g}}else{for(var e=0;e<d.length;e++){j+='<option value="'+d[e].id+'"'+(d[e].id==b.group_id?" selected":"")+">Group: "+d[e].n+"</option>"}if(j){k.innerHTML='<select name="fd[gid_dd]" onchange="this.form[\'fd[type_id]\'].value=this.value?0:1;"><option value="">'+k.innerHTML+"</option>"+j+"</select>"}}})},getDBUrl:function(){if(this.id){return"/info/type/blog/"+this.id+"?rndint"+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"blg")},updatefromdb:function(b,a){this.updateFromDB(b,a)}};YAHOO.lang.augmentProto(DJBlog,DJIChange);YAHOO.lang.augmentProto(DJBlog,DJIDBUpdate);var DJComment=function(b,a){this.cfg=a;this.cid=b;this.loadcr=function(d){if(!d){return}if(!d.a){return}if(!d.k){d.k=0}var c=gebi("commrangediv"+d.k);if(!c){return}fsc(c,"vis","invis");if(c.className=="vis"&&!c.innerHTML){c.innerHTML="<div class=good>Retrieving comments, please be patient...</div>";djp.ajax.grab("/info/type/article/comments?doauth=1&hideranges=1&l="+d.l+"&rt="+d.type+"&data="+d.a+"&cr="+(d.k+1),{argument:[{tgt:c}]})}};this.get_src=function(g,d,c){var e="";if(!d){d=0}if(g){djp.ajax.grab("/info/type/comment/source?parsed="+d+"&data="+g+"&rndint="+djp.rndint(),c)}};this.save=function(c){if(!c){c=[]}if(c.f){c.quiet=1;c.handlers={argument:[c],failure:djp.handlers.failedEO,success:function(e){var g=e.argument[0];gebi(g.f.html_tgt.value).innerHTML=e.responseText;djp.handlers.successEO(e);if(e.scode){var d=gebi("cmb"+g.id);if(d){djp.comment.get_src(g.id,1,{argument:[{tgt:d.id}]});gebi("edtcommstatus"+g.id).innerHTML="";sc(d,"body");sc(g.f,"invis")}}}};djp.ajax.formSubmit(c.f,c.handlers)}};this.edit=function(l){if(!l.id){return alert("Error: Comment id was lost, cannot edit")}if(!l){l=[]}if(!l.rndint){l.rndint=0}var j=gebi("cd"+l.id);var c=gebi("cmb"+l.id);var e=Math.max(100,c.clientHeight),d=c.clientWidth-20;sc(c,"invis");var g=gebi("edtcomm"+l.id);if(!g){var k="<form id='edtcomm"+l.id+"' action='/edit/comment-body-"+l.id+"' method='post' style='padding:10px;' onsubmit=\"djp.comment.save({f:this,id:"+l.id+",rndint:"+l.rndint+" });return false;\"><div id='edtcommstatus"+l.id+"'></div><div id='edtcommdje"+l.id+"'></div><textarea class=body name='c[body]' id='commta"+l.id+"' style='width:"+d+"px;height:"+e+"px'></textarea><br/><input type='submit' value='Cancel' onclick='sc(gebi(\"cmb"+l.id+'"),"body");sc(this.form,"invis");return false;\' /> <input type=submit value=\'Save Changes\'/><input type=hidden name=frameless value=1 /><input type=hidden name=hide_styles value=1 /><input type=hidden name=html_tgt value=\'edtcommstatus'+l.id+"' /><input type=hidden name='c[article_id]' value='"+l.parent_id+"' /><input type=hidden name=rndint value='"+l.rndint+"' /></form>";j.innerHTML+=k;g=gebi("edtcomm"+l.id);dje.attachtoelement(g["c[body]"],gebi("edtcommdje"+l.id),{allow_imgs:1})}else{sc(g,"vis")}if(g){this.get_src(l.id,0,{argument:[{tgt:g.id}],success:djp.ajax.commentHandler.success})}}};DJComment.prototype={_quote:function(a){if(!a){return}djp.comment.get_src(a.cid,0,{success:function(h){var e=h.argument[0];var c=gebi("add_comment");if(c){djp.scrollTo(c);var b=gebi("cmb"+e.cid);var g=h.responseText;g=g.replace(/\[quote\][\s\S]*?\[\/quote\][\s]*/gim,"");var d=parseInt(gebi("commauth"+e.cid).innerHTML.replace(/^.*\/user\/([0-9]+).*$/m,"$1"));if(!isNaN(d)&&d){c.value+=(c.value.length>0?"\n":"")+"[quote]@[b]{user("+d+")}[/b]\n"}else{c.value+="[quote]"}c.value+=g+"[/quote]\n"}},argument:[a]})},_submit:function(a){if(!a||!a.f){return}if(a.f.splchk_inprogress){djp.status('Please complete spell-check by clicking "Resume Editing"',"bad")}else{if(!a.onAfterSave){a.onAfterSave=function(d){d.argument[0].f["c[body]"].value="";if(djp.obj_tabs){var c=djp.obj_tabs.djtab("comments"),b=djp.obj_tabs.getTabIndex(c);c.jump_to_comment=d.scode;djp.obj_tabs.deselectTab(b);djp.obj_tabs.selectTab(b)}else{window.location.reload()}}}if(!a.onAfterFail){a.onAfterFail=function(b){b.argument[0].f.addcommsubmit.disabled=false}}if(a.tgt){gebi(a.tgt).innerHTML='<div class="good">Saving comment...</div>'}a.f.addcommsubmit.disabled=true;a.submit_mode="EO";djp.ajax.formSubmit(a.f,a)}}};var DJArticle=function(b,a){if(!a){a={}}this.cfg=a;this.aid=b;this.page=this.cfg.p};DJArticle.prototype={has_inperson:function(a){return a&2},has_interview:function(c){var b=djp.article;return(c&4||b.has_ipinterview(c)||b.has_phinterview(c)||b.has_eminterview(c))},has_ipinterview:function(a){return a&32},has_phinterview:function(a){return a&64},has_eminterview:function(a){return a&128},has_extra:function(a){return(this.has_inperson(a)||this.has_interview(a))},toString:function(){return"Article["+this.aid+"]"},submit:function(d,a){if(!d||!d.f){return}var b=(d.tgt?(typeof(d.tgt)=="object"?d.tgt:gebi(d.tgt)):null);if(b){b.innerHTML='<div class="good">Saving...</div>'}if(!d.onAfterSave){d.onAfterFail=function(h){var g=h.argument[0];if(g.article){g.article.submitting=0}if(typeof a=="function"){a.call(h,"error")}}}d.onAfterSave=function(l){var k=l.argument[0];if(typeof a=="function"){a.call(l)}if(k.article){var g=k.article;g.setnochanges();g.submitting=0;if(g.submitting_changed){g.submitting_changed=0;g.haschanges(1);g.onvalchanged()}}var j=k.f["article[article_id]"];var h=parseInt(j.value);if((!h||isNaN(h))&&l.scode){j.value=l.scode;h=l.scode}if(h){YAHOO.util.History.navigate("edta",h+"");if(k.redir){djp.gotourl("/article/"+h)}}};var c=new RegExp("^(op[-/ ]?ed|opinion):[\\s]*","i"),e=new RegExp("^breaking( news)?:\\s*","i");$(d.f).find("input.headline").each(function(){var g=this.value;if(g.match(c)){$(d.f["article[flag]"][1]).prop("checked",true);$(this).val(g.replace(c,""));this.uclim()}if(g.match(e)){$(d.f["article[is_breaking]"]).prop("checked",true).val(1);$(this).val(g.replace(e,""));this.uclim()}});d.submit_mode="EO";d.timeout=60000;return djp.ajax.formSubmit(d.f,d)},update_rating:function(d,b,c,a){if(!a){a={}}if(!a.argument){a.argument={}}if(!a.argument||!a.argument[0]){a.argument=[{}]}if(!a.argument[0].tgt){a.argument[0].tgt=b}djp.ajax.grab("/info/type/article/rating?data="+d+"&rndint="+djp.rndint()+(c?"&tpl="+c:"")+"&vtshow=1",a)},activate:function(a){if(!a){a={}}djp.editobj("article","is_active",this.aid,djp.clonecopy({vals:{val:1},onAfterSave:function(){djp.console("reload")}},a))}};YAHOO.lang.augmentProto(DJArticle,DJIChange);var DJImage=function(a,b){if(b){this.cfg=djp.clone(b,1)}else{this.cfg={}}this.init();if(typeof(a)=="object"){if(a&&typeof(a.getAttribute)!="function"){this.from_json(a)}else{this.from_xml(a,this.cfg)}}this.focalPointChangedEvent=new YAHOO.util.CustomEvent("focalPointChanged",this,1,YAHOO.util.CustomEvent.FLAT)};DJImage.prototype={getUserId:function(){return this.uid},toString:function(){return"Image["+this.id+"]"},uploadedByOwner:function(){return this.flags&1},fromMobi:function(){return this.flags&2},uce:function(a){return(a.has_perm(16)||a.get_id()==this.getUserId())},hasFP:function(){var a=this;return !(a.fx==0.5&&a.fy==0.5)},init:function(){djp.clonecopy(this,{numcom:0,fpdiv:null,album:null,id:0,t:0,l:0,w:0,h:0,fx:0,fy:0,rating:0,fs:0,uid:0,uid:0,du:null,dt:null,fn:"",loc:"",title:"",descr:"",kw:""})},renderTo:function(d,c){d=gebi(d);c=c||{};var b=d.firstChild;var a=(!b||!b.tagName||b.tagName.toLowerCase()!="a")?null:function(e){b.style.cursor="pointer";Ev.addListener(d,"click",function(h,g){djp.gotourl(b.href)},b)};if(a){c.href=b.href}djp.console(b,c.onclick||a);d.insertBefore(this.to_html(djp.clonecopy({tgt:d,pw:[0,0],l:"compact",onclick:(c.onclick||a)},c,1)),d.firstChild)},from_json:function(a){djp.clonecopy(this,a)},from_xml:function(d,c){var e=this,g=function(j,h){return parseInt(j.getAttribute(h))},a=function(j,h){return parseFloat(j.getAttribute(h))},b=function(j,h){return djp.get_xmlnodeval(djp.gebtn(j,h)[0],1)};if(c){if(c.a){e.album=c.a}}if(!d){return}djp.clonecopy(e,{id:g(d,"id"),t:g(d,"t"),l:g(d,"l"),w:g(d,"w"),h:g(d,"h"),numcomm:g(d,"nc"),numviews:g(d,"nv"),hasvoted:g(d,"hasvoted"),rating:g(d,"rating"),flags:g(d,"flags"),fs:g(d,"fs"),uid:g(d,"uid"),fx:a(d,"fx"),fy:a(d,"fy"),du:d.getAttribute("du"),dt:d.getAttribute("dt"),fn:d.getAttribute("fn"),loc:b(d,"loc"),title:b(d,"title"),descr:b(d,"descr"),kw:b(d,"kw"),attr:b(d,"attr"),tags:[],tag_links:b(d,"tags"),srcurl:b(d,"srcurl")},1);e.tags=[];djp.gebtn(d,"djtag").each(function(){e.tags.push(new djp.Tag(this))})},fpx:function(a){if(typeof(a)=="undefined"){a=1}return Math.min(this.w,Math.round(this.w*this.fx*a))},fpy:function(a){if(typeof(a)=="undefined"){a=1}return Math.min(this.h,Math.round(this.h*this.fy*a))},ishoriz:function(){return this.w>=this.h},ltypes:[["Unknown","Please set the license if you can edit this image and know the license that it can be distributed under.",0],["All Rights Reserved","I took this photo and want to maintain sole rights to it.",1],["Public Domain","I am releasing this photo into the public domain, or it already exists in the public domain. It is not subject to any copyright or patent restrictions.",0],["Creative Commons - Attribution","I am releasing this photo with a Creative Commons Attribution license, or it is a photo that already exists with this license. With this license, You are free to copy, distribute and transmit the work or remix this photo as long as the work is attributed in the manner specified by the author or licensor (but not in any way that suggests that they endorse you or your use of the work).",1],["Creative Commons - Attribution-NoDerivs","I am releasing this photo with a Creative Commons Attribution-NoDerivs license, or it is a photo that already exists with this license. With this license, you are free to copy, distribute and transmit the work, but you must attribute the work in the manner specified by the author or licensor (but not in any way that suggests that they endorse you or your use of the work) and you may not alter, transform, or build upon this work.",1],["Creative Commons - Attribution-ShareAlike","I am releasing this photo with a Creative Commons Attribution-ShareAlike, or it is a photo that already exists with this license. With this license, You are free to copy, distribute and transmit the work or remix this photo as long as the work is attributed in the manner specified by the author or licensor (but not in any way that suggests that they endorse you or your use of the work). If you alter, transform, or build upon this work, you may distribute the resulting work only under the same, similar or a compatible license.",1],["Creative Commons - Attribution-NonCommercial","",1],["Creative Commons - Attribution-NonCommercial-NoDerivs","",1],["Creative Commons - Attribution-NonCommercial-ShareAlike","",1]],license:function(){var a=this;if(a.ltypes[a.l]){return a.ltypes[a.l]}return""},url:function(b){if(!b){b={}}var a;if(b.details){a="/image/"+this.id}else{a="/img"+djp.id2path(this.uid)+"/i"+djp.id2path(this.id,3);a+="/"+(!b.ps?(b.regen?"r":"o"):("p-"+b.ps))+"/"+this.fn+(b.cachebust?"?rnd_int="+djp.rndint():"")}return a},pw:{small:[150,150],medium:[300,300],large:[620,620],huge:[1000,1000]},get_tsizes:function(l,c){var k=[],e=this;c=c?1:0;for(var b in e.pw){var j=e.pw[b][0];var h=e.pw[b][1];var a=Math.min(h/e.h,j/e.w);if(a>1){continue}var g=[Math.round(e.w*a),Math.round(e.h*a)];var d={img:e,s:b,w:g[0],h:g[1],r:a,fpy:function(){return this.img.fpy(this.r)},fpx:function(){return this.img.fpx(this.r)},url:function(m){m=m||{};m.ps=this.s;return this.img.url(m)}};if(l){if(((l[0]>d.w||l[1]>d.h)&&!c)||(c&&l[0]>d.w&&l[1]>d.h)){continue}}k.push(d)}return k},get_ps:function(c,b){if(!b){b=this.pw[c]}if(!b){b=[this.w,this.h]}var a=Math.min(b[0]/this.w,b[1]/this.h);if(b){return[Math.round(this.w*a),Math.round(this.h*a)]}},to_html:function(Q){var y=this;var S="pics-img-edit-status";var J=y.w,X=y.h,D;var j=Ev;if(!Q){Q={}}if(!Q.show){Q.show={}}if(!Q.hide){Q.hide={}}if(!Q.canedit){Q.canedit=y.uce(djp.user)}if(!Q.pw){Q.pw=[J,X]}for(var W=0;W<Q.pw.length;W++){if(Q.pw[W]==0&&typeof(Q.tgt)=="object"){Q.pw[W]=(W==0?Math.max(0,Q.tgt.clientWidth):Math.max(0,Q.tgt.clientHeight));if(!Q.pw[1]){Q.pw[1]=Q.tgt.offsetHeight}if(!Q.pw[0]){Q.pw[0]=Q.tgt.offsetWidth}}}var x=y.get_tsizes(Q.pw,Q.nozoom),e=x.length?0:-1;var b="";if(x.length){for(var W=0;W<Q.pw.length;W++){if(Q.pw[W]==-1){var a=Math.abs(W-1);if(Q.pw[a]>=(a?y.h:y.w)){e=-1;break}for(var V=0;V<x.length;V++){var e=V,M=x[e];if(Q.pw[a]<=(W?M.w:M.h)||V==x.length-1){Q.pw[W]=Math.round((W?y.h:y.w)*((Q.pw[a]<=(a?y.h:y.w))?M.r:1));break}}}}}if(e>=0&&x.length){var M=x[e];D=[M.fpx(),M.fpy()];Q.ps=[M.w,M.h];b=M.url(Q.urlopt)}else{for(var W=0;W<Q.pw.length;W++){if(Q.pw[W]==-1){Q.pw[W]=W?y.h:y.w}}D=[y.fpx(),y.fpy()];Q.ps=[J,X];b=y.url(Q.urlopt)}Q.pw=[Math.min(Q.pw[0],Q.ps[0]),Math.min(Q.pw[1],Q.ps[1])];var T=[Math.min(Math.max(0,(Q.pw[0]-Q.ps[0])/2),-Math.min(Q.ps[0]-Q.pw[0],(D[0]*2-Q.pw[0])/2)),Math.min(Math.max(0,(Q.pw[1]-Q.ps[1])/2),-Math.min(Q.ps[1]-Q.pw[1],(D[1]*2-Q.pw[1])/2))];var g=djp.dce("DIV");if(Q.href){$(g).data("href",Q.href)}g.img=y;sc(g,"imgp");var v=g.style;if(Q.align){if(Q.align.toUpperCase()=="CENTER"){v.marin="0 auto"}else{v["float"]=Q.align}}if(Q.onclick){j.on(g,"click",Q.onclick,g);v.cursor="pointer"}else{if(!Q.noclick){var aa=function(){djp.gotourl(this.img.url({details:1}));return false};j.on(g,"click",aa);v.cursor="pointer"}}v.height=Q.pw[1]+"px";v.width=Q.pw[0]+"px";v.overflow="hidden";var F=djp.dce("a");v=F.style;v.margin=T[1]+"px 0 0 "+T[0]+"px";v.height=Q.ps[1]+"px";v.width=Q.ps[0]+"px";v.display="block";try{var I=b.replace('"','\\"');v.background='transparent url("'+I+'") no-repeat top left'}catch(Y){djp.error("Error in background url "+I+": "+y)}g.appendChild(F);if(Q.show.fp&&Q.canedit){v.cursor="crosshair";g.title="Click anywhere on the image to change the focal point to where the center of attention should be.";y.tooltip=new YAHOO.widget.Tooltip("ttFP"+djp.rndint(),{width:"200px",zIndex:150,context:g});y.tooltip.beforeShowEvent.subscribe(function(k,h,c){c.bringToTop()},y.tooltip);var W=djp.dce("DIV");sc(W,"fpch");W.recenter_fp=function(){var m=Dom,l=this.parentNode,c=this,h=m.getXY(l),k=Math.min(l.clientWidth/y.w,l.clientHeight/y.h);h[0]+=y.fpx(k)-Math.round(c.clientWidth/2);h[1]+=y.fpy(k)-Math.round(c.clientHeight/2);m.setXY(this,h)};F.appendChild(W);y.fpdiv=W;var aa=function(o,h,s){var l=Ev,r=Dom,m=[l.getPageX(o),l.getPageY(o)],n=r.getXY(F);var k=[(m[0]-n[0])/F.clientWidth,(m[1]-n[1])/F.clientHeight];y.fx=k[0];y.fy=k[1];F.childNodes[0].recenter_fp();djp.editobj("img","fp",y.id,{vals:{x:y.fx,y:y.fy}});y.focalPointChangedEvent.fire()};Ev.addListener(F,"click",aa)}switch(Q.l){case"compact":case"feature":return g;break;case"alignable":var L=djp.dce("table");L.imgdiv=g;L.cellPadding=0;L.cellSpacing=0;L.align=Q.align;var O=L.insertRow(-1);var ab=O.insertCell(-1);ab.appendChild(g);return L;break;default:var L=djp.dce("TABLE");L.width="100%";L.cellPadding=10;L.cellSpacing=0;var O=L.insertRow(-1);O.vAlign="top";if(Q.show.fp){var ab=O.insertCell(-1);ab.width=Q.pw[0];ab.style.paddingRight=0;ab.style.background="white";ab.appendChild(g);if(Q.canedit){var Z=djp.dce("DIV");sc(Z,"tac p"+(y.hasFP()?"":" bad"));Z.innerHTML="Set focal point "+djp.helpstr("focal_point");ab.appendChild(Z)}if(Q.abi){ab.appendChild(Q.abi)}}ab=O.insertCell(-1);var C=djp.dce("table");sc(C,"imgdls");C.width="100%";C.cellPadding=8;C.cellSpacing=0;var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Description";var G=E.insertCell(-1);G.innerHTML=y.descr?y.descr:"";if(Q.canedit){var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="djp.editfld({f:\'img\',id:'+y.id+",t:'ta',maxl:255,tf:this.parentNode.previousSibling,fld:'descr'});return false;\">Edit</a>"}else{G.colSpan=2}if(y.numviews&&djp.user.is_loggedin()&&djp.user.is_admin()){var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Views";var G=E.insertCell(-1);G.innerHTML='<a href="" onclick="var p=new DJSelCustomUsers(\'/info/type/user/image-viewers?image='+y.id+"',{viewOnly:1});p.show();return false;\">"+y.numviews+"</a>";G.colSpan=2}var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Tags "+djp.helpstr("tags");var G=E.insertCell(-1);G.innerHTML="<div></div>";try{var N=[];y.tags.each(function(){N.push(this.stringify({title:"",allow_link:true}))});G.firstChild.innerHTML=N.join(", ")}catch(Y){djp.error(Y)}if(Q.canedit){var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="djp.editfld({f:\'img\',id:'+y.id+",img:this.djimg,t:'tag_editor',maxl:100,tf:this.parentNode.previousSibling,fld:'tags'});return false;\">Edit</a>";G.firstChild.djimg=y}else{G.colSpan=2}var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Attribution "+djp.helpstr("img_attr");var G=E.insertCell(-1);G.djByOwner=y.uploadedByOwner();G.djAttr=G.djByOwner?"":(y.attr||"");if(G.djByOwner){G.innerHTML="<div class=small>"+djp.loading_text()+"</div>";y.loadUser(function(c){c.innerHTML="";c.appendChild(this.to_html())},G)}else{G.innerHTML=G.djAttr}if(Q.canedit){var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="djp.editfld({f:\'img\',id:'+y.id+",t:'owner',tf:this.parentNode.previousSibling,fld:'ownership'});return false;\">Edit</a>";G.firstChild.attVal=y.attr}else{G.colSpan=2}var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="License "+djp.helpstr("img_licenses");var G=E.insertCell(-1);var U=y.license()[0];G.innerHTML=U?U:"";if(Q.canedit){var z=[];for(var V=1;V<y.ltypes.length;V++){z.push(V+":['"+y.ltypes[V][0]+"',"+(V==y.l?1:0)+","+(V!=2?1:0)+","+(y.ltypes[V][2]?"1":"0")+"]")}var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="var c=this.parentNode.previousSibling;djp.editfld({f:\'img\',id:'+y.id+",t:'sel',tf:c,fld:'license_id',selitems:{"+z.join(",")+'}});return false;">Edit</a>'}else{G.colSpan=2}E=C.insertRow(-1);G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Source URL "+djp.helpstr("img_src_url");G=E.insertCell(-1);if(y.srcurl){G.innerHTML='<a href="'+y.srcurl+'" class=nowrap target="_blank">'+y.srcurl.replace(/^([a-zA-Z]+:\/\/)?([a-zA-Z0-9_.]+).*$/,"$2...")+"</a>"}else{G.innerHTML=""}if(Q.canedit){G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="djp.editfld({f:\'img\',id:'+y.id+",t:'url',tf:this.parentNode.previousSibling,fld:'src_url'});return false;\">Edit</a>"}else{G.colSpan=2}if(Q.show.uploader){E=C.insertRow(-1);G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Uploaded&nbsp;By";var H=E.insertCell(-1);H.colSpan=2;H.innerHTML="";y.loadUser(function(c){c.appendChild(this.to_html())},H)}E=C.insertRow(-1);G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Taken";G=E.insertCell(-1);G.innerHTML=y.dt?djp.parseMysqlDate(y.dt).toLocaleDateString():"";if(Q.canedit){var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a class=editfld href="" onclick="djp.editfld({f:\'img\',id:'+y.id+",t:'date',tf:this.parentNode.previousSibling,fld:'date_taken'});return false;\">Edit</a>"}else{G.colSpan=2}var E=C.insertRow(-1);sc(E,"even");var G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Uploaded";var G=E.insertCell(-1);G.colSpan=2;G.innerHTML=djp.parseMysqlDate(y.du).toLocaleString()+(y.fromMobi()?'<div class="p nimp small"><img src="/images/djmobi.gif" align=absmiddle border=0 /> via Digital Journal Mobile</div>':"");var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='<a href="'+y.url()+'" target="_blank">Original File</a>';var G=E.insertCell(-1);G.colSpan=2;G.innerHTML=y.w+"x"+y.h+' pixels <span class="nimp small">@72DPI</span> ('+(Math.round(y.w*y.h/10000)/100)+"MP) <span class=nimp> - "+Math.round(y.fs/102.4)/10+"KB</span>";var K=djp.user;if(K.is_loggedin()){var d=K.albums;var P="";if(d){for(var V in d){var R=d[V].name;if(R.length>20){R=R.substring(0,17)+"..."}P+='<option value="'+V+'">'+R+"("+d[V].imgnum+")</option>"}}if(P){P='<select name="to_album">'+P+'</select> <input type=submit value="Add" />'}if(P){var aa=djp.dce("form");aa.innerHTML=P;aa.onsubmit=function(){var c=parseInt(this.to_album.value);if(c&&!isNaN(c)){djp.editobj("imgset","addimg",c,{vals:{tid:djp.user.albums[c].t,imgid:y.id,method:this.method.value}})}return false};var E=C.insertRow(-1);var G=E.insertCell(-1);sc(G,"tar");G.innerHTML='Add to Album<div><a href="" onclick="var a = new DJAlbum();a.edit({ asf:function(){ djp.reload();}});return false;">Create New&#187;</a></td></tr></table>';var G=E.insertCell(-1);G.colSpan=2;G.appendChild(aa)}}if(K.is_loggedin()&&(K.is_admin()||K.get_id()==y.uid)){var E=C.insertRow(-1),G=E.insertCell(-1);sc(G,"tar");G.innerHTML="Image Tools";G=E.insertCell(-1);G.innerHTML="Rotate <a href=\"\" onclick=\"djp.editobj('img','rotate','"+y.id+"',{ vals:{ angle:270}, onAfterSave:this.djFunc, img:this.djImg});return false;\">90&deg; Left</a> - <a href=\"\" onclick=\"djp.editobj('img','rotate','"+y.id+"',{ vals:{ angle:180}, onAfterSave:this.djFunc, img:this.djImg});return false;\">180&deg;</a> - <a href=\"\" onclick=\"djp.editobj('img','rotate','"+y.id+"',{ vals:{ angle:90}, onAfterSave:this.djFunc, img:this.djImg});return false;\">90&deg; Right</a>";var q=function(h){var c=h.argument[0].img;if(c){if(c.afterUpdateFunc){c.djImgCacheBust=1;c.updatefromdb(c.afterUpdateFunc)}else{djp.gotourl(c.url({details:1}))}}else{djp.gotourl("reload")}};var A=djp.gebtn(G,"a");for(var W=0;W<A.length;W++){A[W].djImg=y;A[W].djFunc=q}}if(djp.user.is_loggedin()){E=C.insertRow(-1);G=E.insertCell(-1);sc(G,"tar");G.colSpan=3;G.innerHTML='<a class=editfld href="" onclick="djp.user.report({iid:'+y.id+'});return false;">Report</a>'+(djp.user.is_admin()?" | <a href=\"\" onclick=\"djp.editobj('img','guess_datetaken',"+y.id+");return false;\" class=editfld >Guess DateTaken</a> | <a href=\"\" onclick=\"djp.editobj('img','regenthumbs',"+y.id+');return false;" class="editfld">Regen Thumbs</a>':"")+(Q.canedit?" | <img src=\"/images/close.gif\" align=absmiddle border=0 /> <a class=editfld href=\"\" onclick=\"if(confirm('Are you sure you want to permanently delete this image from Digital Journal?'))djp.editobj('img','delete',"+y.id+');return false;">Delete</a>':"")}var B=djp.dce("div");if(Q.max_det_height){B.style.overflow="auto";B.style.height=Q.max_det_height+"px"}B.appendChild(C);ab.appendChild(B);return L}},upload_form:function(b,c){var a=this;c.f=b;if(!c.handlers){c.handlers={}}if(!c.handlers.failure){c.handlers.failure=djp.handlers.failedEO}if(!c.handlers.upload){c.handlers.upload=function(g){var e=g.argument[0];djp.console("after image upload",g);djp.console("upload time",e.start_time,new Date().getTime(),new Date().getTime()-e.start_time);if(e.ltel){e.ltel.innerHTML=""}if(djp.handlers.successEO(g)){var d=g.argument[1];if(e.afu){e.afu(e)}setTimeout(function(){if(a.panel){a.panel.destroy()}a.panel=null;if(a.uploadConn){a.uploadConn=null}},1000)}else{if(e.f){e.f.upl_button.disabled=false}}}}if(c.ltel){c.ltel.innerHTML="<div class=good>Please be patient as your image uploads "+djp.loading_text()+"</div>"}a.uploadConn=djp.ajax.formSubmit(b,{upload:c.handlers.upload,failure:function(e){var d=e.argument[0];if(d.ltel){d.ltel.innerHTML=""}},timeout:0,argument:[c,a]});djp.console(a.uploadConn)},upload_panel:function(g){g=g||{};var b=this;b.panel=new DJPanel("upload_img-p",{centerinviewport:true,fixedcenter:false,width:"700px",visible:false,modal:true,close:false});var c=b.panel;c.setHeader('<img src="/images/image.gif" align=absmiddle border=0 /> Upload Image - <a href="/user/benefits.php?b=images" target="_blank" style="color:black">View Tutorial</a> <img src="/images/external.gif" border=0 />');var a='<iframe src="/upload_photo.php" width="678" height="400" border=0 id="upload_image_iframe"></iframe>';var e='<div class="flright" style="margin-left:10px;"><div id="img_upl_status"></div>&nbsp;<button id="img_upl_button" class="fancy green">Upload</button>&nbsp;<button class="fancy low-key" id="upl_cancel_btn">Cancel</button></div>';a+='<div style="font-size:11px;margin:10px 0;clear:both;color:red;">'+e+"I fully comply with Digital Journal's Terms of Use, I agree the image(s) I am uploading do not violate any copyright laws relating to third-party individuals and I am solely responsible for all Content I upload.</div>";c.setBody(html2el("<div>"+a+"</div>")[0]);c.render(djp.loadtgt());var d=gebi("upload_image_iframe");d.uploadedEvent=new YAHOO.util.CustomEvent("uploaded",c,false,YAHOO.util.CustomEvent.FLAT);d.imgUplOpt=g;d.uploadedEvent.subscribe(function(){var j=d.imgUplOpt.selimg;if(!j){j=new DJSelImgs({render_tgt:parent.djp.loadtgt()})}var h=function(l,k){l.afterShowEvent.unsubscribe(k,k);l.myuploads.sel_album()};j.afterShowEvent.subscribe(h,h);c.hide();c.destroy();j.show()});Ev.addListener("upl_cancel_btn","click",function(){var h=arguments[1];var j=YAHOO.util.Connect;if(h.uploadConn&&j.isCallInProgress(img.uploadConn)){j.abort(h.uploadConn,function(k){djp.status("Aborted image upload")},false)}h.hide();h.destroy()},c);c.show()},upload_panel_old:function(s){s=s||{};var z=this;z.panel=new DJPanel("upload_img-p",{centerinviewport:true,fixedcenter:false,width:"500px",visible:false,modal:true,close:false});var q=z.panel;q.setHeader('<img src="/images/image.gif" align=absmiddle border=0 /> Upload Image - <a href="/user/benefits.php?b=images" target="_blank" style="color:black">View Tutorial</a> <img src="/images/external.gif" border=0 />');q.setBody('<form enctype="multipart/form-data" method="post" action="/edit/app-upload_img-mypics" onsubmit="return false">'+(z.album?'<input type="hidden" name=fd[aid] value="'+z.album.id+'"/>':"")+"</form>");q.render(djp.loadtgt());var w=q.body.lastChild;w.img=z;w.afterUpload=function(o){var c=o.selimg;if(!c){c=new DJSelImgs()}var a=function(t,r){t.afterShowEvent.unsubscribe(r,r);t.myuploads.sel_album()};c.afterShowEvent.subscribe(a,a);c.show()};var l=djp.dce("table");w.insertBefore(l,w.firstChild);l.width="100%";l.cellPadding=7;l.cellSpacing=0;l.border=0;l.num_file_rows=0;l.panel=q;var e=function(o,a,C){o.num_file_rows++;var B=o.insertRow(a);sc(B,"even");var D=B.insertCell(-1);D.className="h3";D.innerHTML="Image:";D=B.insertCell(-1);D.innerHTML='<input type=file name="upl_img_'+o.num_file_rows+'" style="width:200px;" class=small />';D=B.insertCell(-1);sc(D,"tar");if(!C){D.innerHTML='<a href="" onclick="return false;">Remove</a>';var A=D.firstChild;A.imgtable=o;A.onclick=function(){this.imgtable.num_file_rows--;var c=this.parentNode.parentNode;c.parentNode.removeChild(c);return false}}else{D.innerHTML='<a href="" onclick="return false;"><b>+</b> Add another image</a>';var A=D.firstChild;A.imgtable=o;A.onclick=function(){var c=this.imgtable;e(c,c.num_file_rows);return false}}};e(l,-1,1);var m=l.insertRow(-1);sc(m,"odd");var x=m.insertCell(-1);sc(x,"imp nowrap");x.innerHTML="* Ownership";x=m.insertCell(-1);x.colSpan=2;x.innerHTML='<input type=radio name="fd[itookit]" value=1 /> This is my image &nbsp; &nbsp; <input type=radio name="fd[itookit]" value=0 /> This is someone else\'s image</div>';var d=djp.gebtn(x,"input"),h=function(){var o=this,c=o.attrRow,a=o.srcUrlRow;if(o.checked&&!parseInt(o.value)){Dom.removeClass(c,"invis");Dom.removeClass(a,"invis")}else{Dom.addClass(c,"invis");Dom.addClass(a,"invis")}};m=l.insertRow(-1);var n=m;sc(m,"odd invis");x=m.insertCell(-1);sc(x,"imp nowrap");x.innerHTML="* Attribution "+djp.helpstr("img_attr");x=m.insertCell(-1);x.colSpan=2;x.innerHTML='<input type=text name="fd[attr]" style="width:300px">';m=l.insertRow(-1);m.className="odd invis";x=m.insertCell(-1);sc(x,"imp nowrap");x.innerHTML="Source URL "+djp.helpstr("img_src_url");for(var v=0;v<d.length;v++){d[v].onclick=h;d[v].attrRow=n;d[v].srcUrlRow=m}var x=m.insertCell(-1);x.colSpan=2;x.innerHTML='<input type=text name="fd[src_url]" value="http://" onfocus="this.select();" style="width:300px">';var m=l.insertRow(-1);m.className="even";var x=m.insertCell(-1);sc(x,"imp");x.innerHTML="* License "+djp.helpstr("img_licenses");var x=m.insertCell(-1);x.colSpan=2;var k="";for(var v=1;v<3;v++){k+="<div><input align=absmiddle "+(v==1?"checked ":"")+'type=radio name="fd[license_id]" value="'+v+"\" onclick=\"sc('cc_cell','invis');\" /> "+z.ltypes[v][0]+"</div>"}k+='<div><table cellpadding=0 cellspacing=0 border=0 width="100%"><tr valign=top><td><input name="fd[license_id]" value="-1" align=absmiddle type=radio onclick="sc(this.parentNode.nextSibling,(this.checked?\'vis\':\'invis\'));" /> Creative Commons</td><td class=invis id="cc_cell"><table cellpadding=1 cellspacing=0 border=0 width="100%">';k+='<tr><td><img src="/images/cc-by.gif" align=absmiddle border=0 /></td><td><input align=absmiddle type=checkbox checked name="license_cc_a" value="attribution" onclick="if(!this.checked)alert(\'Attribution is required\');this.checked=true;return false;" /> Attribution</td></tr>';k+='<tr><td><img src="/images/cc-nc.gif" align=absmiddle border=0 /></td><td><input align=absmiddle type=checkbox name="license_cc_nc" value="noncommercial" /> Non-Commercial</td></tr>';k+='<tr><td><img src="/images/cc-nd.gif" align=absmiddle border=0 /></td><td><input align=absmiddle type=checkbox name="license_cc_nd" value="noderivs" onclick="if(this.checked)this.form.license_cc_sa.checked=false;" /> No Derivative Work</td></tr>';k+='<tr><td><img src="/images/cc-sa.gif" align=absmiddle border=0 /></td><td><input align=absmiddle type=checkbox name="license_cc_sa" value="sharealike" onclick="if(this.checked)this.form.license_cc_nd.checked=false;" /> Share-Alike</td></tr>';k+="</table></td></tr></table></div>";x.innerHTML=k;Dom.getElementsBy(function(a){return true},"input",x,function(a){Ev.on(a,"click",function(o,c){c.center()},l.panel)});var m=l.insertRow(-1);m.className="odd";var x=m.insertCell(-1);sc(x,"imp");x.innerHTML="* Tags";var x=m.insertCell(-1);x.innerHTML="<div></div>";x.tag_editor=new djp.TagEditor({tgt:x.firstChild,fld_name:"fd[tags]"});x.colSpan=2;var m=l.insertRow(-1);sc(m,"even");var x=m.insertCell(-1);sc(x,"imp");x.innerHTML="Description";var x=m.insertCell(-1);x.colSpan=2;x.innerHTML='<textarea name="fd[descr]" rows=2 cols=30 style="height:35px;width:300px"></textarea>';if(djp.user.is_loggedin()){var j=function(t){var c=djp.user.albums;var r="";var a=0;if(c){for(var o in c){r+='<div style=""><input type="checkbox" name="add_to[]"'+((s.selected_album==c[o].id||(z.album&&z.album.id==c[o].id))?" checked":"")+' value="'+o+'"/> '+c[o].name+"</div>";a++}}t.style.height=Math.min(60,a*20)+"px";t.innerHTML=r};var g=l.insertRow(-1);sc(g,"odd");var u=g.insertCell(-1);sc(u,"imp");u.innerHTML="<span class=nowrap>Add to Album</span>";var u=g.insertCell(-1);u.colSpan=2;u.innerHTML='<table width="100%" cellpadding=3 border=0 cellspacing=0 ><tbody><tr><td><div style="overflow:auto;height:0px;"></div></td><td class="p tar"><a href="">+ Create new album</a></td></tr></tbody></table>';var b=u.firstChild.firstChild.firstChild;var y=b.lastChild.firstChild;y.tag=b.firstChild.firstChild;y.layout_albums=j;djp.user.update_albums({la:j,la_tgt:y.tag,afs:function(c){var a=c.argument[0];a.la(a.la_tgt)}});y.onclick=function(){var c=new DJAlbum();c.edit({la:this.layout_albums,la_tgt:this.tag,asf:function(t){var r=t.argument[0];var a=function(C){var B=C.argument[0];B.la(B.la_tgt);var A=B.album;if(A&&A.panel){A.panel.hide();A.panel.destroy();A.panel=null}};djp.user.update_albums({album:r.a,la:r.la,la_tgt:r.la_tgt,afs:a})}});return false}}m=l.insertRow(-1);sc(m,"even");x=m.insertCell(-1);x.innerHTML="* - required";x=m.insertCell(-1);x.colSpan=2;sc(x,"hlplnkul");x.innerHTML='<input name="accept_terms" type="checkbox" value=1 /> I\'ve read and agree with '+djp.helpstr("image_terms",{skip_icon:1,txt:"terms of use for images"});m=l.insertRow(-1);var x=m.insertCell(-1);x.colSpan=3;sc(x,"tar");x.innerHTML='<div id="upload_img_frm_status" style="float:left"></div><input type=submit class=h3 value="Upload Image" name="upl_button" /> <input type=submit value="Cancel" />';Ev.addListener(x.lastChild,"click",function(){var a=this.form.img;var c=a.panel;var o=YAHOO.util.Connect;if(a.uploadConn&&o.isCallInProgress(a.uploadConn)){o.abort(a.uploadConn,function(r){djp.status("Aborted image upload")},false)}c.hide();c.destroy()});x.firstChild.nextSibling.imgUplOpt=s;Ev.addListener(x.firstChild.nextSibling,"click",function(){var E=this.form,o="",r="fd[license_id]",A=djp.getRadioVal(E,"fd[itookit]");o=djp.getRadioVal(E,r);if(o==-1){var D=[],C=Dom.getElementsBy(function(H){return H.name.match("^license_cc_")&&H.checked},"input",E,function(){D.push(this.value)});if(D.length){var a=new RegExp("^(creative commons|CC) - "+D.join("-")+"$","i"),F=E.img.ltypes;for(var B=0;B<F.length;B++){if(a.exec(F[B][0])){o=B}}}E.elements[r][2].value=o}var G=E["fd[attr]"].value,t="";if(!E.accept_terms.checked){t="You must accept Terms of Use for images"}else{if(A===undefined){t="Missing ownership details"}else{if(o==-1){t="Invalid Creative Commons license"}else{if(!parseInt(o)){t="You must pick image license type"}else{if(!parseInt(A)&&(!G||!G.replace(/[\s]/gi,"").length)){t="Enter the name of the license holder in the Attribution field"}else{var c=(E["fd[src_url]"].value+"");if(!c||c=="http://"){E["fd[src_url]"].value=""}if(E.upl_button){E.upl_button.disabled=true}E.img.upload_form(E,{start_time:new Date().getTime(),selimg:this.imgUplOpt.selimg,afu:E.afterUpload,ltel:gebi("upload_img_frm_status")})}}}}}if(t){djp.error(t)}return false});q.show()},upload:function(a){if(typeof(a)!="object"||!a){a={}}if(!djp.user.is_loggedin()){djp.user.show_login_form({signup:1});return}var b=new DJImage();b.upload_panel(a)},getDBUrl:function(){if(this.id){return"/info/type/img/"+this.id+"?rndint"+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"djimg")},updatefromdb:function(b,a){this.updateFromDB(b,a)}};YAHOO.lang.augmentProto(DJImage,DJIHaveUser);YAHOO.lang.augmentProto(DJImage,DJIDBUpdate);var DJTopic=function(d,c){var b=this,a=parseInt(d);if(c){b.cfg=djp.clone(c,1)}else{b.cfg={}}b.init();if(a){b.id=a}else{if(d){b.tag=d}}};DJTopic.prototype={toString:function(){return"Topic["+this.id+"]"},init:function(){djp.clonecopy(this,{id:0,tag:"",pop:0});if(this.cfg.xml){this.from_xml(this.cfg.xml)}},from_xml:function(e,d){var g=this,h=function(l,k){return parseInt(l.getAttribute(k))},a=function(l,k){return parseFloat(l.getAttribute(k))},b=function(l,k){return djp.get_xmlnodeval(djp.gebtn(l,k)[0],1)};if(d){if(d.a){g.album=d.a}}if(!e){return}djp.clonecopy(g,{id:h(e,"id"),hidden:h(e,"hidden"),pointers:djp.gebtn(e,"pointers")[0],true_tag:djp.gebtn(e,"truetag")[0],tag:djp.get_xmlnodeval(e,1)},1);if(g.pointers){var j=djp.gebtn(g.pointers,"djtag");g.pointers=[];for(var c=0;c<j.length;c++){var e=new DJTopic();e.from_xml(j[c]);g.pointers.push(e)}delete j}if(g.true_tag){g.true_tag=djp.gebtn(g.true_tag,"djtag")[0];if(g.true_tag){var e=new DJTopic();e.from_xml(g.true_tag);g.true_tag=e}}},tt_link:function(){return'<a href="/topic/'+this.tag+'" tagid="'+this.id+'" class="tag" onmouover="djp.user.tt(this,event,{ id:parseInt(\''+this.id+"', tag:'"+this.tag+"')});\">"+this.tag+"</a>"},to_html:function(){var b='<form action="/edit/topic-save-'+this.id+'" method="post" onsubmit="try{ djp.ajax.formSubmit(this,{submit_mode:\'EO\', form:this, onAfterSave:this.afterSaveFn?this.afterSaveFn:null});}catch(err){ alert(err);}return false;"><table cellpadding=5 cellspacing=0 border=0>';b+="<tr><th class=small>Tag</th><td class=h3>"+this.tag;b+=' <a href="" class=small onclick="var cls=\'invis\',n=this.parentNode.lastChild;if(n){ if(Dom.hasClass(n,cls))Dom.removeClass(n,cls);else Dom.addClass(n,cls);}return false;">Change</a>';b+='<span class=invis> &nbsp; <input size=12 type="text" value="'+this.tag+'" onkeydown="" name="fd[new_tag]"/></span></td></tr>';b+="<tr><th class=small><span class=nowrap>True Tag</span></th>";b+="<td>"+(this.true_tag?this.true_tag.tt_link():"<i>[none]</i>")+"</td></tr>";if(this.pointers){var d=[],c=this.pointers;for(var a=0;a<c.length;a++){d.push(c[a].tt_link())}b+="<tr><th class=small>Pointers</th><td>"+d.join(", ")+"</td></tr>"}b+='<tr><th class=small>Hidden</th><td><input type=checkbox name="fd[hidden]" value=1 '+(this.hidden?"checked ":"")+"/></td></tr>";b+='<tr><td colspan=2 class=tar><input type="submit" value="Update" class=small onclick="this.form.onsubmit();return false;" /></td></tr>';b+="</table></form>";return b},getDBUrl:function(){if(this.tag||this.id){return"/info/type/page/topic?"+(this.id?"tid="+this.id:(this.tag?"tag="+this.tag:""))+(djp.user.is_staff()?"&get_pointers=1":"")+"&rndint="+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"djtag")}};YAHOO.lang.augmentProto(DJTopic,DJIDBUpdate);var DJAlbum=function(a,b){this.init();if(b){this.cfg=djp.clone(b,1)}else{this.cfg={}}if(!this.cfg.show){this.cfg.show={}}this.from_xml(a,this.cfg)};DJAlbum.prototype={toString:function(){return"Album["+this.id+"]"},uce:function(a){return(a.has_perm(16)||a.get_id()==this.uid)},init:function(){var a=this;a.t=0;a.id=0;a.imgid=0;a.ac=0;a.imgnum=0;a.name="";a.widget=null;a.cur_page=0;a.imgs=null;a.imgs_sel=null;a.imgs_tgt="";a.cfg=null},dataurl:function(b,c){return"/info/type/app/mypics?suba=imgs"+(b.cfg.allow_narrow?"&allow_narrow=1":"")+"&albid="+b.id+"&rndint="+djp.rndint()+"&p="+this.cur_page},icon_url:function(){return"/images/folder.gif"},t2str:function(){switch(this.t){case 2:return"Private";case 1:return"Public";case 3:return"Article";default:return"Unknown"}},add_sel_slider:function(b){if(!b||!b.tgt){return}var a=gebi(b.tgt);if(a){a.innerHTML=""}if(!a){a=gebi(b.otgt);if(a){a=a.parentNode}else{a=null}}if(!a){return}a.appendChild(this.to_html({pw:[75,75],tgt:b.tgt,l:"slider",imgs:this.imgs_sel}))},compupdate:function(a){var b=null,c=this;if(a){b=c.cfg.ui_o;c.cfg.ui_o=a}var d=function(){this.update_imgs(this.cfg.ui_o)};if(!c.updateFromDB(d)){d.call(c)}if(b){c.cfg.ui_o=b}},getDBUrl:function(){if(this.id){return"/info/type/imgset/"+this.id+"?rndint"+djp.rndint()}},getDBXml:function(a){return djp.get_xmlnode(a,"imgset")},updatefromdb:function(b,a){this.updateFromDB(b,a)},to_html:function(q){var o=this;var b=djp.dce;if(!q){q={}}if(!q.canedit){q.canedit=o.uce(djp.user)}if(!q.show){q.show={}}if(!q.hide){q.hide={}}if(typeof(q.hide.cbs)=="undefined"){q.hide.cbs=!q.canedit}var z="";switch(q.l){case"slider":var T=o;var C=q.imgs||this.imgs;var m=false;for(var O in C){m=true;break}if(!m){z=b("div");if(o.cfg.show.add_img){if(!djp.user.is_loggedin()){o.cfg.add_img_f=function(a){djp.user.show_login_form({signup:1});return false}}sc(z,"tac");z.innerHTML='<a href="" style="text-decoration:none;" onclick="this.add_f(this.add_f_opt);return false;"><img src="/images/big-camera.gif" width="100"  border=0 /><br/>Add Image&#187;</a>';var T=z.firstChild;T.add_f=o.cfg.add_img_f;T.add_f_opt={alb:o,aid:o.cfg.aid,bid:o.cfg.bid}}}else{var G=b("TABLE");G.cellPadding=0;G.cellSpacing=0;sc(G,"alb_sldr");var d=2;if(q.ncol){d=parseInt(q.ncol)}var s=0;if(o.cfg.paging){s=o.cfg.paging.num_p}else{s=Math.ceil(o.imgnum/d)}var I=o.cfg.tgt_el;if(!I&&o.cfg.tgt){I=gebi(o.cfg.tgt)}if(!I&&q.tgt){I=gebi(q.tgt)}I=Dom.getRegion(I).width;var l=[Math.max(10,Math.floor(I/d)),100];if(q.pw){if(q.pw[0]!=0){l[0]=q.pw[0]}if(q.pw[1]!=0){l[1]=q.pw[1]}}var L=q.nozoom?0:1;var n=djp.clone(q,1),H=G.insertRow(-1);num_header_col=0;if(!q.hide.toprow){var S;if(o.name&&q.show.name){S=H.insertCell(-1);S.innerHTML=o.name;num_header_col++}if(o.cfg.add_img_f&&(o.ac||q.canedit)&&djp.user.is_loggedin()){S=H.insertCell(-1);num_header_col++;sc(S,"imp");S.innerHTML='<a href="" class=nodecor title="Add another image"><span style="color:#cc1100;font-size:16px;" class="imp">+</span> Add Image</a>';if(q.canedit&&o.id&&!o.t){var Q=b("a");sc(Q,"invrs");Q.album=o;Q.href="";Q.onclick=function(){this.album.edit();return false};Q.innerHTML="Edit&#187;";S.insertBefore(Q,S.firstChild)}var D=S.lastChild;D.add_f=o.cfg.add_img_f;D.add_f_opt=djp.clone(o.cfg,1);D.add_f_opt.alb=o;D.onclick=function(){if(djp.user.is_loggedin()){this.add_f(this.add_f_opt)}else{djp.user.show_login_form({signup:1})}return false}}if(s>1){S=H.insertCell(-1);num_header_col++;sc(S,"small");S.innerHTML="&nbsp;"+(o.cur_page+1)+(s?" of "+s:"")+"&nbsp;"}if(o.cur_page||s!=1){S=H.insertCell(-1);num_header_col++;sc(S,"tar nowrap");if(o.cur_page){S.innerHTML='<a href="" class="albspan" title="Previous image"><i class="icon icon-circle-arrow-left"></i></a> ';var D=S.firstChild;D.onclick=function(){o.cur_page=Math.max(0,o.cur_page-1);o.update_imgs(n);return false}}if(s!=1){var D=djp.dce("a");D.href="";sc(D,"albspan");D.title="Next image";D.innerHTML='<i class="icon icon-circle-arrow-right"></i>';D.onclick=function(){o.cur_page=(o.cur_page+1)%s;o.update_imgs(n);return false};if(o.cur_page){S.appendChild(djp.dct("\u00A0"))}S.appendChild(D)}}}if(!num_header_col){G.deleteRow(-1)}var H=G.insertRow(-1),e=0,u=null,K=H.insertCell(-1),w=djp.dce("table");for(var O in C){u=C[O];break}H.vAlign="top";K.colSpan=Math.max(1,num_header_col);K.overlayCutline=w;K.djImg=u;K.onmouseover=function(c){var a=this.djImg;a.album.curdetpopup=djp.user.tt(this,c,{t:"image_details",id:a.id,image:a,wopt:{contents:this.overlayCutline}})};w.cellPadding=0;w.cellSpacing=0;w.width="100%";var x=w.insertRow(-1);for(var O in C){var S=x.insertCell(-1);var J=C[O];J.album=o;K.appendChild(J.to_html({align:"center",l:"alignable",pw:l,nozoom:!L}));var y=K.lastChild.imgdiv;S.style.padding="5px";if(!q.hide.botrow){if(q.show.du){var Q=b("div");sc(Q,"small tac");var g=djp.parseMysqlDate(J.du);Q.innerHTML=djp.datef(g);S.appendChild(Q)}if(q.show.cl&&(J.title||J.descr)){var Q=b("div");sc(Q,"imp");Q.innerHTML=J.descr?J.descr:J.title;S.appendChild(Q)}var N=[],E=djp.user;if(!q.hide.cbs&&o.id&&E.is_loggedin()&&(E.get_id()==o.uid||E.is_staff())){var P=b("a");P.href="";P.innerHTML="Remove image";P.tag=J;P.onclick=function(){var a=djp.clone(q,1);delete a.tgt;a.quiet=1;a.onAfterSave=function(h){var c=h.argument[1];if(c.imgnum==1){c.id=0}c.cur_page=0;c.compupdate(h.argument[0])};djp.editobj("imgset","remimg",o.id,{handlers:{argument:[a,this.tag.cfg.a]},vals:{imgid:this.tag.id}});return false};N.push(P);if(o.imgid&&Math.abs(o.imgid)!=J.id){var P=b("a");P.href="";P.innerHTML="Make default";P.tag=J;P.onclick=function(){var a=djp.clone(q,1);delete a.tgt;a.quiet=1;a.onAfterSave=function(h){var c=h.argument[1];c.imgid=h.argument[2].id;c.cur_page=0;c.update_imgs(h.argument[0])};djp.editobj("imgset","img",o.id,{handlers:{argument:[a,this.tag.cfg.a,this.tag]},vals:{imgid:this.tag.id}});return false};N.push(P)}}if(N.length){var Q=b("div");sc(Q,"small tac p");for(var M=0;M<N.length;M++){if(M){Q.appendChild(djp.dct(" - "))}Q.appendChild(N[M])}S.appendChild(Q)}}if(++e>=d){break}}if(q.canedit&&o.id&&!q.hide.allowc&&!q.hide.botrow){var Q=djp.dce("div");sc(Q,"tac small");Q.innerHTML='<input align=absmiddle type=checkbox value="1" name="allow_c"'+(o.ac?" checked ":"")+" /> Allow others to contribute images<div></div>";var B=Q.firstChild;B.alb=o;B.stgt=Q.lastChild;B.onclick=function(){var c=this.alb;djp.editobj("imgset","allow_c",c.id,{tgt:this.stgt,vals:{allow:this.checked?1:0},album:c,allow_contrib:this.checked,onAfterSave:function(a){a.argument[0].album.ac=a.argument[0].allow_contrib}})};S.appendChild(Q)}var I=djp.dce("div"),F;I.style.padding="0px 2px 2px 2px";S.appendChild(I);S=I;S.djByOwner=J.uploadedByOwner();S.djAttr=S.djByOwner?"":(J.attr||"");F=[(J.attr||S.djByOwner)&&!q.hide.attr,!q.hide.rate];if(F[0]||F[1]){var Q=b("div");Q.style.padding="5px 2px 2px 2px";sc(Q,"tar");S.appendChild(Q);if(F[0]){Q.innerHTML='<div class="small flleft tal" style="width:50%;margin-right:5px;"></div>';var j=Q.firstChild;if(S.djByOwner){j.innerHTML="<div class=small>"+djp.loading_text()+"</div>";J.loadUser(function(c){c.innerHTML="";c.appendChild(this.to_html())},j)}else{j.innerHTML=S.djAttr}}if(F[1]){var R=djp.dce("span");R.innerHTML="image:"+J.id+":"+J.rating+":"+(J.hasvoted?1:0)+":"+(J.uid==djp.user.get_id()?1:0);Q.appendChild(R);djp.votebtn(R,{compact:true})}}z=G}break;case"popup":z=new DJPanel("album-popup",{width:"400px",fixedcenter:true,visible:false,constraintoviewport:true,modal:true});z.setHeader("Album: "+o.name);z.setBody(o.to_html({l:"slider"}));z.render(djp.loadtgt());z.show();break;case"simple":z=b("span");var T=b("a");T.href="";T.album=o;T.onclick=function(){var a=this.album.to_html({l:"popup"});return false};T.target="_blank";T.innerHTML=o.name;z.appendChild(T);z.appendChild(djp.dct(" - "));T=b("a");T.href="";T.album=o;T.onclick=function(){var c=this.album;c.upload_image();return false};T.innerHTML="add";z.appendChild(T);break;default:var G=b("table");var A=q.odd?"odd":"even";sc(G,A);G.cellPadding=2;G.cellSpacing=0;G.width="100%";var H=G.insertRow(-1);var S=H.insertCell(-1);S.width=24;S.style.padding=0;if(o.favimg){S.appendChild(o.favimg.to_html({l:"compact",align:"center",pw:[48,24]}))}else{S.innerHTML="&nbsp;"}var S=H.insertCell(-1);S.width=16;S.innerHTML='<img src="'+o.icon_url()+'" title="'+o.t2str()+' Album" border=0 />';var S=H.insertCell(-1);sc(S,"nimp");var v=b("a");v.onclick=function(){var c="alb-"+o.id+"-imgs";var a=gebi(c);if(a&&a.innerHTML){a.innerHTML=""}else{o.update_imgs({tgt:c,show:{cbs:1}})}return false};v.href="";sc(v,"h4");v.innerHTML=o.name;S.innerHTML=", "+o.imgnum+" images"+(o.kw?" - <small>"+o.kw+"</small>":"");S.insertBefore(v,S.firstChild);if(o.id&&o.ac){var S=H.insertCell(-1);sc(S,"tar");var v=b("a");v.href="";v.onclick=function(){o.edit();return false};v.innerHTML="edit";S.appendChild(v);S.appendChild(djp.dct(" | "));var v=b("a");v.href="";v.onclick=function(){o.select_image();return false};v.innerHTML="add&#187;";S.appendChild(v)}var Q=b("div");Q.innerHTML='<div id="alb-'+o.id+'-imgs" class="'+A+'"></div>';Q.insertBefore(G,Q.firstChild);z=Q}return z},handle_update_imgs:function(j){var c=j.argument[0];var b=c.widget;var h=j.argument[1];c.imgs={};if(!h){h={}}if(!h.show){h.show={}}if(j.responseXML){c.cfg.paging=djp.parse_paging(djp.get_xmlnode(j.responseXML,"Paging"));var d=djp.gebtn(j.responseXML,"djimg");if(!d.length&&c.cur_page){c.cur_page=0;c.update_imgs(h)}c.parse_imgs(d);if(!h.l){h.l="slider"}var g=c.to_html(h),e=h.tgt_el||gebi(h.tgt);if(e){e.innerHTML="";e.appendChild(g)}else{if(b){b.setBody(g)}else{alert("cannot find rendering target for the slider")}}}else{alert("Received invalid data")}},add_img:function(a,b,c){djp.editobj("imgset","addimg",this.id,{handlers:{argument:[{quiet:1,onAfterSave:function(j){var e=j.argument[1];var d=j.argument[2];var g=j.argument[3];var h=j.argument[4];e.id=j.scode;if(g){g(j,h)}}},this,a,b,c]},vals:{imgid:a.id,tid:this.t}})},get_img:function(c,a){var b=this;if(b.imgid){b.img=new DJImage(null,{a:b});b.img.id=Math.abs(b.imgid);b.img.updatefromdb(c,a)}else{if(b.id){djp.ajax.grab("/info/type/imgset/img?id="+b.id,{argument:[b,c],success:function(g){var e=djp.get_xmlnode(g.responseXML,"djimg");if(e){var d=g.argument;d[0].img=new DJImage(e,{a:d[0]});if(d[1]){d[1](d[0])}}else{alert(g.responseText)}},failed:function(d){alert("failed "+d.responseText)}})}else{alert("no image in "+b.name)}}},parse_imgs:function(b,e){var d=this;d.imgs={};if(!e){e={}}if(!e.a){e.a=d}if(!e.w&&d.widget){e.w=d.widget}for(var c=0;c<b.length;c++){var a=new DJImage(b[c],e);d.imgs[a.id]=a}},update_imgs:function(d){var c=this;if(c.curdetpopup){c.curdetpopup.hidePP()}if(!d){d={}}var a={success:c.handle_update_imgs,argument:[c,d]};if(d.cb){var e=a.argument;if(d.cb.argument){for(var b in d.cb.argument){e.push(d.cb.argument[b])}}}djp.ajax.grab(c.dataurl(c,d),a)},select_image:function(b){var a=this.selimgs;if(!a){a=new DJSelImgs({onselect:function(d,c){if(d.length){if(typeof(c[1])!="function"){c[1]=null}c[0].add_img(d[0],c[1],c[0]);c[0].compupdate()}},args:[this,b.afs]})}a.show();if(a!=this.selimgs){this.selimgs=a}},upload_image:function(){var a=new DJImage(null,{a:this,w:this.widget});a.upload()},from_xml:function(a,b){var c=this;c.imgs_sel={};if(!b){b={}}if(b.w){c.widget=b.w}if(b.dataurl){c.dataurl=b.dataurl}if(b.tgt){c.imgs_tgt=b.tgt}if(!a){return}c.id=a.getAttribute("id");c.uid=a.getAttribute("uid");c.imgid=a.getAttribute("imgid");c.imgnum=parseInt(a.getAttribute("imgnum"));if(isNaN(c.imgnum)){c.imgnum=0}c.ac=parseInt(a.getAttribute("ac"));if(isNaN(c.ac)){c.ac=0}c.t=parseInt(a.getAttribute("t"));if(isNaN(c.t)){c.t=0}c.name=djp.get_xmlnodeval(djp.gebtn(a,"name")[0],1);c.kw=djp.get_xmlnodeval(djp.gebtn(a,"kw")[0],1);var d=djp.get_xmlnode(a,"favimg");if(d){c.favimg=new DJImage(djp.get_xmlnode(d,"djimg"))}},del:function(b){if(!b){b={}}var a=this;if(a.id){if(confirm("Are you sure you would like to delete this album?")){djp.editobj("imgset","delete",a.id,{quiet:1,tgt:b.tgt,onAfterSave:b.afs})}}},save:function(c,d){d.vals={id:c.album_id.value,type_id:c.tid.value,name:c.album_name.value,allow_contrib:c.album_allow_contrib.checked?1:0,kw:c.album_kw.value};var b=this;if(b.panel){d.close_panel=b.panel}var a=djp.clonecopy(d,{onAfterSave:function(e){if(d.afterSave){d.afterSave(e)}setTimeout(function(){if(e.close_panel){e.close_panel.destroy()}},1000)}},1);djp.editobj("imgset",d.vals.id?"save":"create",d.vals.id,a)},edit:function(e){if(!e){e={}}if(!e.a){e.a=this}if(!e.tgt){e.tgt="crt_alb_status"}var b=e.a;var d=e.panel?e.panel:new DJPanel(b.id+"-edit-album-p",{centerinviewport:true,fixedcenter:true,width:"350px",visible:false,modal:true,close:true});b.panel=d;if(b.name){d.setHeader("Edit Album: "+b.name)}else{d.setHeader("Create New Album")}var c=djp.dce("form");c.method="post";c.onsubmit=function(){try{djp.console("album save",e);b.save(this,djp.clonecopy(e,{afterSave:e.asf}))}catch(a){alert("Album action failed")}return false};c.innerHTML='<table width="100%" cellpadding=5 cellspacing=0 border=0 ><tr class=odd><th>* Album name</th><td><input style="width:180px;" type=text name=album_name value="'+(b.name?b.name:"")+'"/></td></tr>				<tr><th>Keywords</th><td><input style="width:180px;" type=text name=album_kw value="'+(b.kw?b.kw:"")+'"/></td></tr>				<tr class=odd><th>Allow contributions</th><td><input type="checkbox" name="album_allow_contrib" value="1" '+(b.ac?"checked ":"")+"/></td></tr>				<tr><td>"+(b.id?'<a href="" onclick="var a=new DJAlbum();a.id='+b.id+";a.del({afs:function(){ var url='/';if(document.referrer)url=document.referrer;djp.gotourl(url); },tgt:'+o.tgt+'});return false\" class=imp>Delete Album</a>":"&nbsp;")+'</td><td class=tar>* - required &nbsp;<input class="fancy-button" type=submit value="'+(b.id?"Save Changes":"Create")+'" /></td></tr>				</table><div id="crt_alb_status"></div><input type=hidden name=album_id value="'+(b.id?b.id:"")+'" /><input type=hidden name=tid value="'+b.t+'" />';d.configClose("onclose",function(){djp.console("close clicked",arguments)});d.setBody(c);d.render(djp.loadtgt());d.show();return d}};YAHOO.lang.augmentProto(DJAlbum,DJIDBUpdate);var DJWidget=function(d,g,c,b){var e=this;e.w_id=g;e.column=c;var h=djp;e.url_props={};e.wcfg=h.clone(e.presets.def);e.hist_vars={};h.clonecopy(e.wcfg,djp.widgets[g]);e.wcfg.col_index=d;if(b){h.clonecopy(e.wcfg,b)}if(!e.wcfg.hide){e.wcfg.hide={}}if(c&&c.layout){c.layout.resumeEvent.subscribe(function(k,j){if(j.wcfg.paused){j.update()}},e)}e.djShowEvent=new YAHOO.util.CustomEvent("show-w",e,1,YAHOO.util.CustomEvent.FLAT);e.djHideEvent=new YAHOO.util.CustomEvent("hide-w",e,1,YAHOO.util.CustomEvent.FLAT);e.updateEvent=new YAHOO.util.CustomEvent("update-w",e,1,YAHOO.util.CustomEvent.FLAT);e.afterUpdateEvent=new YAHOO.util.CustomEvent("after_update-w",e,1,YAHOO.util.CustomEvent.FLAT);e.optionsLoadedEvent=new YAHOO.util.CustomEvent("optionsLoaded",e,1,YAHOO.util.CustomEvent.FLAT);DJWidget.superclass.constructor.call(e,e.get_html_id(),e.wcfg);e.updateEvent.subscribe(e.handlers.update_f);e.djShowEvent.subscribe(function(j,l){j.setHeader(djp.widgets[j.get_id()].name);j.setBody("");var k=j.column.get_el();j.render(k);j.show();Dom.addClass(j.get_el(),"djm djm_"+j.get_id()+(j.column&&j.column.cfg.nocustom?" nocustom":""));if(!j.column||!j.column.cfg.nocustom){j.dd=new DJDD(j,"apps")}j.move_to(j.column,j.wcfg.col_index)},djp);e.djHideEvent.subscribe(function(j,k){j.column.del_w(j)},djp);if(!e.register_hist()){var a=function(){e.djShowEvent.unsubscribe(a);e.update()};e.djShowEvent.subscribe(a)}};YAHOO.lang.extend(DJWidget,YAHOO.widget.Module,{w_id:0,cur_page:0,column:null,wcfg:null,dd:null,sched_update:null,presets:{def:{visible:false}},handlers:{update_f:function(a,b){a.update()}},register_hist:function(){var a=this,b=this.get_id();return djp.ajax.history.register(b,{onstatechange:function(c){if(c!=a.prev_state&&(c||a.prev_state)){a.apply_hist_vals(djp.decuri(c));a.updateEvent.fire(a);a.prev_state=c}},onready:function(){var c=djp.decuri(YAHOO.util.History.getCurrentState(a.get_id()));if(c){a.apply_hist_vals(c)}if(c||!a.wcfg.hist_skip_onready){a.updateEvent.fire(a)}}})},apply_hist_vals:function(a){var d=parseInt(djp.qsval("lim",a)),c=parseInt(djp.qsval("p",a)),b=this;if(!isNaN(c)&&b.cur_page!=c){b.cur_page=c}if(!isNaN(d)&&d&&b.get_cfg_val("lim")!=d){b.set_cfg_val("lim",d,true)}},spanclick:function(b){if(typeof(b)!="object"){return false}var a=this;if(b.p){a.cur_page=parseInt(b.p)}else{a.cur_page+=parseInt(b.d)}a.cur_page=Math.max(0,a.cur_page);if(a.wcfg.fs){djp.spanclick(b)}else{a.update({nav_hist:1})}return false},get_id:function(){return this.w_id},get_html_id:function(){return"dj-m-"+this.get_id()},get_el:function(){return this.element},hit:function(c){var b=this.get_el();var a=Dom.getY(b);var d=((b&&b.clientHeight)?b.clientHeight:0);if(!d){alert(b+" no el height, el_y: "+a)}else{if(c[1]-a<d/2){return[0,1]}else{return[0,-1]}}},move_to:function(g,b){var j=this.column!=g;if(b!=this.wcfg.col_index||j){if(j){this.setBody("")}var h=g.get_el().lastChild;if(!h||h.className.match(/\byui-module\b/)||h.className.match(/\bdjms\b/)){h=null}g.get_el().insertBefore(this.get_el(),(b<g.w.length?g.w[b].get_el():h));this.column.w.splice(this.wcfg.col_index,1);if(g==this.column&&b>this.wcfg.col_index){b--}g.w.splice(b,0,this);this.column.uwci();if(g!=this.column){var d=this.column.layout.get_id(),e=this.column.get_id();if(djp.user.cfg.l[d]){var k=djp.user.cfg.l[d][e];var l=this.get_id();var a=g.get_id();if(k&&k[l]){if(!djp.user.cfg.l[d][a]){djp.user.cfg.l[d][a]={}}djp.user.cfg.l[d][a][l]=k[l];delete k[l]}}this.column.sync_usr_cfg();this.column=g;g.uwci()}this.column.sync_usr_cfg();this.update()}else{return false}return true},form_url:function(e){var h=this;if(!e){e={}}var b={};djp.clonecopy(b,h.wcfg);djp.clonecopy(b,e);var d=(b.fs?"/w/":"/info/type/app/")+h.get_id();var g={};if(!b.fs){g.rndint=djp.rndint();var a=h.get_cfg_val("lim");if(a){g.lim=a}if(h.wcfg.doauth){g.doauth=1}}if(!g.p&&h.cur_page){g.p=h.cur_page}d=djp.replaceinhref(g,null,d);for(var c in h.url_props){var j=h.url_props[c];if(j){d+=(djp.urlhasqs(d)?"&":"?")+c+"="+djp.encuri(j)}}return d},form_hist:function(a){var b=this;return djp.replaceinhref({p:b.cur_page,lim:b.get_cfg_val("lim")},0,a)},showing_opt:function(){return this._showing_opt?true:false},show_opt:function(){var a=this;if(!a.wcfg.jsoptc&&!a.wcfg.hasopt){djp.status("This widget doesn't have options.","info")}else{if(!a.showing_opt()){a._showing_opt=1;a.update();a.pause()}else{djp.status('Already showing the widget options. <a href="" onclick="var w=djp.get_w(\''+a.get_id()+"');w.hide_opt();return false;\">Hide options</a>","info")}}},hide_opt:function(){var a=this;a._showing_opt=0;a.resume();djp.scrollTo(a.get_el());if(a.wcfg.hasoptfile){a.setUrlProp("options",0)}a.cur_page=0;a.update()},pause:function(){this.is_paused=1},resume:function(){this.is_paused=0},update:function(b){var c=this;if(c._showing_opt){if(typeof(c.wcfg.jsoptc)=="string"){djp.load_js("/js/"+c.get_id()+"_opt.js?rnd="+djp.rndint(),"djw_"+c.get_id()+"_opt",c,function(e){this.optCls=e;this.optionsLoadedEvent.fire()})}if(c.wcfg.hasoptfile){c.setUrlProp("options",1)}else{return}}if(typeof(b)!="object"){b={}}if(c.sched_update){clearTimeout(c.sched_update);c.sched_update=0;singleShot=0}if(b.nav_hist){var d=c.form_hist(djp.replaceinhref(c.hist_vars,0,"/"));if(d.length>2){return YAHOO.util.History.navigate(c.get_id(),d.substring(2))}}var a=c.form_url();if(c.wcfg.fs){djp.gotourl(a)}else{if(!c.body){c.setBody(djp.loading_text())}Dom.addClass(c.get_el(),"loading");djp.ajax.grab(a,{success:function(m){var g=m.argument[0];var k=g.get_el();var l=djp.widgets[g.get_id()].header_opt||{};l.rr=g.wcfg.rr;if(g.column){g.wcfg.paused=this.is_paused||(new Date().getTime()-g.column.layout.last_mm)>(g.column.layout.cfg.to_mm*1000)}l.paused=g.wcfg.paused?1:0;var e=m.responseXML;if(m.responseText&&!e){if(!g.wcfg.hide.header){g.setHeader()}g.setBody(m.responseText)}else{if(e){var j=e.getElementsByTagName("Module")[0];if(j&&k){g.parseModuleXML(j);if(!g.wcfg.hide.header){g.setHeader(g.mod_name,l)}Dom.removeClass(g.get_el(),"loading");g.setBody(g.mod_cnt)}}}var h=g.get_cfg_val("rr");if(h&&!l.paused&&k){g.sched_update=setTimeout(function(){g.updateEvent.fire(g)},h*1000)}g.afterUpdateEvent.fire(g)},argument:[c]})}},parseModuleXML:function(j){var h=this,e=h.get_el(),a=djp.get_xmlnodeval,g=djp.get_xmlnode,k=g(j,"Content");h.mod_cnt=a(k,1);if(h.showing_opt()){h.mod_name=djp.widgets[h.get_id()].name+": Options"}else{var b=a(g(j,"Name"),1);if(b){h.mod_name=b}}h.mod_te=a(g(j,"Debug"),1);var c=g(j,"Debug"),d=g(j,"Paging");if(c){h.mod_te=c.getAttribute("elapsed")}if(d){h.paging=djp.parse_paging(d)}},close:function(){this.djHideEvent.fire(this)},editwobj:function(b,c){if(!c){return}if(!c.handlers){c.handlers={success:djp.handlers.successEO,failure:djp.handlers.failedEO,argument:[c,this]}}djp.editobj("app",b,this.get_id(),c)},getUrlProp:function(a){return this.url_props[a]},setUrlProp:function(b,a){this.url_props[b]=a},set_cfg_val:function(h,g,a,e){if(typeof(h)=="object"){var c,d;for(var b in h){this.set_cfg_val(b,h[b],1,null);c=b;d=h[b]}if(!a&&c){this.set_cfg_val(c,d,0,e)}else{e()}}else{if(!this.column||(this.column.cfg&&this.column.cfg.nocustom)){a=1}djp.user.set_wcfg_prop(this,h,g,a,e)}},get_cfg_val:function(a){var k=this,g=0,b=k.get_id(),d=k.getUrlProp(a);if(d){return d}var h=this.column?this.column.get_id():0;if(h){g=this.column.layout.get_id()}if(g&&h){var e=djp.user.cfg.l[g];var j=null,m=null;if(e){j=e[h]}if(j){m=j[b]}if(m&&typeof(m[a])!="undefined"){return m[a]}}return this.wcfg[a]}});DJWidget.prototype.setBody=function(q){var k=this,m=k.wcfg,c=k.paging;var j=!m.hide.paging&&c&&c.num_p>1;DJWidget.superclass.setBody.call(this,q+((m.hasfs||j)?'<div id="wfooter_'+k.get_id()+'" class="h4 tar" style="padding:3px 5px;">'+(j?'<div class="tar" style="padding-bottom:3px;"></div>':"")+((m.hasfs&&!m.fs&&!m.fakefs)?(m.learnmore?'<a href="'+m.learnmore+'" class=editfld>Learn More</a> | ':"")+(!m.skip_more_link?'<a href="'+(m.fsurl?m.fsurl:djp.replaceinhref("p",0,this.form_url({fs:1})))+'" class=editfld>'+(m.fstxt?m.fstxt:"More "+m.name)+"&#187;</a>":""):"")+"</div>":""));if(j){var o=k.body.lastChild.firstChild,b=k.paging,a=Ev;var h=3,l=Math.max(0,b.p-h),e=Math.min(b.num_p,b.p+h);var g="",n=function(r){return'<a href="#" onclick="if(event)event.preventDefault();return false;" class=span>'+r+"</a>"};if(b.p){g+=n("&#171;Back")+(l?" "+n(1)+" ... ":"")}if(b.num_p>1){for(var d=l;d<e;d++){g+=(d!=b.p?" "+n(d+1):" <span class=span_sel>"+(d+1)+"</span>")}}if(b.p+1<b.num_p){g+=(e+1<b.num_p?" ... "+n(b.num_p):"")+" "+n("Next&#187;")}o.innerHTML=g;Dom.getElementsBy(function(){return true},"a",o,function(r){Ev.addListener(r,"click",function(t,s){djp.w_spanclick(this,s)},k)})}};DJWidget.prototype.setHeader=function(d,a){var g=[],e=this;if(!d){d=djp.widgets[e.get_id()].name}if(!a){a={}}if(a.hd_opt&&a.hd_opt.length){for(var c=0;c<a.hd_opt.length;c++){g.push(a.hd_opt[c])}}if(djp.user.is_admin()&&e.mod_te){g.push('<span class="small">'+e.mod_te+"s</span>")}if(a.paused){g.push("Paused")}if(e.wcfg.hasopt){g.push('<button class="fancy small" onclick="var w=djp.get_w(\''+e.get_id()+"');w.show_opt();return false;\">"+e.wcfg.hasopt+"</button>")}if(!e.column||!e.column.cfg||!e.column.cfg.nocustom){g.push('<a href="" onclick="var w=djp.get_w(\''+e.get_id()+'\');w.close();return false;"><img src="/images/close.gif" border=0 align=absmiddle title="Close this widget" /></a>')}var h='<table width="100%" cellspacing=0 cellpadding=1 border=0><tr>'+(e.wcfg.icon?'<td width=16 class="icon"><img src="'+e.wcfg.icon+'" border=0 /></td>':"")+'<td class="hdl">'+(e.wcfg.hasfs?'<a href="'+(e.wcfg.fsurl?e.wcfg.fsurl:e.form_url({fs:1}))+'">'+d+"</a>":d)+'</td><td class="hdr">'+g.join(" ")+"</td></tr></table>";DJWidget.superclass.setHeader.call(e,h);var b=djp.gebtn(e.header,"a");for(var c=0;c<b.length;c++){b[c].style.cursor="pointer"}};var DJPrWidget=function(c,d,b,a){DJPrWidget.superclass.constructor.call(this,c,d,b,a);if(a.lnk_target){this.setUrlProp("lnk_tgt",a.lnk_target)}};YAHOO.lang.extend(DJPrWidget,DJWidget,{});var DJAssignmentsWidget=function(d,g,b,a){var e=this,c=djp.assignment(),h=function(){e.update()};DJAssignmentsWidget.superclass.constructor.call(e,d,g,b,a);c.assignmentStatusChanged.subscribe(h);c.assignmentSaved.subscribe(function(){var j=gebi("edit_assignment_div");if(j){e.resume();Dom.addClass(j,"invis")}e.update()});c.assignmentDeleted.subscribe(h)};YAHOO.lang.extend(DJAssignmentsWidget,DJWidget,{update:function(a){var b=gebi("edit_assignment_div");if(!b||b.className.match(/\binvis\b/)){DJAssignmentsWidget.superclass.update.call(this,a)}else{this.pause()}},setHeader:function(b,c){var a={};djp.clonecopy(a,c||{},1);if(!a.hd_opt){a.hd_opt=[]}if(djp.user.is_staff()){a.hd_opt.push('<button class="fancy-button no-shadow small" href="" onclick="djp.edit_assignment();return false;">New Assignment</button>')}DJAssignmentsWidget.superclass.setHeader.call(this,b,a)}});var DJNewsindexWidget=function(c,d,b,a){DJNewsindexWidget.superclass.constructor.call(this,c,d,b,a);this.afterUpdateEvent.subscribe(this.afterUpdate,this)};YAHOO.lang.extend(DJNewsindexWidget,DJWidget,{apply_hist_vals:function(a){DJNewsindexWidget.superclass.apply_hist_vals.call(this,a);var b=djp.qsval("ni",a);if(b!=this.get_cfg_val("ni")){this.set_cfg_val("ni",b,true)}var c=djp.qsval("depname",a);if(c!=this.get_cfg_val("depname")){this.set_cfg_val("depname",c,true)}},getNI:function(){var a=this.get_cfg_val("ni");a=(a?a+"":"").toLowerCase();if(a){a=(a+"").replace(/[^a-z0-9]/g,"")}if(!a||a=="top"){a=""}return a},form_hist:function(a){a=DJNewsindexWidget.superclass.form_hist.call(this,a);return djp.replaceinhref({ni:this.getNI(),depname:this.get_cfg_val("depname")},0,a)},form_url:function(a){if(!a){a={}}var g="",h="",k=this,n=DJNewsindexWidget.superclass.form_url.call(this,a),e=0,j=0;if(!a.fs){var d=gebi("bna");if(d&&d.innerHTML.length){j=d.innerHTML}e=Math.max(1,Math.min(20,parseInt(k.get_cfg_val("lim"))));g=(k.get_cfg_val("l")+"").replace(/[^a-z0-9]/g,"");if(k.column){var c=k.column.presets[k.column.get_id()];if(c&&c.w){c=c.w[k.get_id()]}else{c=0}if(c&&c.l&&c.defl){g=h=c.l}}}if(isNaN(e)){e=0}var m=k.get_cfg_val("depname");var b={lim:e,l:g,ni:k.getNI(),skip:j,defl:((g&&h==g)?1:0),depname:m};return djp.replaceinhref(b,0,n)},afterUpdate:function(a,b){if(a.mod_albids){djp.sched_load_alb_imgs(a.mod_albids)}},is_compact:function(){return this.get_cfg_val("l")=="compact"},is_topnews:function(){return this.get_cfg_val("ni")!="latest"},parseModuleXML:function(b){DJNewsindexWidget.superclass.parseModuleXML.call(this,b);this.mod_albids="";if(!this.is_compact()){var a=djp.get_xmlnode(b,"albids");if(a){this.mod_albids=djp.get_xmlnodeval(a,1)}}},setHeader:function(b,d){if(!d){d={}}if(!d.hd_opt){d.hd_opt=[]}if(d.hd_opt.length){d.hd_opt.shift()}var a=this.is_topnews()?{name:"latest",label:"Latest"}:{name:"top",label:"Top"},c="var w=djp.get_w('"+this.get_id()+"');w.cur_page=0;w.set_cfg_val('ni','"+a.name+"',0,function(){ w.update({ nav_hist:1});});return false;";d.hd_opt.push('<button class="fancy small" onclick="'+c+'">'+a.label+"</button>");DJNewsindexWidget.superclass.setHeader.call(this,b,d)}});var DJReportsWidget=function(c,d,b,a){DJReportsWidget.superclass.constructor.call(this,c,d,b,a);this.afterUpdateEvent.subscribe(this.afterUpdate,this)};YAHOO.lang.extend(DJReportsWidget,DJNewsindexWidget,{setHeader:function(b,a){a=a||{};a.show_refresh=1;DJNewsindexWidget.superclass.setHeader.call(this,b,a)}});var DJLocalWidget=function(c,d,b,a){DJLocalWidget.superclass.constructor.call(this,c,d,b,a)};YAHOO.lang.extend(DJLocalWidget,DJNewsindexWidget,{form_hist:function(a){a=DJLocalWidget.superclass.form_hist.call(this,a);return djp.replaceinhref({onecc:this.getUrlProp("onecc")},null,a)},form_url:function(a){a=DJLocalWidget.superclass.form_url.call(this,a);return djp.replaceinhref("l",this.wcfg.fs?"detailed":"compact",a)},apply_hist_vals:function(a){DJLocalWidget.superclass.apply_hist_vals.call(this,a);var b=djp.qsval("onecc",a);if(b!=this.getUrlProp("onecc")){this.setUrlProp("onecc",b)}},get_cc:function(){var a=this.get_cfg_val("depname");if(!a){a=djp.user.get_cc()}return a},setHeader:function(b,a){DJNewsindexWidget.superclass.setHeader.call(this,b,a)}});var DJEventsWidget=function(c,d,b,a){DJEventsWidget.superclass.constructor.call(this,c,d,b,a)};YAHOO.lang.extend(DJEventsWidget,DJWidget,{form_hist:function(a){a=DJEventsWidget.superclass.form_hist.call(this,a);var b=this;return djp.replaceinhref("et",b.getUrlProp("et"),a)},apply_hist_vals:function(a){DJEventsWidget.superclass.apply_hist_vals.call(this,a);var b=djp.qsval("et",a);if(b!=this.getUrlProp("et")){this.setUrlProp("et",b,true)}},form_url:function(b){var a=DJEventsWidget.superclass.form_url.call(this,b);if(!b){b={}}return(b.fs?a:djp.replaceinhref("doauth",djp.user.is_staff(),a))}});var DJFeaturesWidget=function(c,d,b,a){DJFeaturesWidget.superclass.constructor.call(this,c,d,b,a);this.afterUpdateEvent.subscribe(function(e,g){if(e.mod_albids){djp.sched_load_alb_imgs(e.mod_albids,{l:"feature"})}},this)};YAHOO.lang.extend(DJFeaturesWidget,DJWidget,{parseModuleXML:function(b){DJFeaturesWidget.superclass.parseModuleXML.call(this,b);this.mod_albids="";var a=djp.get_xmlnode(b,"albids");if(a){this.mod_albids=djp.get_xmlnodeval(a,1)}}});var DJBlogsWidget=function(c,d,b,a){DJBlogsWidget.superclass.constructor.call(this,c,d,b,a);this.afterUpdateEvent.subscribe(this.afterUpdate,this)};YAHOO.lang.extend(DJBlogsWidget,DJWidget,{afterUpdate:function(a,b){if(a.mod_albids){djp.sched_load_alb_imgs(a.mod_albids)}},parseModuleXML:function(b){DJBlogsWidget.superclass.parseModuleXML.call(this,b);this.mod_albids="";var a=djp.get_xmlnode(b,"albids");if(a){this.mod_albids=djp.get_xmlnodeval(a,1)}},apply_hist_vals:function(a){DJBlogsWidget.superclass.apply_hist_vals.call(this,a);var b=djp.qsval("view",a);if(b!=this.get_cfg_val("view")){this.set_cfg_val("view",b,true)}},form_hist:function(a){a=DJBlogsWidget.superclass.form_hist.call(this,a);return djp.replaceinhref("view",this.get_cfg_val("view"),a)},form_url:function(a){return djp.replaceinhref({view:this.get_cfg_val("view"),lim:this.get_cfg_val("lim")},0,DJBlogsWidget.superclass.form_url.call(this,a))},setHeader:function(a,b){if(!b){b={}}if(!b.hd_opt){b.hd_opt=[]}b.hd_opt.push("<button class=\"fancy small\" onclick=\"if (!djp.user.is_loggedin()) this.href='/user/benefits.php?b=post';else this.href='/user/"+djp.user.get_id()+"/blog?tp=1'\">Post a Blog</button>");DJBlogsWidget.superclass.setHeader.call(this,a,b)}});var DJGroupsWidget=function(c,d,b,a){DJGroupsWidget.superclass.constructor.call(this,c,d,b,a);this.afterUpdateEvent.subscribe(this.afterUpdate,this)};YAHOO.lang.extend(DJGroupsWidget,DJWidget,{afterUpdate:function(a,b){if(a.mod_imgids){djp.sched_load_imgs(a.mod_imgids)}},parseModuleXML:function(b){DJGroupsWidget.superclass.parseModuleXML.call(this,b);var a=djp.get_xmlnode(b,"imgids");if(a){this.mod_imgids=djp.get_xmlnodeval(a,1)}else{this.mod_imgids=""}},setHeader:function(a,b){if(!b){b={}}if(!b.hd_opt){b.hd_opt=[]}b.hd_opt.push('<button class="fancy small" onclick="if (!djp.user.is_loggedin()) this.href=\'/user/signup.php\';else{DJGroup.prototype.edit();return false;}">Create a Group</button>');DJGroupsWidget.superclass.setHeader.call(this,a,b)}});var DJPicsWidget=function(c,e,b,a){var d=this;if(!a){a={}}if(!a.lim){a.lim=1}DJPicsWidget.superclass.constructor.call(d,c,e,b,a);d.album=new DJAlbum(null,{tgt:"pics-album-div",w:d,dataurl:d.picHandlers.dataurl});d.djShowEvent.subscribe(function(){if(!this.wcfg.fs){this.afterUpdateEvent.subscribe(this.picHandlers.onAfterUpdate,this.album)}})};YAHOO.lang.extend(DJPicsWidget,DJWidget,{picHandlers:{onAfterUpdate:function(c,b){b.cur_page=c.cur_page;if(!b.tmp_update_imgs){b.tmp_update_imgs=b.update_imgs;b.update_imgs=function(){var a=this.widget;a.cur_page=a.album.cur_page;YAHOO.util.History.navigate(a.get_id(),a.form_hist(djp.replaceinhref(a.hist_vars,0,"/")).substring(2))}}var d=gebi(b.cfg.tgt);b.tmp_update_imgs({tgt:d,nozoom:0,ncol:1,pw:[0,-1],show:{nc:1,cl:1,name:1}})},dataurl:function(b,c){return djp.replaceinhref({lim:b.widget.wcfg.lim,p:b.cur_page,get:1},null,b.widget.form_url({fs:0}))}},setBody:function(b){var a=this;if(!a.wcfg.fs){b='<div id="pics-album-div"></div>'+b}DJPicsWidget.superclass.setBody.call(a,b)},apply_hist_vals:function(b){DJPicsWidget.superclass.apply_hist_vals.call(this,b);var a=djp.qsval("view",b);if(this.get_cfg_val("view")!=a){this.set_cfg_val("view",a,true)}},form_hist:function(a){a=DJPicsWidget.superclass.form_hist.call(this,a);return djp.replaceinhref("view",this.get_cfg_val("view"),a)},form_url:function(b){var a=this.get_cfg_val("view");if(a=="top"){a=""}return djp.replaceinhref("view",a,DJPicsWidget.superclass.form_url.call(this,b))},is_latest:function(){return this.get_cfg_val("view")=="latest"},setHeader:function(b,c){if(!c){c={}}if(!c.hd_opt){c.hd_opt=[]}var a="latest";if(this.is_latest()){a="top"}c.hd_opt.push('<a href="" onclick="var w=djp.get_w(\''+this.get_id()+"');w.cur_page=0;w.set_cfg_val('view','"+a+'\',0,function(){ w.update({nav_hist:1}); });return false" style="text-transform:capitalize">'+a+" images&#187;</a>");c.hd_opt.push("<button onclick=\"var w=djp.get_w('"+this.get_id()+"');var img=new DJImage(null,{w:w});img.upload();return false\" class=small>Upload image</button>");DJPicsWidget.superclass.setHeader.call(this,b,c)}});var DJColumn=function(cid,lay,cfg){this.col_id=cid;this.layout=lay;this.presets={tutwc:{hide:{amc:1},nocustom:1},c3:{w:{weather:{rr:120},events:{},groups:{}}},c2:{w:{djreports:{ni:"latest"},contribute:{},weather:{rr:120},local:{l:"compact",defl:1},events:{},groups:{},topcjs:{},achievements:{},pr:{}}},c1:{w:{newsindex:{l:"detailed",lim:10},features:{},blogs:{}}},ac1:{w:{local:{lim:5}},amc_pos:"top"},prw:{w:{pr:{rr:60,lim:10,fakefs:1}}},assignments_col:{nocustom:1,w:{assignments:{skip_more_link:1}}},editnews:{w:{pr:{rr:60,lim:4,fakefs:1,close:false,lnk_target:"_blank"}},nocustom:1},uc2:{w:{weather:{col_index:0,rr:120},events:{col_index:1,doauth:1}}}};this.w=[];var U=YAHOO.util;this.initEvent=new U.CustomEvent("init-col",this,1,YAHOO.util.CustomEvent.FLAT);this.showEvent=new U.CustomEvent("show-col",this,1,YAHOO.util.CustomEvent.FLAT);this.hideEvent=new U.CustomEvent("hide-col",this,1,YAHOO.util.CustomEvent.FLAT);this.get_id=function(){return this.col_id};this.get_html_id=this.get_id;this.get_el=function(){return gebi(this.get_html_id())};this.cfg={w:{},hide:{}};djp.clonecopy(this.cfg,this.presets[this.get_id()]);if(cfg){djp.clonecopy(this.cfg,cfg)}this.sync_usr_cfg=function(){var lid=this.layout.get_id(),cid=this.get_id();var lcfg=djp.user.cfg.l;if(!lcfg[lid]){lcfg[lid]={}}var cfg=lcfg[lid];if(!cfg[cid]){cfg[cid]={}}cfg=cfg[cid];for(var i=0;i<this.w.length;i++){var w=this.w[i];var wid=w.get_id();if(!cfg[wid]){cfg[wid]=w.wcfg}cfg[wid].col_index=i}};this.uwci=function(){for(var i=0;i<this.w.length;i++){this.w[i].wcfg.col_index=i}};this.del_w=function(w){w.hide();this.w.splice(w.wcfg.col_index,1);delete djp.user.cfg.l[w.column.layout.get_id()][w.column.get_id()][w.get_id()];w.destroy();this.uwci();this.sync_usr_cfg();djp.user.save_wcfg()};this.add_more_w=function(){var me=this;me.add_more_w_p=new DJPanel("add_content_"+me.get_id(),{centerinviewport:true,fixedcenter:true,width:"585px",visible:true,modal:true});p=me.add_more_w_p;var t=djp.dce("table");t.cellPadding=5;t.cellSpacing=0;var r=t.insertRow(-1);r.vAlign="top";var c=r.insertCell(-1);c.width="50%";var ex={},html="";for(var li in djp.layouts){for(var ci in djp.layouts[li].cols){var tmp=djp.layouts[li].cols[ci];for(var i=0;i<tmp.w.length;i++){var k=tmp.w[i].get_id();var w=djp.widgets[k];if(w&&!w.hide){html+='<div><div class=h4 style="margin-bottom:0px;">'+w.name+"</div>"+w.desc+"</div>";ex[k]=1}else{alert("no for "+k)}}}}c.innerHTML='<h3 style="margin:0">Current Widgets</h3><div style="padding:10px;width:250px;" class="selusr">'+html+"</div>";var c=r.insertCell(-1);c.width="50%";c.innerHTML='<h3 style="margin:0">Available Widgets</h3><div style="padding:10px;width:250px;" class="selusr"></div>';var cnt=c.lastChild;var dce=djp.dce;var num_opt=0,onclick=function(){var a=this;var w=a.tag;var i=w.id;var me=a.col;me.add_w(me.w.length,i,w);a.parentNode.parentNode.parentNode.removeChild(a.parentNode.parentNode);var cel=me.get_el();var acl=gebi(cel.id+"-addcnt");if(acl){var cn=Dom.getChildrenBy(cel,function(n){return n.className.match(/yui-module/)});if(me.cfg.amc_pos=="top"&&cn.length){if(acl.id!=cn[0].id){cel.insertBefore(acl,cn[0])}}else{if(acl.id!=cel.lastChild.id){cel.appendChild(acl)}}}me.sync_usr_cfg();djp.user.save_wcfg(function(){a.close_panel.added_widgets=1});return false};for(var i in djp.widgets){var wcfg=djp.widgets[i];if(wcfg&&!ex[i]&&!wcfg.hide){num_opt++;var div=dce("div");div.innerHTML='<div class="even"><a href="" class="big imp hlplnk">'+(wcfg.icon?'<img src="'+wcfg.icon+'" border=0 align=absmiddle /> ':"")+wcfg.name+"&#187;</a></div><div class=p>"+wcfg.desc+"</div>";var a=div.firstChild.firstChild;a.tag=djp.clone(wcfg,1);a.tag.id=i;a.close_panel=p;a.col=me;a.onclick=onclick;div.id=djp.rndint();sc(div,"p");cnt.appendChild(div)}}if(!num_opt){cnt.innerHTML='<div style="padding:10px">All of DigitalJournal.com\'s widgets are currently active</div>'}p.hideEvent.subscribe(function(e){if(this.added_widgets&&djp.user.is_loggedin()){djp.gotourl("reload")}});p.setBody(t);p.setHeader("Add more content");p.render(djp.loadtgt());p.show()};this.add_w=function(index,wid,cfg){var w=djp.get_w(wid);var me=this;if(!w){eval("w = new "+(cfg.jsc?cfg.jsc:"DJWidget")+"(index, wid, this, cfg)")}if(!w){return}if(index==-1||index>=me.w.length){me.w.push(w)}else{if(index==0){me.w.unshift(w)}else{me.w.splice(index,0,w)}}me.uwci();w.djShowEvent.fire(w)};this._default_onInit=function(c,p){var cid=c.get_el();if(!cid){var ac=gebi(c.layout.get_html_id());if(ac){cid=ac.insertCell(-1);cid.id=c.get_html_id();ac.appendChild(cid)}}cid.djcol=c;c.dd=new YAHOO.util.DDTarget(cid.id,"apps");var lid=this.layout.get_id();var cid=c.get_id();var lcfg=djp.user.cfg.l[lid];var cfgw=[],cfgw_src=c.cfg.w,exist_ids={};if(lcfg&&lcfg[cid]){var removed=lcfg.removed;if(typeof(removed)=="string"){removed=removed.split(",");if(removed&&removed.length){for(var i in cfgw_src){var lc=lcfg[cid][i];if(!lc&&!removed.in_array(i)){var incol=this.layout.get_w_cfgcol(i);if(!incol||incol==cid){lc=djp.clone(cfgw_src[i]);if(!isNaN(parseInt(cfgw_src[i].col_index))){exist_ids[cfgw_src[i]]=1}}}}}}cfgw_src=lcfg[cid]}var ci=0;for(var mid in cfgw_src){if(!cfgw_src[mid].col_index){while(exist_ids[ci]){ci++}cfgw_src[mid].col_index=ci++}cfgw.push(mid)}cfgw.sort(function(a,b){var res=cfgw_src[a].col_index-cfgw_src[b].col_index;if(isNaN(res)){res=0}return res});for(var i=0;i<cfgw.length;i++){var mid=cfgw[i];if(djp.widgets[mid]&&!djp.widgets[mid].hide&&!djp.get_w(mid)){var mycfg=djp.clone(djp.widgets[mid]);djp.clonecopy(mycfg,cfgw_src[mid]);if(lcfg&&lcfg.c){var ccfg=lcfg.c[cid];if(ccfg&&ccfg.w&&ccfg.w[mid]){djp.clonecopy(mycfg,ccfg.w[mid])}}this.add_w(i,mid,mycfg)}}this.sync_usr_cfg()};this._default_onHide=function(c,p){for(var i=0;i<c.w.length;i++){c.w[i].djHideEvent.fire(c.w[i])}};this._default_onShow=function(c,p){var cid=c.get_el();if(!c.layout.cfg.hide.layopt){var aclk=cid.id+"-addcnt";var acl=gebi(aclk);if(cid&&!acl){var div=djp.dce("div");div.style.padding="7px 0 3px 0";div.id=aclk;sc(div,"tar imp");div.innerHTML='<a href="" class="editfld">+Add More Content&#187;</a> &nbsp; <a href="" class=editfld>Reset Layout&#187;</a>';var tmp=div.lastChild;tmp.onclick=function(){delete djp.user.cfg.l[djp.currentLayout.get_id()];djp.user.save_wcfg(function(){djp.gotourl("reload")});return false};acl=div.firstChild;acl.djcol=c;acl.onclick=function(){this.djcol.add_more_w();return false};if(!c.cfg.hide.amc){if(c.cfg.amc_pos=="top"&&c.w.length){cid.insertBefore(div,c.w[0].get_el())}else{cid.appendChild(div)}}}}};this.hit=function(xy){var el=this.get_el();var el_xy=Dom.getXY(el);var el_b=[el_xy[0]+el.clientWidth,el_xy[1]+el.clientHeight];if(xy[0]<el_b[0]&&xy[0]>=el_xy[0]&&xy[1]<el_b[1]&&xy[1]>=el_xy[1]){var last_w=null;for(var i=1;i<this.w.length;i++){last_w=this.w[i];if(!last_w){alert(i+": "+last_w)}var el=last_w.get_el();var el_y=Dom.getY(el);if(xy[1]<el_y){return this.w[i-1]}}return last_w}};this.initEvent.subscribe(this._default_onInit,this.layout.page);this.showEvent.subscribe(this._default_onShow,this.layout.page);return this};var DJLayout=function(d,a){var c=this;c.page=a.page;c.cols={};c.cfg={};if(a.cols&&a.cols.length){if(!c.cfg.cols){c.cfg.cols=[]}for(var b=0;b<a.cols.length;b++){c.cfg.cols.push(a.cols[b])}}if(!c.cfg.hide){c.cfg.hide={}}if(a.hide){djp.clonecopy(c.cfg.hide,a.hide,1)}if(a.widgets){c.cfg.load_w=a.widgets}c.presets={def:{to_mm:600}};c.layout_id=d;c.is_showing=false;c.initEvent=new YAHOO.util.CustomEvent("init-l",c,1,YAHOO.util.CustomEvent.FLAT);c.showEvent=new YAHOO.util.CustomEvent("show-l",c,1,YAHOO.util.CustomEvent.FLAT);c.hideEvent=new YAHOO.util.CustomEvent("hide-l",c,1,YAHOO.util.CustomEvent.FLAT);c.resumeEvent=new YAHOO.util.CustomEvent("resume-l",c,1,YAHOO.util.CustomEvent.FLAT);c.get_id=function(){return this.layout_id};c.get_html_id=c.get_id;c.get_el=function(){return gebi(c.get_html_id())};c.get_w_cfgcol=function(h){var g=djp.user.cfg.l[this.get_id()];if(g){for(var j in g){if(typeof(g[j])!="object"){continue}for(var e in g[j]){if(e==h){return j}}}}};c.add_col=function(g,e){if(this.cols[g]){delete this.cols[g]}this.cols[g]=new DJColumn(g,this,e);this.cols[g].initEvent.fire(this.cols[g])};c._default_onResume=function(e,g){e.last_mm=new Date().getTime()};c._default_onInit=function(m,g){g.currentLayout=m;g.clonecopy(m.cfg,m.presets.def);var s=m.get_html_id();if(!gebi(s)){var u=gebi(m.cfg.container_id);if(u){var v=djp.dce("TABLE");var e=v.insertRow(-1);e.id=s;u.appendChild(v)}else{alert("No app container ["+s+"]")}}m.last_mm=new Date().getTime();if(m.cfg.cols){var h={},w=[];for(var q=0;q<m.cfg.cols.length;q++){h[m.cfg.cols[q]]=null}if(m.cfg.load_w){var o=0;for(var j in m.cfg.load_w){if(typeof(m.cfg.load_w[j])!="function"){var x=m.cfg.load_w[j]||{};j=(j+"").match(/[^0-9]/)?j:m.cfg.cols[0];if(!w.in_array(j)){var n=x.column||m.cfg.cols[0];if(!h[n]){h[n]={w:{}}}h[n].w[j]=djp.clonecopy(x||{},{col_index:o});w.push(j)}}o++}}for(var n in h){m.add_col(n,h[n])}}};c._default_onMM=function(){var e=djp.currentLayout;var g=e.last_mm;e.last_mm=new Date().getTime();if(e.last_mm-g>1000*e.cfg.to_mm){e.resumeEvent.fire(e)}};c._default_onShow=function(e,h){h.currentLayout=e;h.is_showing=true;for(var g in e.cols){e.cols[g].showEvent.fire(e.cols[g])}Ev.addListener(e.get_el(),"mousemove",this._default_onMM)};c._default_onHide=function(e,h){for(var g=0;g<e.cols.length;g++){e.cols[g].hideEvent.fire(e.cols[g])}e.is_showing=false;Ev.removeListener(e.get_el(),"mousemove",this._default_onMM);h.currentLayout=null};c.initEvent.subscribe(c._default_onInit,c.page);c.showEvent.subscribe(c._default_onShow,c.page);c.hideEvent.subscribe(c._default_onHide,c.page);c.resumeEvent.subscribe(c._default_onResume,c.page)};var djp={cls:{},domain:"digitaljournal.com",layouts:{},cache:{contacts:{}},jsfiles:{ContactManager:{file:"/js/contactmanager.js",v:13},HelpEditor:{file:"/js/helpeditor.js",v:4},Revisions:{file:"/js/revisions.js",v:3}},widgets:{events:{jsc:"DJEventsWidget",icon:"/images/events.gif",rr:30,lim:6,header_opt:{show_refresh:1},hasfs:1,name:"Live Events",desc:"View various events such as latest articles, comments and votes in real-time."},events_articles:{jsc:"DJEventsWidget",icon:"/images/article.gif",rr:60,hasfs:1,header_opt:{show_refresh:1},name:"Latest News",desc:"View latest articles. Widget will refresh every minute."},events_comments:{jsc:"DJEventsWidget",icon:"/images/comment.gif",rr:60,header_opt:{show_refresh:1},hasfs:1,name:"Latest Comments",desc:"View latest comments in real time."},search:{name:"Search",desc:"Search Digital Journal articles or users without leaving the page."},contribute:{name:"Inside Digital Journal",icon:"/images/djlogo-small.gif",desc:"Quick access to post news, blogs and images as well as links to important features."},achievements:{name:"Achievements",icon:"/images/djlogo-small.gif",desc:"This month's achievements.",hasfs:1,header_opt:{show_refresh:1},fsurl:"/achievements/?tab=achievements"},topcjs:{name:"Leaderboard",icon:"/images/djlogo-small.gif",desc:"This month's most active users.",hasfs:1,header_opt:{show_refresh:1},fstxt:"More",fsurl:"/achievements/"},pics:{jsc:"DJPicsWidget",icon:"/images/image.gif",hasfs:1,doauth:1,name:"Top Images",desc:"Popular images."},pr:{jsc:"DJPrWidget",name:"Press Releases",desc:"Research material.",fsurl:"/pr/",header_opt:{show_refresh:1},hasfs:1,rr:180,lim:10},assignments:{jsc:"DJAssignmentsWidget",name:"Assignments",desc:"A list of stories and content Digital Journal editors are looking for.",fsurl:"/assignments/",header_opt:{show_refresh:1},hasfs:1,rr:180,lim:5},local:{jsc:"DJLocalWidget",jsoptc:"1",name:"National News",icon:"/images/article.gif",hasfs:1,hasoptfile:1,hasopt:"Countries",desc:"Digital Journal's news articles that affect your country.",rr:480,lim:5,l:"compact"},djreports:{name:"Digital Journal Reports",icon:"/images/article.gif",hasfs:1,desc:"On-the-ground reporting and interviews from Digital Journalists.",jsc:"DJReportsWidget",rr:600},newsindex:{name:"In the Media",icon:"/images/article.gif",hasfs:1,desc:"Digital Journal's latest and important news articles.",jsc:"DJNewsindexWidget",header_opt:{show_refresh:1},rr:480,lim:5,l:"detailed"},features:{jsc:"DJFeaturesWidget",icon:"/images/article.gif",hasfs:1,name:"Featured Articles",lim:4,desc:"Articles that are hand-picked by our editors."},blogs:{jsc:"DJBlogsWidget",icon:"/images/blog.gif",hasfs:1,learnmore:"/user/benefits.php?b=post",name:"Blogs",desc:"Latest blogs"},groups:{jsc:"DJGroupsWidget",icon:"/images/group.gif",hasfs:1,learnmore:"/user/benefits.php?b=groups",name:"Groups",desc:"Create an open or closed group to express opinions on a particular subject or simply join an existing one to further its cause."},weather:{jsc:"DJWeatherWidget",jsoptc:"1",hasopt:"Settings",name:"Weather",desc:"Get localized weather information for locations anywhere around the world."}},currentLayout:null,last_mm:0,htmlFormed:0,postload_albums:[],postload_imgs:[],initEvent:new YAHOO.util.CustomEvent("init",this,1,YAHOO.util.CustomEvent.FLAT),htmlFormedEvent:new YAHOO.util.CustomEvent("htmlformed",this,1,YAHOO.util.CustomEvent.FLAT),fireInit:function(a){var b=function(){if(a){a.call()}djp.initEvent.fire(djp)};var c=Ev;if(!c.DOMReady){c.onDOMReady(b)}else{b()}},add_l:function(a){if(!this.layouts[a.get_html_id()]){this.layouts[a.get_html_id()]=a}},onInit:function(a,d){for(var c in d.layouts){var b=d.layouts[c];b.initEvent.fire(b);b.showEvent.fire(b)}},ga_addserv:function(a){if(typeof(GS_googleAddAdSenseService)=="function"){GS_googleAddAdSenseService(a)}},ga_addslot:function(b,a){if(typeof(GA_googleAddSlot)=="function"){GA_googleAddSlot(b,a)}},ga_addattr:function(a,b){if(typeof(GA_googleAddAttr)=="function"){GA_googleAddAttr(a,b)}},ga_fetch:function(){if(typeof(GA_googleFetchAds)=="function"){GA_googleFetchAds()}},ga_fill:function(a){if(typeof(GA_googleFillSlot)=="function"){GA_googleFillSlot(a)}},ga_enable:function(){if(typeof(GS_googleEnableAllServices)=="function"){GS_googleEnableAllServices()}},id2path:function(e,d){var c="",b=e+"";for(var a=0;a<b.length&&(a<d||!d);a++){c+="/"+b.charAt(a)}return c},rndint:function(){return Math.round(10000000*Math.random())},reload:function(a){if(!a){a=window}a.location.reload()},has_fade_problem:function(){return(YAHOO.env.ua.gecko==1.8&&navigator.userAgent.toLowerCase().indexOf("macintosh")!=-1)},loading_text:function(b,a){a=a||{};if(!b){b="Loading..."}return'<div class="tac p">'+(a.hide_img?"":'<img src="/images/loading.gif" border=0 align=absmiddle width=24 height=24 /> ')+b+"</div>"},breaking_news_layout:function(a,c,b){djp.console("lof",arguments);c.appendChild(a.to_html(b));c.style.width=c.lastChild.style.width},sched_load_alb_imgs:function(b,a){if(!a){a={}}if(!this.htmlFormed){this.postload_albums.push([b,a])}else{this.load_alb_imgs(b,a)}},sched_load_imgs:function(b,a){if(!a){a={}}if(!this.htmlFormed){this.postload_imgs.push([b,a])}else{this.load_imgs(b,a)}},load_alb_imgs:function(b,a){this.load_imgs(b,a,"/info/type/img/byalbid?doauth=1")},load_imgs:function(ids,imgopt,url){if(!url){url="/info/type/img/byid?doauth=1"}if(!ids){return}if(!YAHOO.lang.isArray(ids)){ids=ids.replace(/^[^0-9a-z]*|[^0-9a-zA-Z]*$/gi,"");ids=ids.split(" ")}var map={};for(var i=0;i<ids.length;i++){if(gebi(ids[i])){var key=ids[i].replace(/^.*-([0-9]+)$/g,"$1");if(!map[key]){map[key]=[]}map[key].push(ids[i]);ids[i]=key}}djp.ajax.grab(djp.replaceinhref("rnd",djp.rndint(),url+"&ids="+djp.encuri(ids.join(" "))),{argument:[map,imgopt],success:function(o){var imgs=djp.gebtn(o.responseXML,"djimg"),map=o.argument[0],opt=o.argument[1];for(var i=0;i<imgs.length;i++){var img=new DJImage(imgs[i],{});var albid=imgs[i].getAttribute("albid");if(!albid){albid=img.id}for(var k=0;map[albid]&&k<map[albid].length;k++){var t=gebi(map[albid][k]);if(t){var img_click=t.img_click,hp=Dom.getAncestorBy(t,function(n){return(Dom.hasClass(n,"yui-hidden")||n.style.display=="none"||n.style.visiblity=="hidden")});if(!img_click){img_click=t.firstChild;if(img_click&&img_click.tagName.toLowerCase()=="a"){t.style.cursor="pointer";Ev.addListener(t,"click",function(e,img){if(img.href){djp.gotourl(img.href)}else{if(img.onclick){img.onclick()}}},img_click)}}t.tag=img;t.sched_load_img_opt={tgt:t,noclick:1,l:"compact"};djp.clonecopy(t.sched_load_img_opt,opt,1);var imgopt=t.getAttribute("imgopt");if(imgopt){try{eval("imgopt = "+imgopt+";");t.sched_load_img_opt=YAHOO.lang.merge(t.sched_load_img_opt,imgopt)}catch(err){djp.console("Error",err)}}else{imgopt=null}t.sched_load_img=function(){var o=this.sched_load_img_opt,t=this,img=t.tag;if(typeof(o.lof)=="function"){o.lof(img,t,o)}else{var width=t.width;t.innerHTML="";t.width=width;if(!o.pw){o.pw=[]}var pw=o.pw;if(!pw[0]){pw[0]=Math.max(0,t.clientWidth)}if(!pw[1]){pw[1]=Math.max(0,t.clientHeight)}t.appendChild(img.to_html(o))}if(typeof(o.afs)=="function"){o.afs(img,t,o)}if(t.sched_load_img){t.sched_load_img=null}};if(!hp){t.sched_load_img()}}}}},failure:function(){}})},linkedin_button_success:function(a){ga("send","social","linkedin","share",a)},toMysqlDate:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},parseMysqlDate:function(b){if(!b){return null}var a=/^([0-9]{2,4})-([0-1]?[0-9])-([0-3]?[0-9])( ([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/g;var c=b.replace(a,"$1 $2 $3 $5 $6 $7").split(" ");return new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5])},months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],datef:function(g,a){if(typeof(g)=="string"){g=djp.parseMysqlDate(g)}if(!a){a="short"}switch(a){case"short":return this.months[g.getMonth()]+" "+g.getDate()+", "+g.getFullYear();break;case"full":return g.toLocaleString();break;case"relative":default:var j=new Date();var b=new Date(j.getFullYear(),j.getMonth(),j.getDate());var e=86400;var h=new Date(b.getTime()-e);if(g<h){return this.datef(g,"short")}else{if(g>j){return this.datef(g,"full")}else{if(g>b||j-g<82800000){var c=j-g;if(c>3600000){var c=Math.floor(c/3600000);return c+" hour"+(c?"s":"")}else{var c=Math.floor(c/60000);return c+" min"+(c?"s":"")}}else{if(g<b){return"yesterday"}}}}break}},_revView:null,viewRev:function(a){if(!this._revView){djp.load_js(djp.jsfiles.Revisions,"djp.cls.RevView",a,function(b){if(b){this._revView=b;b.show()}else{djp.error("Could not load Revision Viewer")}})}else{this._revView.initFrom(a);this._revView.show()}},edit_assignment:function(e){var c=djp.get_w("assignments"),j=gebi("edit_assignment_div");if(c){c.pause()}if(j){j.className=""}var g=gebi("assignment_form");g.reset();g["fd[title]"].focus();if(!g.attached_editor){var h=g["fd[descr]"];dje.attachtoelement(h,h.previousSibling,{allow_imgs:1})}if(e){var b=djp.assignment().get(e,function(k){var d=k[0];g["fd[title]"].value=d.title;g["fd[descr]"].value=d.descr;g["fd[end_date]"].value=d.end_date;g["fd[max_claims]"].value=d.max_claims;g["fd[id]"].value=d.id})}},_cityhook_last:"",_cityhook_pp:null,citysugghook:function(b,a){if(!b.cityhook){if(!b.id){b.id="cityfld"+djp.rndint()}if(b.setAttribute){b.setAttribute("autocomplete","off")}b.cityhookopt=a||{};b.cityhook_keydown=function(l){var h=this,k=djp._cityhook_pp,c=38,d=40,m=13,j=l.which||l.keyCode;k.tt_src=h;if(l&&[c,d].in_array(j)){k.showPP();k.selectCityItem(j==c?-1:1);Ev.stopEvent(l);return false}else{if(l&&j==m){if(k.isShowingPP()){var g=typeof(k.selectedCityItem)!="undefined"?k.selectedCityItem:-1;if(g>=0){Dom.getElementsByClassName("item","div",k.getEl())[g].firstChild.onclick()}}Ev.stopEvent(l);return false}}};b.cityhook=function(h){var c=this,k=c.value,j=YAHOO.util.Connect,g=h.which||h.keyCode;if(!djp._cityhook_pp){djp._cityhook_pp=new DJSimplePPPanel("citysugg_"+djp.rndint(),{width:"400px"});Ev.on(djp._cityhook_pp.getEl(),"mouseover",function(n){var m=djp._cityhook_pp;if(m){m.selectCityItem(0)}});Dom.addClass(djp._cityhook_pp.getEl(),"citysugg");djp._cityhook_pp.selectCityItem=function(q){var e=Dom.getElementsByClassName("item","div",this.getEl()),o=!isNaN(this.selectedCityItem)?this.selectedCityItem:-1,n=Math.max((o+q)%e.length,-1);if(o>=0){if(o==0&&n<0){n+=e.length}this.selectedCityItem=-1;for(var m=0;m<e.length;m++){Dom.removeClass(e[m],"selected")}}if(n>=0&&q){Dom.addClass(e[n],"selected");this.selectedCityItem=n}}}var d=djp._cityhook_pp,l=d.cityhook_req;d.tt_src=c;if(l&&j.isCallInProgress(l)){j.abort(l)}k=(k).replace(/[^0-9a-z]*,.*$/i,"").toLowerCase();if(k&&k.length>=3){if(k!=djp.cityhook_last){djp.getinfo("page","suggcity",{quiet:1,panel:d,vals:{q:k},el:c,onAfterSave:function(n){var v="",t=n.sxml,m=n.argument[0].panel,q=n.argument[0].el;if(t){var r,x=djp.gebtn(t,"citysugg");if(x&&x.length){for(r=0;r<x.length;r++){var e=djp.get_xmlnodeval(x[r],1);v+='<div class="item"><a href="" onclick="var el=gebi(\''+q.id+"');if(el){if(typeof(el.cityhookopt.onSelect)=='function')el.cityhookopt.onSelect(this.cityxml);else el.value=this.innerHTML.replace(/,\\s*[A-Z]{2}\\s*$/,'');djp._cityhook_pp.hidePP();}return false;\">"+e+"</a></div>"}var w,u=m.getEl();u.innerHTML='<div style="background:white">'+(q.cityhookopt.headerText?'<div class="odd header">'+q.cityhookopt.headerText+"</div>":"")+v+"</div>";w=djp.gebtn(u.lastChild,"a");for(r=0;r<w.length;r++){w[r].cityxml=x[r]}m.showPP()}else{m.hidePP()}}}});djp.cityhook_last=k}else{d.showPP()}}else{d.hidePP()}};Ev.on(b,"blur",function(){setTimeout(function(){if(djp._cityhook_pp){djp._cityhook_pp.hidePP()}},500)});Ev.on(b,"keyup",function(c){c=c||window.event;return this.cityhook(c)});Ev.on(b,"keydown",function(c){c=c||window.event;return this.cityhook_keydown(c)})}},parse_paging:function(b){var a=null;if(b){a={p:parseInt(b.getAttribute("p")),lim:parseInt(b.getAttribute("lim")),num:parseInt(b.getAttribute("num"))};a.num_p=Math.ceil(a.num/a.lim)}return a},load_tgt:null,loadtgt:function(){if(!djp.load_tgt){djp.load_tgt=gebi("loadextras")}return djp.load_tgt},formatFileSize:function(a,c){var b=0;if(!c){c={}}c=djp.clonecopy({units:"MB",decimals:1},c,1);switch(c.units){case"MB":denom=1024*1024;break}var d=Math.pow(10,c.decimals)+0;return Math.round((a/denom)*d,c.decimals)/d},clonecopy:function(d,b,a){if(!a){a=0}if(b){if(typeof(b)!="object"){return b}if(!d){d={}}for(var c in b){if(a==1){d[c]=b[c]}else{d[c]=djp.clonecopy(d[c],b[c],Math.max(0,a-1))}}return d}else{return b}},clone:function(d,a){if(!a){a=0}if(typeof(d)!="object"){return d}if(!d){return d}var c={};for(var b in d){if(a==1){c[b]=d[b]}else{c[b]=this.clone(d[b],Math.max(0,a-1))}}return c},set_cookie:function(b,d,a,g,c,e){if(!g){g="/"}if(!c){c=djp.domain}if(typeof(a)=="number"){a=new Date(a)}document.cookie=b+"="+escape(d)+((a)?"; expires="+a.toGMTString():"")+((g)?"; path="+g:"")+((c)?"; domain="+c:"")+((e)?"; secure":"")},get_cookie:function(c){var b=document.cookie;var e=c+"=";var d=b.indexOf("; "+e);if(d==-1){d=b.indexOf(e);if(d!=0){return null}}else{d+=2}var a=document.cookie.indexOf(";",d);if(a==-1){a=b.length}return unescape(b.substring(d+e.length,a))},delete_cookie:function(a,c,b){if(this.get_cookie(a)){if(!c){c="/"}if(!b){b=djp.domain}document.cookie=a+"="+((c)?"; path="+c:"")+((b)?"; domain="+b:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}},qsval:function(b,a){var d;if(a){d=a.replace(/^[^?]*?/g,"")}if(!d){d=window.location.search.substring(1)}var e=d.split("&");for(var c=0;c<e.length;c++){var g=e[c].split("=");if(g[0]==b){return g[1]}}return 0},w_spanclick:function(e,a){var d=e.innerHTML,g=parseInt(d),b=a.paging;if(isNaN(g)){if(d.match(/next/i)){g=b.p+1}else{if(d.match(/back/i)){g=b.p-1}else{return false}}}else{g-=1}a.spanclick({p:Math.max(0,Math.min(b.num_p-1,g))});var j=Dom,c=Math.max(0,j.getY(a.get_el())-30),k=j.getDocumentScrollTop();if(c<k||c>k+j.getViewportHeight()){window.scroll(0,c)}return false},spanclick:function(b){if(!b){b={}}if(b.t){window.scroll(0,0);var a={frameless:1};a[b.pv]=b.p;djp.ajax.grab(djp.replaceinhref(a,0,b.url),{argument:[{tgt:b.t,onAfterSave:function(d){var c=gebi(d.argument[0].tgt);if(c){var e=Dom.getElementsByClassName("article-thumbnails","div",c);if(e.length){djp.sched_load_alb_imgs(e[0].innerHTML)}}}}]})}else{djp.gotourl(djp.replaceinhref(b.pv,b.p,b.url))}return false},tabclick:function(c){if(!c){c={}}if(!c.tid){c.tid=0}if(!c.cid){c.cid=0}if(!c.tgt){c.tgt=djp.loadtgt()}c.ajax=parseInt(c.ajax);if(isNaN(c.ajax)){c.ajax=0}c.sticky=parseInt(c.sticky);if(isNaN(c.sticky)){c.sticky=0}if(!c.cid||!c.tid){return}var a=null;if(c.url){a=c.url}else{if(c.url_prefix.match(/\?.+$/)){c.url_prefix+="&"}a=c.url_prefix+(c.url_prefix?"":"?")+c.cid+"="+c.tid}if(c.sticky){djp.set_cookie("t["+c.cid+"][sel]",c.tid,new Date(new Date()*2),"/","digitaljournal.com");djp.set_cookie(c.cid,c.tid,new Date(new Date()*2),"/","digitaljournal.com")}else{djp.delete_cookie("t["+c.cid+"][sel]","/","digitaljournal.com")}if(c.ajax){c.tgt=gebi(c.tgt);var b=c.tgt;if(c.cache&&b&&b.tabcache&&b.tabcache[c.tid]){b.innerHTML=b.tabcache[c.tid]}else{a=djp.replaceinhref("rnd",djp.rndint(),a);djp.ajax.grab(djp.replaceinhref("frameless","1",a),{argument:[{onAfterSave:function(e){var d=e.argument[0].tgt;if(d){if(!d.tabcache){d.tabcache={}}d.tabcache[e.argument[0].tabid]=e.responseText}},tgt:b,tabid:c.tid}]})}}else{djp.gotourl(a)}return false},datelocale:function(a){var c=a.getAttribute("timestamp");if(c){c=parseInt(c);if(!isNaN(c)&&c){c=(c-18000)*1000;var b=new Date(c);a.innerHTML=b.toLocaleString();return}}djp.console("No timestamp",a)},_status_lines:[],_status_el:null,update_status:function(){var a=djp._status_lines,e=djp._status_el,g=Dom,c="";if(!e){return}e.cnt.innerHTML="";if(a.length){var h=Math.max(0,a.length-(djp.user.is_admin()?25:5));for(var b=h;b<a.length;b++){c+="<li"+((!h&&b==(a.length-1))?' style="border-bottom-width:0px;"':"")+">"+a[b]+"</li>"}if(h){c+='<li class="tac" style="border-bottom-width:0">'+h+" more</li>"}if(c){e.cnt.innerHTML=c}if(g.hasClass(e,"invis")){g.replaceClass(e,"invis","vis");e.style.marginTop=e.clientHeight+"px";var d=function(){var j=Math.max(0,parseInt(e.style.marginTop.replace(/^([0-9]+).*$/,"$1")));if(!j){return}e.style.marginTop=(--j)+"px";setTimeout(function(){d()},25)};d()}}else{g.replaceClass(e,"vis","invis")}e.style.top=(g.getDocumentScrollTop()+(g.getViewportHeight()-e.offsetHeight))+"px";e.style.left=Math.round((g.getViewportWidth()-e.clientWidth)/2)+"px"},progressbar:function(a,d){d=djp.clonecopy({width:100},d?d:{});var b=Math.round(a*100),c=Math.round(d.width*b/100);return'<span class="progress"><span class="completed"><img src="/images/tr.gif" border=0 height=1 width="'+c+'"/></span><span class="remaining">'+(c<d.width?'<img src="/images/tr.gif" border=0 height=1 width="'+(d.width-c)+'"/>':"")+"</span></span>"},console:function(){if(!djp.user.is_admin()){return false}if(typeof(console)!="undefined"){var b=null;if(typeof(console.debug)=="function"){b=arguments.length>1?arguments:arguments[0];console.debug(b)}else{if(typeof(console.log)!="undefined"){b=[];for(var a in arguments){b.push(arguments[a]+"")}console.log(b.join(", "))}}}},error:function(a){djp.status(a,"bad")},success:function(a){djp.status(a,"good")},status:function(a,c,g){var b=djp._status_lines,d=djp._status_el,e=Dom;if(!g){g=5000}if(!d){d=djp.dce("span");sc(d,"pgstatus invis");d.innerHTML="<ul></ul>";d.cnt=d.firstChild;djp._status_el=d;djp.loadtgt().appendChild(d);Ev.addListener(window,"scroll",function(){djp.update_status()})}switch(c){case"bad":case"good":case"info":a="<div class="+c+">"+a+"</div>";break}b.push(a);djp.update_status();setTimeout(function(){var h=djp._status_lines;if(h&&h.length){h.splice(0,1);djp.update_status()}},g)},process_fb_q:function(){var a=djp.init_fb_q.splice(0,djp.init_fb_q.length);a.each(function(){if(typeof(this[0])=="function"){djp.FB.initEvent.subscribe(this[0],this[1])}})},init_fb_q:[],init_fb:function(b,a){djp.console("init_fb");if(djp._fb_loading||typeof(FB)=="undefined"){if(!djp._fb_loading){djp.console("FB IS UNDEFINED")}djp.console("add to init_fb_q");djp.init_fb_q.push([b,a])}else{if(!djp.FB){djp.console("first-time init for djp.FB");djp._fb_loading=true;djp.init_fb_q.push([b,a]);djp.load_js("/js/fbconnect.js?v=6","djp.FB",null,function(){djp._fb_loading=false;djp.process_fb_q();djp.FB.init()},1)}else{if(typeof(b)=="function"){djp.console("fb already initialized");b.call(djp.FB,a)}}}},js_loaded:function(cls){var clstype=undefined;eval("clstype=typeof("+cls+");");return clstype!==undefined},load_js:function(jsfile,jsclass,clsargs,rndonload,noinstance){var jsv=0.1;if(typeof(jsfile)=="object"){jsv=jsfile.v;jsfile=jsfile.file}jsfile=djp.replaceinhref("jsv",djp.qsval("jsdebug")?djp.rndint():jsv,jsfile);var head=document.getElementsByTagName("head")[0],scr=djp.dce("script"),opt_str=jsclass?"var jsclass_type = typeof("+jsclass+");if(jsclass_type != 'undefined'){ if(jsclass_type=='function')opt="+(noinstance?1:"new "+jsclass+"(clsargs)")+"; else if(jsclass_type=='object') opt="+jsclass+"}":"",opt=null,f=function(opt){if(opt&&typeof(rndonload)=="function"){rndonload.call(clsargs,opt)}};eval(opt_str);if(!opt){scr.type="text/javascript";scr.async=true;scr.loadargs=[opt_str,f];scr.onload=function(){if(!this._onload_triggered){this._onload_triggered=true;var a=this.loadargs,opt=null;eval(a[0]);a[1](opt)}};scr.onreadystatechange=function(){if(scr.readyState=="loaded"||scr.readyState=="complete"){scr.onload()}};scr.src=jsfile;head.appendChild(scr)}else{f(opt)}},utf8:function(b){var g,e;var a="";var d=0;while(d<b.length){g=b.charCodeAt(d++);if(g>=56320&&g<57344){continue}if(g>=55296&&g<56320){if(d>=b.length){continue}e=b.charCodeAt(d++);if(e<56320||g>=56832){continue}g=((g-55296)<<10)+(e-56320)+65536}if(g<128){a+=String.fromCharCode(g)}else{if(g<2048){a+=String.fromCharCode(192+(g>>6),128+(g&63))}else{if(g<65536){a+=String.fromCharCode(224+(g>>12),128+(g>>6&63),128+(g&63))}else{a+=String.fromCharCode(240+(g>>18),128+(g>>12&63),128+(g>>6&63),128+(g&63))}}}}return a},defValInputBlur:function(a){if(!a.value){a.value=(a.getAttribute("defVal")+"");Dom.addClass(a,"blurred")}else{Dom.removeClass(a,"blurred")}},defValInputFocus:function(a){if(a.value==a.getAttribute("defVal")){a.value=""}Dom.removeClass(a,"blurred")},defValInputHook:function(a){Ev.addListener(a,"blur",function(){djp.defValInputBlur(this)});Ev.addListener(a,"focus",function(){djp.defValInputFocus(this)});djp.defValInputBlur(a)},hexchars:"0123456789ABCDEF",toHex:function(a){return this.hexchars.charAt(a>>4)+this.hexchars.charAt(a&15)},okURIchars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",encodeURIComponentNew:function(d){d+="";var d=this.utf8(d);var e;var a="";for(var b=0;b<d.length;b++){if(this.okURIchars.indexOf(d.charAt(b))==-1){a+="%"+this.toHex(d.charCodeAt(b))}else{a+=d.charAt(b)}}return a},getRadioVal:function(b,c){for(var a=0;a<b.elements[c].length;a++){if(b.elements[c][a].checked){return b.elements[c][a].value}}return undefined},hash2str:function(b){var c="";for(var a in b){c+=a+": "+b[a]+"\n"}return"{ "+c+" }"},dce:function(a){return document.createElement(a)},dct:function(a){return document.createTextNode(a)},encuri:function(a){return djp.encodeURIComponentNew(a)},decuri:function(e){var d=e;var a,c;var b=/(%[^%]{2})/;while((match=b.exec(d))!=null&&match.length>1&&match[1]!=""){a=parseInt(match[1].substr(1),16);c=String.fromCharCode(a);d=d.replace(match[1],c)}return d},gotourl:function(a){if(!a){a=window.location+""}else{if(a=="reload"){a=(window.location+"").replace(/#.*$/,"");if(YAHOO.env.ua.webkit){window.location.replace(a);setTimeout(function(){window.location.reload(true)},100);return}}}if(a){window.location.href=a}},urlhasqs:function(a){return a.match(/\?/)},urlhasqsvar:function(b,a){return b.match(new RegExp("\\?.*\\b"+a+"="))},replaceinhref:function(d,a,b){if(!b){b=window.location.href}if(typeof(d)=="object"){for(var c in d){b=djp.replaceinhref(c,d[c],b)}}else{var e=a&&typeof(a)!="undefined";if(!this.urlhasqsvar(b,d)){if(e){if(!this.urlhasqs(b)){b=b.replace(/(#.*)?$/,"?"+d+"="+a+"$1")}else{b=b.replace(/(#.*)?$/,"&"+d+"="+a+"$1")}}}else{re=new RegExp("(.)\\b"+d+"=[^&]*");if(e){b=b.replace(re,"$1"+d+"="+this.encuri(a))}else{b=b.replace(re,"$1");b=b.replace(/[?&]$/,"")}}}return b},cpf:function(q,t,n,r){var o=new Date(),g=gebi("current_pot"),j=3;var l=Math.min(parseFloat(q),Math.round(((o.getTime()/1000-t)/(n-t))*(parseFloat(q)*Math.pow(10,j)))/Math.pow(10,j))+parseFloat(r);var a=l+"";for(var k=0;k<a.length;k++){if(a.charAt(k)=="."){break}}var h=k;var m=j-(a.length-h-1);if(m>0){for(var k=0;k<m;k++){a+="0"}}else{if(m<0){a=a.substring(0,h+j)}}for(var k=h-3;k>0;k-=3){a=a.substring(0,k)+","+a.substring(k)}g.innerHTML=a;setTimeout("djp.cpf("+q+","+t+","+n+","+r+")",1000)},validate_keywords:function(e,b){var j={allowedchars:"",min_kw_len:3,max_subkw_count:4,sep:",",subsep:" "};b=b||{};djp.clonecopy(j,b,1);var h=new RegExp("([^A-Za-z0-9-%"+j.allowedchars+j.sep+(j.sep!=j.subsep?j.subsep:"")+"]|\\b(and|the[my]?|you[r]?[s]?|his|news|she|her|but|are)\\b)+","g");var g=new RegExp(/^[\s]*|[\s]*$/g);var d=new RegExp(/\s+/g);e=e.toLowerCase().replace(h," ").replace(d," ").replace(g,"");var c=e.split(j.sep);for(i=0;i<c.length;i++){if(!j.skip_subkw){var a=c[i].split(j.subsep);for(ii=0;ii<a.length;ii++){if(a[ii].length<j.min_kw_len){a.splice(ii,1);ii--}}if(a.length>j.max_subkw_count){a=a.splice(0,j.max_subkw_count)}c[i]=a.join(" ")}else{if(c[i].length<j.min_kw_len){c[i]=""}}if(!c[i]){c.splice(i,1);i--}}return c},get_deps_from_xml:function(a){djp.deps=[];if(a){var c=djp.gebtn(a,"djdep");for(var b=0;b<c.length;b++){djp.deps.push(new DJDep({xml:c[b]}))}}},get_deps:function(c,b){if(!this.deps){djp.ajax.grab("/info/type/dep/all",{success:function(a){djp.get_deps_from_xml(a.responseXML);djp.get_deps(a.argument[0],a.argument[1])},argument:[c,b]})}else{if(typeof(c)=="function"){c(b)}}},visible:function(e){var c=gebi(e);if(c){var b=Dom.getY(c),d=Dom.getDocumentScrollTop(),a=Dom.getViewportHeight();if(b>=d&&b<=Math.max(d,d+a-20)){return true}}return false},scrollTo:function(a){djp.console("scroll to",a);if(typeof(a)=="string"){a=gebi(a)}if(a){if(!djp.visible(a)){window.scroll(0,Math.max(0,Dom.getY(a)-25))}else{djp.console("scroll to skipped [visible]",a)}}},helpstr:function(b,a){a=a||{};if(!a.skip_icon){a.icon=a.icon||'<img src="/images/help.gif" border=0 align=absmiddle />'}else{a.icon=""}a.txt=a.txt||"";return'<a class="hlplnk" href="" onmouseover="djp.user.tt(this,event,{t:\'help\',id:\''+b+'\'});" onclick="return false;">'+a.icon+((a.icon&&a.txt)?" ":"")+a.txt+"</a>"},help:function(b){var a=new DJHelpPanel(b);a.show()},genpopup:function(o){if(!o){o={}}if(!o.h){o.h=400}if(!o.w){o.w=500}if(typeof(o.url)!="undefined"){eval("o.window = window.open('"+o.url+"', '"+o.id+"', 'toolbar="+o.tb+",scrollbars="+o.sb+",location=0,statusbar="+o.statusbar+",menubar="+o.menubar+",resizable="+o.resizable+",width="+o.w+",height="+o.h+"')")}return o},set_w:function(wid,cfg){var w=null;var opt=this.clone(this.widgets[wid]);this.clonecopy(opt,cfg);eval("w = new "+(opt.jsc?opt.jsc:"DJWidget")+"(0, wid, null, opt)");this.widget=w},get_w:function(e){var d=this;if(d.currentLayout){for(var a in d.currentLayout.cols){var g=d.currentLayout.cols[a];for(var b=0;b<g.w.length;b++){if(g.w[b].get_id()==e){return g.w[b]}}}}else{if(d.widget&&d.widget.get_id()==e){return d.widget}}},splchk_str:["Check Spelling","Finished spell check"],splchk_grp:{},splchk_disable_form:function(a){Ev.stopEvent(a);return false},spellchk_preptxt:function(a){return a.replace(/(<[\w\/].*?>|\[\/?url.*?\])/ig,"").replace(/(www\.|(f|ht)tps?:\/\/)[^\s]+/ig,"")},spellchk:function(o,a,b){o=gebi(o);if(!b){b={}}if(!o&&b.group){var k=djp.splchk_grp[b.group];if(k&&k.length){var d=a;a=k[0];o=a.spl_src;o.spl_realsrc=d;for(var h=1;h<k.length;h++){k[h].spl_src.spl_realsrc=d}}}if(!o){return}if(!o.value){djp.error("There is no text to check for spelling");return}var c=YAHOO.util;if(a&&!o.spl_realsrc){o.spl_realsrc=a}var n=djp.splchk_str;if(o.spl_realsrc.innerHTML==n[1]||o.spl_realsrc.value==n[1]){a.innerHTML=n[0];if(o.spl_realsrc){var d=o.spl_realsrc;if(d.innerHTML){d.innerHTML=o.spl_backupstr}else{d.value=n[0]}}var k=djp.splchk_grp[o.spl_grp];for(var h=0;h<k.length;h++){var o=k[h].spl_src,q=o.spl_mask;if(q){if(q.val_changed&&o.spl_ichange){o.spl_ichange.valchanged()}o.value=q.innerHTML.replace(/<br\/?>/gi,"\r\n").replace(/<a .*?id="?word_[0-9]+"?.*?>(.+?)<\/a>/gi,"$1").replace(/&amp;/gi,"&");q.parentNode.removeChild(q);o.spl_mask=null;Dom.replaceClass(o,"invis","vis");c.Event.removeListener(o.form,"submit",djp.splchk_disable_form);o.form.splchk_inprogress--}}return}var l=djp.dce("form");l.method="post";l.action="/info/type/page/spellcheck";var j=djp.splchk_grp[o.spl_grp];for(var h=0;h<j.length;h++){var e=djp.dce("textarea");e.name="fd[txt][]";e.value=djp.spellchk_preptxt(j[h].spl_src.value);l.appendChild(e)}var m=function(E){var A=djp.gebtn(E.responseXML,"spellchk"),z=E.argument[0].spltgt,N=djp.gebtn(E.responseXML,"splerr").length,r=[-1,null];var g=0;for(var x=0;x<A.length;x++){var s=A[x],C=s.getAttribute("index"),y=djp.gebtn(s,"splerr"),v=djp.splchk_grp[z.spl_grp][C],z=v.spl_src;if(y.length&&!isNaN(C)){if(A.length&&z.spl_realsrc){var w=z.spl_realsrc;if(w.innerHTML){z.spl_backupstr=w.innerHTML;w.innerHTML=n[1]}else{w.value=n[1]}}var H=djp.dce("div");H.style.width=z.clientWidth+"px";H.style.height=z.clientHeight+"px";H.style.overflow="auto";var I=0,B=z.value,u=[],D=function(S,Q,R,V){var t,U=V.substr(0,R),T=V.substr(R),O=U.match(/<[^>]*$/)&&T.match(/^[^<]*>/);if(!O){O=U.match(/&$/)&&T.match(/^[a-z]+;/i)}if(!O){var P=U.replace(/^.*<a .*?id=.*?>(.*?)$/im,"$1");if(P!=U){O=!P.match(/<\/a>/im)}}if(!O){g++}return(O?Q:'<a href="" id="word_'+I+'">'+Q+"</a>")};for(I=0;I<y.length;I++){var K=djp.get_xmlnodeval(djp.gebtn(y[I],"wrd")[0],1);u[I]={wrd:K,sugg:[]};var G=djp.gebtn(y[I],"sugg");for(var F=0;F<Math.min(10,G.length);F++){u[I].sugg.push(djp.get_xmlnodeval(G[F],1))}B=B.replace(new RegExp("\\b("+K+")\\b","mg"),D)}H.innerHTML=B.replace(/\r?\n\r?/ig,"<br/>").replace("&","&amp;");z.parentNode.insertBefore(H,z);if(v){v.innerHTML=n[1]}var J=djp.gebtn(H,"a"),L=function(S){var t=parseInt(this.id.replace(/^word_/,""));if(!isNaN(t)){if(!S){S=window.event}var R=this.splstack[t];var U=djp.user.tt(this,S,{t:"spellchk",id:t});var T='<a href="">'+R.sugg.join('</a>, <a href="">')+"</a>";T="<div class=splchksugg>"+(T?T:"No suggestions")+"</div>";U.setHeader((R.sugg.length?R.sugg.length:"No")+" suggestions for <b>"+R.wrd+"</b>");U.setBody(T);U.showPP(S,true);var Q=djp.gebtn(U.body,"a"),O=function(Y){try{var X=this.innerHTML;if(X){var aa=this.djpp,W=aa.splmask,V=djp.dce("a");var ab={orig_word:aa,innerHTML:X,href:"",id:"word_"+djp.rndint(),title:'Click to revert to original word "'+aa.innerHTML+'"'};djp.clonecopy(V,ab,1);V.style.cssText="color:green !important";V.onclick=function(){aa=this.parentNode;aa.insertBefore(this.orig_word,this);aa.removeChild(this);return false};W.insertBefore(V,aa);W.removeChild(aa);this.splpp.hidePP();W.val_changed=true}else{throw"Missing id: "+siggid}}catch(Z){djp.status("<div class=bad>"+Z+"</div>")}return false};for(var P=0;P<Q.length;P++){Q[P].djpp=this;Q[P].onclick=O;Q[P].splpp=U}}return false};for(var I=0;I<J.length;I++){J[I].splstack=u;J[I].splmask=H;J[I].onmouseover=L;J[I].onclick=function(){return false}}var M=Dom.getY(z);if(r[0]>M||!r[1]){r=[M,H]}z.spl_mask=H;sc(H,z.className);Dom.addClass(H,"splchkmask");Dom.replaceClass(z,"vis","invis");c.Event.addListener(z.form,"submit",djp.splchk_disable_form);if(!z.form.splchk_inprogress){z.form.splchk_inprogress=0}z.form.splchk_inprogress++}}if(!g){djp.status("No spelling errors","good",2500)}if(r[1]){djp.scrollTo(r[1])}};djp.ajax.formSubmit(l,{spltgt:o,submit_mode:"EO",quiet:1,onAfterSave:m})},addsplchk:function(e,c){if(typeof(e)=="string"){e=gebi(e)}if(!e){return}if(!c){c={}}if(c.ichange){e.spl_ichange=c.ichange}var b=e.clientWidth,d=e.nextSibling,g=djp.dce("div");if(b){g.style.width=b+"px"}g.innerHTML='<a href="" onclick="djp.spellchk(this.spl_src,this);return false;">'+djp.splchk_str[0]+"</a>";var a=c.group;if(!a){a="splchkgrp-"+djp.rndint()}e.spl_grp=a;if(!djp.splchk_grp[a]){djp.splchk_grp[a]=[]}djp.splchk_grp[a].push(g.firstChild);sc(g,"splchkbtn"+(c.hidelnk?" invis":""));g.firstChild.spl_src=e;if(d){e.parentNode.insertBefore(g,d)}else{e.parentNode.appendChild(g)}},sched_views:null,incrviews:function(a,d,b){var c=a+"-"+d;if(!b){if(!djp.sched_views){djp.sched_views=[]}djp.sched_views.push(c)}else{if(!djp.get_cookie("user[imp]")){djp.editobj("page","addviews",0,{silent:1,vals:{addviews:c}})}}},votebtn:function(g,c){c=c||{};g=gebi(g);if(!g||!g.innerHTML){return}var h="";var l=c.voteData?c.voteData:g.innerHTML.split(":");delete c.voteData;if(l[0].match(/^(blog|article|image)$/)){if(!c.txt){c.txt="Vote up this "+l[0]+"!"}if(!c.cls){c.cls="voteupgreen"}var k=l[0],b=parseInt(l[1]),j=parseInt(l[2]),o=l[3]?parseInt(l[3]):0,a=parseInt(l[4])?1:0,n=l[0],m="",q=false;h="";if(a){m="Likes"}else{if(o){if(djp.user.is_loggedin()){m="Unlike"}else{m="Liked"}}else{m="Like"}}if(m.match(/^(un)?like$/i)){q=(m.toLowerCase()=="like"?true:false);l[2]=j+(q?1:-1);l[3]=q?1:0;h+='<a class="votetxt'+(q?"":" clear")+'" id="'+(c.el_id||"")+'" href="" title="'+m+" this "+n+'" onclick="var p=this.parentNode.parentNode,opt=djp.clone(p.voteBtnOpt,1);if(djp.user.vote({ v:'+(q?1:-1)+", id:"+b+", t:'"+k+"',vtel:p,voteopt:p.voteBtnOpt})) djp.votebtn(p,djp.clonecopy(opt,{showvotes:1, voteData:'"+l.join(":")+"'.split(':')},1));return false;\">";h+=(m=="Like"?'<span class="icon-thumbs-up"></span> ':"")+m+" this "+n;h+="</a>"}else{h+='<span class="votetxt">'+m+(a?"":" this "+n)+"</span>"}if(j&&djp.user.is_loggedin()){var e=j+(j==1?" person":" people");h+='<span class="vote-num">'+(djp.user.is_staff()?'<a href="" title="'+e+" liked this "+n+'" class="num" onclick="var p=new DJSelCustomUsers(\'/info/type/user/'+k+"-voters?"+k+"="+b+"',{viewOnly:1,emptytxt:'Nobody has voted yet. Be the first!',bodytxt:'We sort the front page based on votes. Here are others who voted for this, so <b>Like it</b> if you enjoy it!'});p.show();return false;\">"+j+"</a>":j)+"</span>"}h='<span class="nowrap '+(c.cls)+'">'+h+"</span>";g.innerHTML=h;if(!a){g.voteBtnOpt=c}if(Dom.hasClass(g,"invis")){Dom.removeClass(g,"invis")}}},_currently_editing_fld:null,editfld:function(b){if(!b||!b.f||!b.id){return}if(!b.t){b.t="text"}var c=b.tf;var q;if(!djp._currently_editing_fld){c.tag=c.innerHTML;if(!c.id){c.id="edt-"-djp.rndint()+"-fld"}var m=djp.dce("FORM");m.editfld_opt=b;m.onsubmit=function(){try{var y=this.editfld_opt;var x={qiet:1,tgt:y.tgt,editfld_opt:y,vals:{},handlers:{failure:djp.handlers.failedEO}};x.handlers.success=function(B){var A=B.argument[0];var D=djp.get_xmlnode(B.responseXML,"status");if(D&&djp.handlers.successEO(B)){var G=djp.gebtn(B.responseXML,"newval"),F,H=[],z=A.editfld_opt,C=z.tf;for(var E=0;E<G.length;E++){H[G[E].getAttribute("fld")]=G[E]}F=djp.get_xmlnodeval(H[z.fld],1);if(z&&z.t=="tag_editor"&&H.tags){var J=[];djp.gebtn(H.tags,"djtag").each(function(){J.push(new DJTopic(null,{xml:this}).tt_link())});C.innerHTML=J.join(", ")}else{if(z&&z.t=="url"&&F){C.innerHTML='<a href="'+F+'" class=nowrap target="_blank">'+F.replace(/^([a-zA-Z]+:\/\/)?([a-zA-Z0-9_.]+).*$/,"$2...")+"</a>"}else{if(z&&z.t=="tags"&&F){z.tf.firstChild.innerHTML=F;z.tf.tag_editor.layout()}else{C.innerHTML=F}}}if(z&&z.t=="owner"){z.tf.djByOwner=parseInt(H.ownership.getAttribute("mine"))||0;var I=djp.get_xmlnodeval(H.ownership,1)||"";z.tf.djAttr=(z.tf.djByOwner?"":I);z.tf.innerHTML=I}djp._currently_editing_fld=null;if(A.afs){A.afs(B)}}};var k=djp.gebtn(this,"input"),v=djp._currently_editing_fld,e;if(v){x.vals[y.fld]=v.editfld_val?v.editfld_val():v.value;for(var u=0;u<k.length;u++){e=k[u];if(e.name!="fld"&&e.type.toLowerCase()!="submit"){x.vals[e.name]=e.value}}if(typeof(y.tgt)=="string"){gebi(y.tgt).innerHTML=""}djp.editobj(y.f,"editfld",y.id,x)}}catch(w){alert("err: "+w)}return false};var h=null,s=0;switch(b.t){case"sel":h=djp.dce("div");h.style.fontSize="11px";q=h;h.form=m;h.editfld_val=function(){return djp.getRadioVal(this.form,"fld")};for(var g in b.selitems){var j=b.selitems[g];var a=djp.dce("div");a.innerHTML='<input type=radio name="fld" '+(j[0]==c.tag?"checked ":"")+'value="'+g+'" align=absmiddle /> '+j[0];h.appendChild(a)}break;case"ta":h=djp.dce("TEXTAREA");h.rows=4;h.value=c.tag;break;case"date":h=djp.dce("span");var t=djp.dce("INPUT");q=t;t.value=c.tag;t.def_val="yyyy-mm-dd";if(!t.value){t.value=t.def_val}t.type="text";t.name="fld";t.onfocus=function(){if(this.value==this.def_val){this.value=""}};t.onblur=function(){if(this.value==""){this.value=this.def_val}};s=120;h.appendChild(t);t=djp.dce("a");t.href="";sc(t,"editfld");t.onclick=function(){var e=this.parentNode.firstChild;this.djcal=new DJCal({selected:(e.value?djp.parseMysqlDate(e.value):""),afs_args:[e]});return false};t.innerHTML="Calendar";h.appendChild(djp.dct(" "));h.appendChild(t);break;case"url":h=djp.dce("INPUT");if(c.firstChild&&c.firstChild.tagName.toUpperCase()=="A"){h.value=c.firstChild.href}break;case"owner":try{h=djp.dce("span");h.form=m;h.editfld_val=function(){return djp.getRadioVal(this.form,"fld")};h.value=c.tag.match(/^not/i)?0:1;h.type="owner";var r=parseInt(c.djByOwner)||0,l=function(){var e=this.parentNode.lastChild,k=parseInt(djp.getRadioVal(this.form,this.name));if(k){Dom.addClass(e,"invis")}else{Dom.removeClass(e,"invis")}};h.innerHTML='<input type=radio value="1" name="fld" '+(r?"checked":"")+'/> My image &nbsp; &nbsp; <input type="radio" value="0" name="fld" '+(r?"":"checked")+' /> Not my image<div class="'+(r?"invis ":"")+'p">Who is the owner?<br><input type="text" name="fld_attr" style="width:150px"></div>';Dom.getElementsBy(function(e){return e.type.toLowerCase()=="radio"},"input",h,function(k,e){k.onclick=e},l);h.attFld=Dom.getElementBy(function(e){return e.name=="fld_attr"},"input",h);h.attFld.value=c.djAttr;break}catch(n){djp.error("Editfld owner: "+n)}case"tag_editor":var d=c.tag_editor;if(!d){h=html2el("<div></div>")[0];h.type=b.t;c.tag_editor=new djp.TagEditor({tgt:h,fld_name:"tags"});d=c.tag_editor;d.tags=b.img?(b.img.tags||[]):[]}else{h=d.tgt()}d.layout();s=80;q=d.input();break;case"text":default:h=djp.dce("INPUT");h.value=c.tag;h.type=b.t;break}if(!q){h.name="fld";q=h}q.style.width=(s?s:250)+"px";m.appendChild(h);m.appendChild(djp.dce("BR"));m.appendChild(html2el("<input type=submit value=Save />")[0]);var h=html2el('<input type=submit value=Cancel onclick="return false" />')[0];h.onclick=function(){djp._currently_editing_fld=null;c.innerHTML=c.tag;return false};m.appendChild(h);c.innerHTML="";c.appendChild(m)}else{alert("Save the other field you are currently editing first.")}if(q){djp._currently_editing_fld=q;if(q.focus){q.focus()}if(q.select){q.select()}}},getinfo:function(c,b,d){if(typeof(d)!="object"){d={}}d.ajax_url="/info/type/"+c+"/"+b+"?";return djp.editobj(c,b,0,d)},editobj:function(g,b,j,h){if(!h){h={}}if(!h.handlers){h.handlers={}}var e=h.handlers;if(!e.success){e.success=this.handlers.successEO}if(!e.failure){e.failure=this.handlers.failedEO}if(!e.argument||!e.argument.length){e.argument=[h]}if(!e.argument[0].handlers){e.argument[0].handlers=e}var c=h.ajax_url;if(!c){c="/edit/"+g+"-"+b+(j?"-"+j:"")+"?output_mode=xml&rndint="+djp.rndint()}for(var d in h.vals){c+="&fd["+d+"]="+djp.encuri(h.vals[d])}return this.ajax.grab(c,e)},gebtn:function(h,a){var e=YAHOO.env.ua,b;h=gebi(h);if(!e.ie&&e.gecko<1.9){a=a.replace(/^[a-z0-9]+:/gi,"")}var d=[];try{b=h.getElementsByTagName(a);for(var c=0;c<b.length;c++){d.push(b[c])}}catch(g){}return d},get_xmlnode:function(c,a){var b=djp.gebtn(c,a);if(b&&b.length){return b[0]}},get_xmlnodeval:function(b,a){if(!b){return}if(a){b=b.firstChild}if(b){return b.nodeValue}},parseXMLContent:function(c,b){if(c.getAttribute("type")=="xml"){var a=djp.article.fromXML(c)}else{return djp.get_xmlnodeval(c,1)}},add_img:function(b){if(!b){b={}}if(!b.tgt&&b.tgt_el){b.tgt=b.tgt_el}if(!b.alb){alert("new album");b.alb=new DJAlbum(null,{tgt_el:b.tgt,ui_o:{tgt_el:b.tgt,ncol:1}})}if(!b.alb.t){if(b.aid){b.alb.t=2}else{if(b.bid){b.alb.t=1}}}var a=(parseInt(b.alb.id)>0?true:false);if(b.alb.selimg){b.alb.selimg.o.args[1]=a}else{b.alb.selimg=new DJSelImgs({args:[b,a],onselect:function(g,c){var e=c[0];var d=function(j,h){var l=h[0];var k={quiet:1,vals:{albid:l.alb.id},album:l.alb,onAfterSave:function(m){m.argument[0].album.compupdate()}};if(l.aid&&!h[1]){djp.editobj("article","imgset",l.aid,k)}else{if(l.bid&&!h[1]){djp.editobj("blog","imgset",l.bid,k)}else{l.alb.compupdate()}}};if(e.alb&&(e.bid||e.aid)){e.alb.add_img(g[0],d,c)}else{alert("Missing entity to add the album to")}}})}b.alb.selimg.show();return b.alb},content_type:function(a){if(!a||typeof(a.match)!="function"){return null}if(a.match(/^text\/xml/i)){return"xml"}if(a.match(/^text\/plain/i)){return"text"}if(a.match(/^text\/html/i)){return"html"}if(a.match(/^application\/json/i)){return"json"}},handlers:{successEO:function(b){var a=b.argument[0];var g=djp.content_type(b.getResponseHeader["content-type"]);switch(g){case null:case"xml":var e=b.responseXML;if(e){e=djp.gebtn(e,"editobj")[0]}var c=djp.gebtn(e,"status");if(c&&c.length){b.sxml=e;b.scode=parseInt(c[0].getAttribute("code"))||0;b.serr=parseInt(c[0].getAttribute("errno"))||0;var h=djp.get_xmlnodeval(c[0],1);b.smsg=h?h:"Edit successful"}break;case"json":var k=$.parseJSON(b.responseText),j=k.editobj;b.json=k.editobj;b.scode=j.success;b.serr=(j.errno==0);b.smsg=j.message;break}if(!isNaN(b.scode)&&b.scode>0){var d=a.tgt;if(typeof d=="string"){d=gebi(d)}if(!b.smsg){b.smsg=b.serr?"Request Failed":"Success"}if(d){d.innerHTML='<div class="good">'+b.smsg+"</div>"}else{if(!a.quiet&&!a.silent){djp.status('<div class="good">'+b.smsg+"</div>")}}if(a.onAfterSave){a.onAfterSave(b)}return true}else{if(a.onSaveFailed){a.onSaveFailed(b)}}if(a.handlers&&a.handlers.failure){a.handlers.failure(b)}else{djp.handlers.failedEO(b)}return false},failedEO:function(e){var c="",b=djp.content_type(e.getResponseHeader["content-type"]);switch(b){case"xml":var d=djp.gebtn(e.responseXML,"status");c=d?djp.get_xmlnodeval(d[0],1):"";break;case"json":c=e.json.message;break;case"text":case"html":c=e.responseText;break}var a=e.argument[0];var g=gebi(a.tgt);c='<div class="bad">'+(c?c:(e.status!=-1?"Request failed":"Request timed out. Check your connection."))+"</div>";if(g){g.innerHTML=c}else{if(!a.silent){djp.status(c)}}if(typeof(a.onAfterFail)=="function"){a.onAfterFail(e)}}},update_social_num:function(a){try{FB.api({method:"links.getStats",urls:a},function(c){if(c&&c.length){var d=c[0].commentsbox_count,e=Dom.getElementsByClassName("social-tab-el")[0];if(e){e.innerHTML=e.innerHTML.replace(/\([0-9]*\)/,"("+d+")")}}})}catch(b){djp.error(b)}},image_upload_mode:function(c){var b=gebi("flash-upload-enabled"),a=gebi("flash-upload-disabled");if(c=="simple"){djp.set_cookie("uploadmode","simple",new Date().getTime()*2);Dom.addClass(b,"invis");Dom.removeClass(a,"invis")}else{djp.delete_cookie("uploadmode");Dom.addClass(a,"invis");Dom.removeClass(b,"invis")}},setup_image_upload:function(d){if(!d){d={}}d=djp.clonecopy({method:"POST",multiple:false},d,1);var h=Dom.get(d.button);Dom.removeClass(h,"invis");var l=Dom.getRegion(h),c=Dom.get(d.container);var g=Dom.getElementBy(function(){return typeof(this.getAttribute)=="function"&&this.getAttribute("img_upl_overlay")});Dom.setStyle(h,"z-index","1");if(!g){g=html2el('<div img_upl_overlay="true" style="position:absolute; z-index:3"></div>')[0];c.insertBefore(g,h)}Dom.setStyle(g,"width",Math.max(10,l.right-l.left)+"px");Dom.setStyle(g,"height",Math.max(6,l.bottom-l.top)+"px");var j=new YAHOO.widget.Uploader(g),b=d.status?gebi(d.status):null;function k(){j.setAllowMultipleFiles(d.multiple);j.setFileFilters([{description:"Images",extensions:"*.jpg;*.jpeg"}]);j.enableFlashUpload=true}var e=function(q){var o="";if(typeof(q)=="object"&&q&&typeof(q.data)=="string"){var m="";if(q.data.length){var n=q.data.split(":");djp.console(n);if(n.length>1){n[0]=parseInt(n[0]);if(isNaN(n[0])||!n[0]){m=(typeof(n[2])=="string")?n[2]:"Failed"}}else{m="Invalid server response"}}if(m){o=m}else{this.num_completed++;o=n[2];if(this.num_completed==this.num_files){o="Upload completed";this.fireEvent("uploadAllComplete")}}}djp.console("after all uploads complete, success: "+this.num_completed+"/"+this.num_files+", status: "+o);if(o&&b){b.innerHTML=o}};var a=function(n){var o=[];for(var m in n.fileList){if(YAHOO.lang.hasOwnProperty(n.fileList,m)){o.push(n.fileList[m].id)}}j.num_files=o.length;j.num_completed=0;j.num_errors=0;j.progress={};if(j.num_files){j.setSimUploadLimit(Math.min(j.num_files,3));j.djUpload=function(q){if(!q){q={}}q=YAHOO.lang.merge({output_mode:"simple"},q);q.djsid=djp.get_cookie("djsid");djp.clonecopy(q,d.data?d.data:{},1);djp.console("upload args",d,q);j.uploadAll(d.action,d.method,q,d.filename)}}};j.createEvent("uploadAllComplete");j.addListener("contentReady",k);j.addListener("fileSelect",a);j.addListener("uploadProgress",function(q){if(q.id){this.progress[q.id]=[q.bytesLoaded,q.bytesTotal];var t=0,o=0,s=0,n=0;for(var r in this.progress){var m=this.progress[r];t+=m[0];o+=m[1];if(m[0]==m[1]){s++}n++}if(b){b.innerHTML=djp.progressbar(t/o)}}});j.addListener("uploadCancel",function(){if(b){b.innerHTML="Upload canceled"}});j.addListener("uploadError",function(){this.num_errors++;djp.console("Upload error",arguments)});j.addListener("uploadCompleteData",function(m){e.call(j,m)});j.addListener("uploadComplete",function(){djp.console("upload complete",arguments)});j.addListener("uploadCancel",function(){djp.console("upload cancel",arguments)});return j},tabs:function(){var l=function(m){setTimeout(function(){djp.scrollTo("comm"+m)},50)};var b=function(n){var m=YAHOO.util.History.getCurrentState("sc");if(m){l(m)}};var h=new YAHOO.widget.TabView("atabs"),e=0;djp.obj_tabs=h;h.get("element").tabView=h;h.subscribe("activeTabChange",function(q){var n=q.newValue,m=this.djlabel(n);switch(m){case"social":break;case"featured":var o=Dom.getElementsBy(function(r){return(r.id&&r.id.match(/^apis-[0-9]+$/))},"td",n.get("contentEl"),function(r){if(r.sched_load_img){setTimeout(function(){r.sched_load_img()},100)}});break;case"revisions":if(!n.djrevatt){n.djrevatt=1;n.subscribe("dataLoadedChange",function(t){if(t.newValue){var s={max:0},r=Dom.getElementBy(function(u){return Dom.hasClass(u,"revisions")},"div",this.get("contentEl"));el=r?Dom.getElementsBy(function(u){return Dom.hasClass(u,"ss")&&Dom.hasClass(u,"pending")},"div",r,function(u){this.max=Math.max(parseInt(u.getAttribute("revid")),this.max)},s,true):null;if(s.max){djp.incrviews("revision",s.max,true)}}})}break}if(n.get("dataSrc")&&!n.get("dataLoaded")){n.set("content",djp.loading_text())}if(!n.skip_dj_comments_jump){djp.scrollTo(n.get("element"));if(YAHOO.util.History.getCurrentState("tab")!=m){if(m=="social"||m=="comments"){djp.set_cookie("comment_stream",m,new Date(new Date().getTime()*2),"/",djp.domain)}YAHOO.util.History.multiNavigate({tab:m,sc:e})}}else{delete (n.skip_dj_comments_jump)}});h.djlabel=function(m){return m.get("labelEl").getAttribute("tabname")};h.djtab=function(m){var o=h.get("tabs");for(var n=0;n<o.length;n++){if(h.djlabel(o[n])==m){return o[n]}}};var k=h.get("tabs");k[0].set("cacheData",true);for(var c=0;c<k.length;c++){var g=k[c],d=h.djlabel(g);if(d&&d!="social"){g.set("cacheData",d!="comments");g.set("dataSrc",djp.replaceinhref({rndint:djp.rndint(),mode:d,frameless:1},0,window.location.href.replace(/#.*$/,"")))}else{if(d=="social"){Dom.addClass(g.get("labelEl"),"social-tab-el")}}}var j=function(o,m){var n=o?h.djtab(o):h.djtab("article");if(n){if(h.get("activeTab")!=n){n.skip_dj_comments_jump=m;h.set("activeTab",n)}else{if(n.get("dataLoaded")&&!m){b()}}}};djp.ajax.history.register("tab",{onstatechange:j,onready:function(){var m=false,n=YAHOO.util.History.getCurrentState("tab");if(!n){n=djp.get_cookie("comment_stream");if(n){m=true}}if(n){j(n,m)}}});djp.ajax.history.register("sc",{onstatechange:function(m){}});var a=String(window.location);if(a.match(/#c[0-9]+/)){djp.htmlFormedEvent.subscribe(function(n,m){if(m){e=m;djp.console("Presetting open tab to comments.",a,n,m);djp.ajax.history.init(function(){h.set("activeTab",h.djtab("comments"))})}},a.replace(/^.*#c([0-9]+)$/,"$1"))}}};djp.initEvent.subscribe(djp.onInit,djp);djp.article=new DJArticle(0,{p:djp}),djp.comment=new DJComment(0,{p:djp}),djp.htmlFormedEvent.subscribe(function(e,g){var d=g.albums,k=g.imgs;var h,j,c;e.htmlFormed=1;for(j=0;j<k.length;j++){h=k[j];e.load_imgs(h[0],h[1])}c={};d.each(function(){options_json=JSON.stringify(this[1]);if(!c[options_json]){c[options_json]=[]}c[options_json].push(this)});for(var m in c){var b=c[m];var a=$(b).map(function(){return this[0]}).get().join(" ");e.load_alb_imgs(a,b[0][1])}$(".body").click(function(n){var o=n.target;if(o&&o.tagName&&o.tagName.toUpperCase()=="A"){var l=o.getAttribute("href")+"";if(l&&typeof(ga_targeting)!="undefined"){ga("send","event","article body click",ga_targeting["page-type"]+":"+ga_targeting["page-obj-id"],$(o).text()+": "+l)}if(l&&l[0]!="/"&&((!l.match(/(http:\/\/([a-z0-9]+\.)?digitaljournal.com|\.\/)/i)||Dom.getAncestorBy(o,function(q){return q.tagName&&q.tagName.toUpperCase()=="DIV"&&q.id&&(q.id=="article_text"||q.id=="blog_text")}))&&!Dom.getAncestorByClassName(o,"rs_skip"))){o.setAttribute("target","_blank")}}})},{albums:djp.postload_albums,imgs:djp.postload_imgs});djp.user={page:djp,cfg:{id:0,email:"",pass:"",perms:{},type_str:"Anonymous",l:{}},login_form_dlg:null,get_id:function(){if(djp.user.is_loggedin()){return this.cfg.id}else{return 0}},has_perm:function(a){return this.cfg.perms[a]?true:false},set_perms:function(d){var b=d.split(",");this.cfg.perms={};for(var c=0;c<b.length;c++){this.cfg.perms[b[c]]=true}},set_perms_grp:function(a){this.cfg.perms_grp=parseInt(a);if(isNaN(this.cfg.perms_grp)){this.cfg.perms_grp=0}},is_admin:function(){return this.is_loggedin()&&this.cfg.perms_grp==4},is_staff:function(){return this.is_loggedin()&&(this.cfg.perms_grp==4||this.cfg.perms_grp==3)},is_cj:function(){return this.is_loggedin()&&(this.cfg.perms_grp==5||this.cfg.perms_grp==6)},load_wcfg:function(s){eval("var load_cfg = { "+s+" }");if(load_cfg.l){djp.clonecopy(this.cfg.l,load_cfg.l)}},save_wcfg:function(j){if(djp.user.is_loggedin()){var a=[];for(var b in this.cfg.l){var q=[];var u=this.cfg.l[b];if(typeof(u.remove)!="string"){var m=[];for(var w in djp.widgets){if(!djp.get_w(w)){m.push(w)}}u.removed=m.join(",")}for(var o in u){if(o.match(/^(removed)$/)){q.push(o+":'"+u[o]+"'");continue}var r=[];for(var e in u[o]){var n=[];var g=u[o][e];for(var d in g){if(!d.match(/^hist_skip_onready$/)&&!d.match(/^(desc|name|js(opt)?c|visible|paused|hide|icon|hasfs|hasopt|hasoptfile|header_opt|fakefs|learnmore|fs(url|txt))$/)){n.push(d+":"+(typeof(g[d])=="string"?"'"+g[d]+"'":g[d]))}}r.push(e+":{"+n.join(",")+"}")}q.push(o+":{"+r.join(",")+"}")}if(q.length){a.push(b+":{"+q.join(",")+"}")}}var v="l:{"+a.join(",")+"}";var h=djp.dce("form");h.method="post";h.action="/edit/user-save_qs-"+djp.user.get_id();var t=djp.dce("input");t.value=v;t.name="data";h.innerHTML='<input type=hidden name="frameless" value="1" />';h.insertBefore(t,h.firstChild);djp.ajax.formSubmit(h,{silent:1,onAfterSave:j,submit_mode:"EO"})}else{if(!djp.get_cookie("warn_savelayout")){alert("You've made a change to the layout. If you want this change permanently saved for the next time you visit, please register or log-in to your account. You'll only see this message once.");djp.set_cookie("warn_savelayout",1,0,"/",djp.domain);if(j){j()}}else{if(j){j()}}}},set_wcfg_prop:function(j,a,b,k,d){var l=j.get_id();var g=j.column?j.column.get_id():0;if(l){if(g){var e=j.column.layout.get_id();if(!this.cfg.l[e]){this.cfg.l[e]={}}var c=this.cfg.l[e];if(!c[g]){c[g]={}}var h=c[g];if(!h[l]){h[l]={}}h[l][a]=b;if(!k){return this.save_wcfg(d)}}else{j.setUrlProp(a,b);if(typeof(j.wcfg[a])!="undefined"){j.wcfg[a]=b}}if(typeof(d)=="function"){d()}}},get_city:function(){return djp.get_cookie("vis_city")},get_cc:function(){return djp.get_cookie("vis_cc")},is_loggedin:function(){return((this.cfg.sid||this.cfg.pass)?true:false)},login:function(g,c,b,a){if(!a){a="user"}var d=djp.domain;strid=g+"";if(strid){var e=new Date(new Date().getTime()*2);if(g){djp.set_cookie(a+"[id]",g,e,"/",d);djp.delete_cookie(a+"[email]","/",d)}if(b){djp.set_cookie(a+"[remember]",1,e,"/",d)}else{djp.delete_cookie(a+"[remember]","/",d)}djp.user.keep_loggedin(a,c)}else{alert("Missing id: "+strid)}if(djp.get_cookie("profile_tab")){djp.delete_cookie("t[profile_tab][sel]","/",d);djp.delete_cookie("profile_tab","/",d)}if(djp.get_cookie("utab")){djp.delete_cookie("t[utab][sel]","/",d);djp.delete_cookie("utab","/",d)}},logout:function(a,b){djp.editobj("user","logout",0,{onAfterSave:function(){djp.gotourl("reload");return}})},disconnect_from_fb:function(){djp.editobj("user","disconnect_facebook",0,{onAfterSave:function(){setTimeout(function(){djp.gotourl("reload")},2000)}})},connect_with_fb:function(){djp.init_fb(function(){djp.FB.connect()})},signup_with_fb:function(){djp.init_fb(function(){djp.FB.initEvent.subscribe(function(){var a=djp.FB,c=a.authResp(true),b=a.st();djp.console("signup with fb",a,b,c);if(b||c){if(c){a.update_user_info(a.register)}else{switch(b.status){case"connected":djp.error("Unable to prefill with Facebook data. Please fill out the form manually");break;default:djp.console("fb state status",b.status);FB.login(function(d){djp.FB.st(d);djp.console("after signup_with_fb:FB.login call",d,djp.FB.authResp());if(djp.FB.authResp()){djp.user.signup_with_fb()}else{djp.error("You need to be signed into Facebook and give Digital Journal all necessary permissions to be able to prefill the sign-up form")}},{perms:djp.fb_permissions||"email,user_birthday"});break}}}})})},login_with_fb:function(c,a,b){djp.console("login_with_fb");c=gebi(c);if(c){c.innerHTML="";djp._loading_text_el=c}else{djp._loading_text_el=null}djp.init_fb(function(){djp.FB.login_dj_user(a,b)})},init_user:function(d){if(!d){d={}}var b=djp,e=this.cfg,a=d.v;if(!a){a="user"}if(!d.id){d.id=b.get_cookie(a+"[id]")}if(!d.id){d.id=e.id}if(!d.email){d.email=b.get_cookie(a+"[email]")}if(!d.pass){d.pass=b.get_cookie(a+"[pass]")}if(!d.sid){d.sid=b.get_cookie("djsid")}djp.clonecopy(e,{id:d.id,email:d.email,pass:d.pass,sid:d.sid,type_str:d.type_str});if(d.perms){this.set_perms(d.perms)}if(d.perm_group){this.set_perms_grp(d.perm_group)}if(d.layouts){this.load_wcfg(d.layouts)}djp.console("init dj user",e)},set_vis_cookies:function(){var a=djp.get_cookie("numvis");a=a?parseInt(a):0;if(!djp.get_cookie("visiting")){a++;djp.set_cookie("numvis",a,new Date(new Date().getTime()*2))}this.num_visits=a;djp.set_cookie("visiting","1",new Date(new Date().getTime()+3600000))},keep_loggedin:function(a,b){if(!this.cfg.pass){this.init_user()}if(!a){a="user"}if(!b){b=this.cfg.pass}if(!b){djp.delete_cookie(a+"[pass]","/",djp.domain)}else{var c=new Date();if(djp.get_cookie(a+"[remember]")){c.setTime(c.getTime()*2)}else{c.setTime(c.getTime()+1800000)}djp.set_cookie(a+"[pass]",b,c,"/",djp.domain)}},validatepe:function(c){var k="";var a=false;var h=gebi("user_pass_1"),e=gebi("user_pass_2"),b=gebi("user_pass_0");if(h.value||e.value){var j=b.value;var g=h.value;var d=e.value;if((g||d)&&g==d&&j){if(g!=d){k="Passwords don't match";a=true}}else{k="To change password you have to enter the current password and then the new password twice";a=true}}if(a&&k){alert(k)}return !a},subscribe:function(d){if(!d){return false}if(!djp.user.is_loggedin()){djp.user.show_login_form({signup:1});return false}var c,b,e;if(d.user){e=d.user;c="user";b=(d.user_blog?"blog":"news")+"_"+(d.chk?"":"un")+"subscribe"}else{if(d.article){e=d.article;c="article";b=(d.chk?"":"un")+"subscribe"}}if(typeof(d.sub_type_id)!="undefined"){djp.editobj("subscriptions",d.chk?"save":"delete",d.sub_id,{vals:{aux_id:d.aux_id?d.aux_id:0,type_id:d.sub_type_id},onAfterSave:d.afs,onAfterFail:d.aff,quiet:1});return true}if(c&&b&&e){djp.editobj(c,b,e,{subscribe_opt:d,onAfterSave:d.afs,onAfterFail:d.aff});return true}return false},show_login_form:function(a){var k=null;if(!a){a={}}if(!this.login_form_dlg){this.login_form_dlg=new DJPanel("login_form_dlg",{width:"450px",fixedcenter:true,visible:false,constraintoviewport:true,modal:true});k=this.login_form_dlg;k.setHeader("Digital Journal Account");var g='<div id="logintabs" class="yui-navset"><ul class="yui-nav"><li class=selected><a href="#login"><em>Log In</em></a></li></ul><div class="yui-content">';g+='<div id="login"></div>';g+="</div></div>";k.setBody(g);k.render(djp.loadtgt());k.tabs=new YAHOO.widget.TabView("logintabs");k.tabs.dlg=k;k.tabs.subscribe("activeTabChange",function(d){this.dlg.center()});var j=gebi("dj-login-form"),h=k.tabs.get("tabs")[1],e=k.tabs.get("tabs")[0],c=j.parentNode;c.parentNode.removeChild(c);e.get("contentEl").appendChild(c);var j=Dom.getElementsBy(function(d){return(d.id=="dj-login-form")},"form",k.body)[0];k._loading_text_el=j.lastChild;j.onsubmit=function(){var d=this.lastChild;d.innerHTML=djp.loading_text();djp.ajax.formSubmit(this,{onAfterSave:function(m){if(djp.qsval("forgetme")){djp.delete_cookie("user[remember]","/",djp.domain)}djp.user.login(djp.get_cookie("user[id]"),djp.get_cookie("user[pass]"),djp.get_cookie("user[remember]"),"user");djp.gotourl("reload")},tgt:d,submit_mode:"EO"});return false};k.afterShowEvent.subscribe(function(m,d){d.focus()},j["user[email]"])}else{k=this.login_form_dlg}var b=djp.FB;if(b&&!a.signup){djp._loading_text_el=k._loading_text_el;b.login_dj_user()}if(k){k.dj_opt=a;var l=gebi("dj-login-form");l["user[fb_uid]"].value=parseInt(a.fb_uid)||0;if(a.hide_fb){Dom.addClass(k.element,"hide_fb")}else{Dom.removeClass(k.element,"hide_fb")}if(a.signup){k.tabs.set("activeTab",k.tabs.get("tabs")[1])}k.show()}},tt_cache:[],tt:function(g,m,d){if(g.usr_tt){g.usr_tt.tt_src=g;return g.usr_tt}d=d||{};d.wopt=d.wopt||{};d.wopt.src_el=g;var q=d.t,c=d.id;if(!q&&g.href){q=g.href.replace(/.*\.(com|local)\/([\w]+).*$/,"$2")}if(!c&&g.href){c=g.href.replace(/^.+\/([0-9]+)\/?.*$/,"$1")}if(!q||!c){djp.console("Missing type or id");return}var b=q+":"+c,n=djp.user.tt_cache[b];if(!n){var k=g.innerHTML,j=g.firstChild;if(j&&typeof(j)=="object"&&j.tagName&&j.tagName.toLowerCase()=="img"){k=j.title}switch(q){case"user":var o={uid:c,u:k,pg:g.getAttribute("pg")};djp.clonecopy(o,d.wopt,1);n=new DJUsrPanel(o);break;case"topic":if(djp.user.is_loggedin()&&djp.user.is_staff()){n=new DJTopicPanel(c,g)}break;case"image":n=new DJImgPanel(c);break;case"image_details":n=new DJImgDetailsPanel(d.image,d.wopt);break;case"userpost":d.wopt=d.wopt||{};var r="",l="<div class=flright>&#187;</div>&nbsp;",h='<a class=vis href="/user/action/article_add" onclick="if(!djp.user.is_loggedin()){ djp.user.show_login_form({signup:1});return false;} else return true;">'+l+'<img src="/images/article.gif" border=0 height=16 width=16 align=absmiddle /> Post news</a>';r+='<a class=vis href="/user/'+djp.user.get_id()+'/blog?tp=1" onclick="if(!djp.user.is_loggedin()){ djp.user.show_login_form({signup:1});return false;} else return true;">'+l+'<img src="/images/blog.gif" border=0 height=16 width=16 align=absmiddle /> Write a blog</a>';r+='<a class=vis href="" onclick="var b=new DJImage();b.upload();return false;">'+l+'<img src="/images/image.gif" border=0 height=16 width=16 align=absmiddle /> Upload images</a>';if(djp.user.is_cj()||djp.user.is_staff()){r=h+r}else{r+=h}d.wopt.contents="<div class='uact'>"+r+"</div>";case"simple":n=new DJSimplePPPanel("simplepanel_"+c,d.wopt);break;case"metadepartment":n=new DJMetaDepPanel(d.wopt);break;case"contact":var a={contact_id:c};djp.clonecopy(a,d.wopt,1);n=new DJContactPanel("contactpanel_"+c,a);break;case"spellchk":n=new DJPPPanel("spellchk_panel_"+c,d.wopt);break;case"help":n=new DJHelpPanel(c);break;default:djp.error("Unknown tooltip type: "+q);return}if(n){if(d.body){n.setBody(d.body)}if(d.header){n.setHeader(d.header)}n.initPP();djp.user.tt_cache[b]=n}if(!m){m=window.event}}g.usr_tt=n;if(n){n.tt_src=g;n.showPP(m,1);Ev.addListener(g,"mouseover",function(u,s){s.showPP(u,1)},n);Ev.addListener(g,"mouseout",function(u,s){s.hidePP()},n)}return n},showAbusive:function(b,a){a=(a?1:0);var d=gebi(b);if(d){if(a){if(Dom.hasClass(d,"abusive")){Dom.addClass(d,"collapsed")}}else{if(!Dom.hasClass(d,"blocked")){Dom.removeClass(d,"collapsed")}}}},block:function(c,b,a,g){var d=null,e=(a?0:1);switch(c){case 2:d=function(h){var j=h.argument[0].customArgs[2];if(typeof(j)=="function"){j.call(h)}};break;case 1:case"blockwriter":d=function(){djp.gotourl("reload")};break;case 0:case"ignore":d=function(q){var h=q.argument[0],n=h.customArgs,m=new RegExp("/user/"+n[0]),r=gebi("cmnts"),j=(r?Dom.getChildrenBy(r,function(t){if(t.id&&t.id.match(/^cmnt_/)){var s=Dom.getElementsByClassName("av","td",t),o;if(s.length){o=Dom.getElementsByClassName("userlink","a",s[0]);if(o.length){return o[0].href.match(m)}}}}):[]);for(var k=0;k<j.length;k++){if(n[1]){Dom.addClass(j[k],"collapsed blocked");var l=Dom.getElementsByClassName("doignore","span",j[k]);if(l.length){l[0].innerHTML="blocked user"}}else{Dom.removeClass(j[k],"collapsed");Dom.removeClass(j[k],"blocked")}}switch(typeof(n[2])){case"string":case"object":if(n[2]){djp.scrollTo(n[2])}break;case"function":n[2].call(q);break}};break}djp.editobj("user","block",djp.user.get_id(),{vals:{block_type:c,block:e,block_id:b},customArgs:[b,e,g],onAfterSave:d})},ignore:function(a,c,b){djp.user.block("ignore",a,!c,b)},spam_add:function(a){return djp.user.spam("add",a)},not_spam:function(a){return djp.user.spam("remove",a)},spam:function(b,a){b+="";a=a||{};switch(b.toLowerCase()){case"add":break;case"remove":break;default:return[1,"Unknown action: "+b]}if(a.obj_id&&a.obj_type){djp.editobj("page","spam","",{onAfterSave:a.onAfterSave||function(){djp.gotourl("reload")},vals:{obj_id:a.obj_id,obj_type:a.obj_type,action:b,report_obj:1}})}else{return[1,"Missing obj_id and/or obj_type"]}},report:function(e){if(!djp.user.is_loggedin()){return}if(!e){e={}}if(!e.cid){e.cid=0}if(!e.aid){e.aid=0}if(!e.iid){e.iid=0}var b="";if(e.cid){b="comment"}else{if(e.gid){b="group"}else{if(e.bid){b="blog"}else{if(e.iid){b="image"}}}}if(b){var a=true;var g="report_"+b;while(a){var c="Enter a brief message to explain";var d=prompt("Are you sure you would like to report this "+b+" to the moderators due to inappropriate content?",c);if(d!=null){if(d!=c){a=false;djp.ajax.grab(djp.replaceinhref({"fd[article_id]":e.aid,"fd[comment_id]":e.cid,"fd[group_id]":e.gid,"fd[blog_id]":e.bid,"fd[image_id]":e.iid,"fd[reason]":djp.encuri(d)},null,"/email.php?frameless=1&action="+g+"&rndint="+djp.rndint()))}else{a=confirm("You have to enter a message to explain why you think this "+b+" is offensive or inappropriate. Would you like to try again?")}}else{a=false}}}},vote:function(d){if(!d||typeof(d)!="object"||!d.id){return}var b=d.sts;var c="";if(typeof(d.onsave)!="function"){d.onsave=function(m){var j=m.argument[0].vtarg;if(!j){j=m.argument[0]}var e=djp.gebtn(m.responseXML,"status");if(e&&e.length){var k=e[0],h=[j.vtel];j.voteopt=j.vtel.voteBtnOpt;if(j.voteopt.sync_with){h.push(gebi(j.voteopt.sync_with))}for(var g=0;g<h.length;g++){h[g].innerHTML=j.t+":"+j.id+":"+k.getAttribute("rating")+":"+k.getAttribute("has_rated");djp.votebtn(h[g],djp.clonecopy(h[g].voteBtnOpt,{showvotes:1},1))}var l=gebi("vst"+j.id);if(l){l.innerHTML=m.smsg}}}}switch(d.t){case"comment":c=d.t;case"image":if(!c){c="img"}case"blog":if(!c){c=d.t}if(djp.user.is_loggedin()){return djp.editobj(c,"vote",d.id,{silent:1,vtarg:d,onAfterSave:d.onsave,vals:{voteval:d.v}})}else{djp.user.show_login_form({signup:1})}break;case"article":var a="/vote/article/"+d.id+"/1/"+djp.encuri(d.v)+"?frameless=1&rnd="+djp.rndint();d.onAfterSave=d.onsave;d.silent=1;return djp.ajax.grab(a,{failure:djp.handlers.failedEO,success:djp.handlers.successEO,argument:[d]});break}return false},successUpdateAlbums:function(d){var b=d.argument[0];var j="";if(d.responseXML){var h=djp.gebtn(d.responseXML,"imgset");var m=djp.user;m.albums={};if(h.length){for(var g=0;g<h.length;g++){var e=djp.clone(b,1);var l=new DJAlbum(h[g],e);m.albums[l.id]=l}}var n;if(b.tgt){n=gebi(b.tgt)}if(n){n.innerHTML="";var k=0;for(var g in m.albums){var l=m.albums[g];n.appendChild(l.to_html({odd:(k++%2==0)}))}}if(b.afs){b.afs(d)}}else{alert("ERROR:"+d.responseHTML)}},panel:null,currentAlbum:null,get_album:function(a){return this.albums[a]},set_current_album:function(a){return this.currentAlbum=a},get_current_album:function(){return this.currentAlbum},update_albums:function(b){if(!b.success){b.success=this.successUpdateAlbums}if(!b.failure){b.failure=function(){}}if(!b.argument){b.argument=[b]}else{b.argument.unshift(b)}var a="/info/type/app/mypics?suba=albums&doauth=1&rndint="+djp.rndint();djp.ajax.grab(a,b)},update_groups:function(b,a){if(!djp.user.groups||a){djp.user.groups=[];djp.getinfo("user","groups",{silent:1,afs:b,onAfterSave:function(g){var e=djp.gebtn(g.responseXML,"userset");for(var c=0;c<e.length;c++){djp.user.groups.push(new DJGroup(e[c]))}var d=g.argument[0].afs;if(typeof(d)=="function"){d(g)}}})}else{if(typeof(f)=="function"){b()}}}};djp.ajax={page:djp,simpleHandler:{success:function(c){var b={};if(c.argument&&c.argument.length){b=c.argument[0]}var a=gebi(b.tgt);if(a){a.innerHTML=c.responseText;b.tgt_el=a}else{if(!b.quiet){djp.status(c.responseText.substring(0,300))}}if(typeof(b.onAfterSave)=="function"){b.onAfterSave(c)}if(typeof(b.afterUpload)=="function"){b.afterUpload(c)}},failure:function(a){if(a.status&&a.status!=-1){djp.error("Request failed ("+a.status+")"+(a.statusText?": "+a.statusText:""))}},timeout:30000,scope:djp},commentHandler:{success:function(a){gebi(a.argument[0].tgt)["c[body]"].value=a.responseText}},_set_callback_from:function(b){var a=this.page.clone(this.simpleHandler,1);if(b){this.page.clonecopy(a,b,1)}return a},grab:function(b,a){a=this._set_callback_from(a);return YAHOO.util.Connect.asyncRequest("GET",b,a)},formSubmit:function(b,a){if(!a){a={}}if(a.submit_mode=="EO"){if(!a.success){a.success=djp.handlers.successEO}if(!a.failure){a.failure=djp.handlers.failedEO}if(!a.argument){a.argument=[a]}}a=this._set_callback_from(a);if(!a.argument){a.argument=[{}]}if(!a.argument[0].form){a.argument[0].form=b}var c=YAHOO.util.Connect;c.setForm(b,(a.upload?true:false));var d=c.asyncRequest(b.method,b.action,a);return d},history:{was_init:false,init_called:false,register:function(c,d){if(!this.was_init){if(!d){d={}}var b=YAHOO.util.History.getBookmarkedState(c);var e;if(d.qsvar){e=YAHOO.util.History.getQueryStringParameter(d.qsvar)}var a=b||e||d.def||"";YAHOO.util.History.register(c,a,d.onstatechange,d.arg,d.argcontext);if(d.onready){this.set_onready(d.onready,d.arg,d.argcontext)}return true}return false},set_onready:function(e,d,c){var g=e||function(){};YAHOO.util.History.onReady(g,d,c)},init:function(d){var c=djp.ajax.history,a=YAHOO.util.History;if(!c.was_init&&!c.init_called){c.init_called=true;try{a.initialize("djajaxfld","djajaxfrm");a.onReady(function(){if(d){d()}c.was_init=true})}catch(b){alert("Failed to init history "+b)}}}}};var dje={editors:[],get:function(a){return this.editors[a]},get_video_id:function(){var b="[a-zA-Z0-9_-]{11}",d=null,a=prompt("Please enter the URL of the YouTube video you want to embed.\nIt will look something like this:\nhttp://www.youtube.com/watch?v=7Xd8wzLG66I"),c=new RegExp(b);if(a){if(a.match(c)){c=new RegExp("^"+b+"$");d=a.replace(new RegExp("^.*youtu(be.com.*\\?.*v=|.be/)("+b+").*$",""),"$2");if(!d.match(c)){d=a}if(!d.match(c)){d=null}}if(!d){djp.error("Cannot find a YouTube video ID in your entry")}}return d},createbuttons:function(c,a){var b="";if(!a){a={}}if(c){b+="<a href=\"\" style='font-weight:bold' onclick=\"try{ dje.braceselectedtxt(gebi('"+c.el.id+"'),'[b]','[/b]'); }catch(err){alert('error: '+err);}return false;\">Bold</a>";b+="<a href=\"\" style='font-style:italic' onclick=\"try{ dje.braceselectedtxt(gebi('"+c.el.id+"'),'[i]','[/i]'); }catch(err){alert('error: '+err);} return false\">Italic</a>";b+="<a href=\"\" onclick=\"try{var u=prompt('Please enter the URL of the page you are linking to.','http://','Enter URL'); if(u){ if(!u.match(/^[a-z]+:/i) && u[0]!='/')u='http://'+u;u=u.replace(/^(http:\\/\\/)+/i,'http://');dje.braceselectedtxt(gebi('"+c.el.id+"'),'[url='+u.replace(/(^\\s+|\\s+$)/g,'')+' t=_blank]','[/url]');} }catch(err){alert('error: '+err);} return false\" style='text-decoration:underline'>Link</a>";b+='<a href="" onclick="try{ dje.braceselectedtxt(gebi(\''+c.el.id+"'),'[quote]','[/quote]'); }catch(err){alert('error: '+err);} return false\">\"Quote\"</a>";if(a.allow_imgs){b+='<a href="" onclick="if(!this.tag)this.tag=new DJSelImgs({picksize:620,onselect: function(imgs,args,es){ dje.braceselectedtxt(gebi(\''+c.el.id+"'),'{image('+imgs[0].id+',center,'+(es?es:'large')+')}','',{allow_notext:1});}});this.tag.show(); return false\"><img src=\"/images/image.gif\" border=0 align=absmiddle title=\"Embed Image\" /></a>"}b+='<a href="" onclick="try{ var video_id=dje.get_video_id();if(video_id){ dje.braceselectedtxt(gebi(\''+c.el.id+"'),'[youtube]'+video_id+'[/youtube]','',{allow_notext:1}); } }catch(err){alert('error: '+err);} return false\"><img src=\"/images/logo_youtube.gif\" align=absmiddle border=0 title=\"Embed YouTube video\" /></a>";if(!a.skip_spell){b+='<a href="" onclick="if(this.tag)djp.spellchk(null,this,{group:this.tag});return false"><img src="/images/spellc.gif" title="Check Spelling" align=absmiddle border=0 /></a>'}}if(b){b="<div class='djeditor'>"+b+"</div>"}return b},gettarget:function(b){var a;if(!b){var b=window.event}if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType==3){a=a.parentNode}return a},braceselectedtxt:function(h,d,j,g){if(!g){g={}}var k="Select text first";if(document.selection){var c=h.scrollTop;h.focus();if(h.selrange){sel=h.selrange}else{sel=document.selection.createRange()}if(!sel.text.length&&!g.allow_notext){alert(k)}else{sel.text=d+sel.text+j}h.focus();setTimeout(function(){h.scrollTop=c},0)}else{if(h.selectionStart||h.selectionStart=="0"){var b=h.selectionStart;var a=h.selectionEnd;if(b==a&&!g.allow_notext){alert(k)}else{var c=h.scrollTop;h.value=h.value.substring(0,b)+d+h.value.substring(b,a)+j+h.value.substring(a,h.value.length);h.focus();h.selectionStart=b;h.selectionEnd=a+j.length+d.length;h.scrollTop=c}}else{h.value+=d+j;h.focus()}}if(h.ichange&&typeof(h.ichange.valchanged)=="function"){h.ichange.valchanged()}},createinstance:function(){var a=new Object();a.el=null;a.id=Math.abs(djp.rndint());this.editors[a.id]=a;return a},attachtoelement:function(e,h,b){e=gebi(e);h=gebi(h);if(!b){b={}}if(!e.djeditor){e.djeditor=this.createinstance()}e.djeditor.el=e;var g=Ev;if(document.selection){var k=function(){this.selrange=document.selection.createRange()};g.addListener(e,"keyup",k);g.addListener(e,"mouseup",k)}if(typeof(b.ichange)=="object"){e.ichange=b.ichange}if(h){h.innerHTML=this.createbuttons(e.djeditor,b)}if(!b.skip_spell){var d=djp.gebtn(h,"a");for(var a=d.length-1;a>=0;a--){var j=d[a];if(j.innerHTML.match(/\/images\/spellc.gif/)){djp.addsplchk(e,{hidelnk:1,ichange:e.ichange});j.tag=e.spl_grp;break}}}}};(function(){var a=function(){this.assignmentClaimed=new YAHOO.util.CustomEvent("assignmentClaimed",this);this.assignmentReleased=new YAHOO.util.CustomEvent("assignmentReleased",this);this.assignmentApproved=new YAHOO.util.CustomEvent("assignmentApproved",this);this.assignmentRejected=new YAHOO.util.CustomEvent("assignmentRejected",this);this.assignmentStatusChanged=new YAHOO.util.CustomEvent("assignmentStatusChanged",this);this.assignmentSaved=new YAHOO.util.CustomEvent("assignmentSaved",this);this.assignmentDeleted=new YAHOO.util.CustomEvent("assignmentDeleted",this)};a.prototype={remove:function(d){var c=this;djp.editobj("assignments","delete",d,{onAfterSave:function(){c.assignmentDeleted.fire(d)}})},save:function(d){var c=this;d.method="POST";d.action="/edit/assignments-save-"+(d["fd[id]"].value?parseInt(d["fd[id]"].value):"");djp.ajax.formSubmit(d,{submit_mode:"EO",form:d,quiet:1,onAfterSave:function(e){c.assignmentSaved.fire(e)}})},parseXML:function(e){var d={},c=e.attributes;for(var g=0;g<c.length;g++){var h=e.getAttribute(c[g].nodeName);if(!h){h=null}else{if(!h.match(/[^0-9.]/)){if(h.match(/\./)){h=parseFloat(h)}else{h=parseInt(h)}}}d[c[g].nodeName]=h}d.title=djp.get_xmlnodeval(djp.gebtn(e,"title")[0],1);d.descr=djp.get_xmlnodeval(djp.gebtn(e,"descr")[0],1);return d},get:function(g,e,c){var d=function(j){var h=[];djp.gebtn(j.responseXML,"djassignment").each(function(l,k){k.push(djp.assignment().parseXML(this))},h);if(typeof(e)=="function"){e.call(j,h)}else{djp.console("loaded without after save function",h)}};c=c||{};vals={what:g};djp.clonecopy(vals,c.vals,1);switch(g){default:djp.getinfo("assignments","get",{quiet:1,vals:vals,onAfterSave:d});break}},claimed:function(d,c){if(c){this.assignmentReleased.fire(d)}else{this.assignmentClaimed.fire(d)}this.assignmentStatusChanged.fire(d)},unclaim:function(d,c){this.claim(d,c,true)},claim:function(h,c,g,e){e=e||{};if(confirm("Are you sure you can publish this assignment by the deadline?"+(e.deadline?"\n\nDeadline is "+e.deadline:""))){var d=this;djp.editobj("assignments",g?"unclaim":"claim",h,{quiet:1,vals:c,onAfterSave:function(){d.claimed(h,g)}})}},rejected:function(c){this.assignmentRejected.fire(c)},approved:function(c){this.assignmentApproved.fire(c)},reject:function(d,c){this.approve(d,c,true)},approve:function(g,e,d){var c=this;djp.editobj("assignments","approve_reject",g,{quiet:1,vals:{aux_id:e,act:d?"rejected":"approved"},onAfterSave:function(){if(d){c.rejected(g)}else{c.approved(g)}}})}};var b=null;djp.assignment=function(){if(!b){b=new a()}return b}})();(function(){var a=function(c){if(c){this.tagify(c)}};a.prototype={tagify:function(c){if(c){switch(c.tagName.toLowerCase()){case"djtag":this.tag(djp.get_xmlnodeval(c,1));this.id(c.getAttribute("id"));break;case"a":this.tag(c.innerHTML);this.id(c.getAttribute("tagid"));break;default:this.tag(c.tag);this.id(c.id)}}},id:function(c){if(typeof(c)=="undefined"){return this._id?this._id:0}else{this._id=parseInt(c)}},tag:function(c){if(typeof(c)=="undefined"){return this._tag?this._tag:""}else{this._tag=c}},url:function(){return"/topic/"+this.tag()},stringify:function(c){c=c||{};return'<a tagid="'+this.id()+'" onmouseover="'+(this.id()?"djp.user.tt(this,event,{ t:'topic',id:this.getAttribute('tagid')})":"")+'" class="tag" title="'+(typeof(c.title)!="undefined"?c.title+"":"Click to remove this tag")+'" href="'+this.url()+'"'+(c.allow_link?"":' onclick="return false;"')+">"+this.tag()+"</a>"},sanitize:function(){this.tag((this.tag()+"").replace(/(^\s+|\s+$)/,""))},valid:function(){var c=this.tag();return(typeof(c)=="string"&&c.length?true:false)},toString:function(){return"TAG{"+this.tag()+"["+this.id()+"]}"}};var b=function(c){this.options=c;this.tagsChanged=new YAHOO.util.CustomEvent("tagsChanged",this);this.init()};b.prototype={fromXMLInEl:function(d){var d=gebi(d),c=this;if(d){djp.gebtn(d,"djtag").each(function(e){c.addTag(new a(this))})}},fromLinksInEl:function(d){var d=gebi(d),c=this;if(d){djp.gebtn(d,"a").each(function(e){c.addTag(new a(this))})}},tgt:function(){return gebi(this.options.tgt)},addTag:function(d){if(!d||typeof(d)!="object"||typeof(d.valid)!="function"){return false}d.sanitize();if(!d.valid()){return false}this.addTagValue("");var e=false,g=d.tag().toLowerCase();this.tags.each(function(){if(this.tag().toLowerCase()==g){e=true;return false}});if(!e){this.tags.push(d);this.tagsChanged.fire();this.layout()}var c=this.input();if(c&&c.focus){c.focus()}return true},removeTag:function(c){var e=false;for(var d=0;d<this.tags.length;d++){if(this.tags[d].tag()==c){this.tags.splice(d,1);e=true;break}}if(e){this.tagsChanged.fire()}this.layout()},tag_strings:function(){var c=[];this.tags.each(function(){c.push(this.tag())});return c},init:function(){this.tags=[];var d=this.tgt(),c=this;Dom.getElementsByClassName("tag","a",d,function(e){c.addTag(new a(e))});d.innerHTML="";d.editor=this;if(!Dom.hasClass(d,"tags")){Dom.addClass(d,"tags")}this.createAddTag();this.layout();if(this.options.xml_container){this.fromXMLInEl(this.options.xml_container)}if(this.options.link_container){this.fromLinksInEl(this.options.link_container)}},layout:function(){var d=this.container(),e=[],c=[],g="&nbsp;&nbsp; ";this.tags.each(function(){c.push(this.tag());e.push(this.stringify())});var j=e.join(g);if(j){j+=g}d.innerHTML=j;var h=Dom.getElementBy(function(k){return k.type&&k.type.toLowerCase()=="hidden"},"input",this.tgt());if(h){h.value=c.join("\n")}},_sugg_cnt:null,_ac_sel_index:-1,_ac_suggestions:[],suggestions:function(m,l){var k=this;if(!l){l=k._ac_suggestions}if(!m){m=k._last_value}var j=[],e=k._ac_sel_index,d=l.length>9?10:l.length;if(e>=d){e=d-1;k._ac_sel_index=e}if(!k._sugg_cnt){var g=html2el("<div class=\"suggestions\" onclick=\"var tags=Dom.getAncestorByClassName(this,'tags');if (tags && tags.editor){ tags.editor.addCurrentSuggestion();tags.editor._sugg_cnt.hidePP();}return false\" onmouseover=\"var tgt=Ev.getTarget(event),tags=Dom.getAncestorByClassName(this,'tags');if (tgt && Dom.hasClass(tgt,'item') && !Dom.hasClass(tgt,'selected') && tgt.tagName && tgt.tagName.toUpperCase()=='DIV' && tags && tags.editor){ tags.editor._ac_sel_index=collection2array(this.children).indexOf(tgt);tags.editor.suggestions();}\"></div>")[0];k._sugg_cnt=new DJSimplePPPanel(g,{width:"200px"});k._sugg_cnt.relativePPEl=function(){return k.input()};k.addTagEl().appendChild(g)}if(this._sugg_cnt){var c=new RegExp("("+m+")","i");for(var h=0;h<d;h++){j.push('<div class="item'+(e==h?" selected":"")+'">'+l[h].tag.replace(c,"<b>$1</b>")+"</div>")}this._sugg_cnt.getEl().innerHTML=j.join("\n");if(l.length){this._sugg_cnt.showPP()}else{this._sugg_cnt.hidePP()}}},container:function(){var c=Dom.getElementsByClassName("tagcontainer","span",this.tgt())[0];if(!c){c=this.createTagContainer()}return c},createTagContainer:function(){var c='<span class="tagcontainer" onclick="var target=Ev.getTarget(event),tags=Dom.getAncestorByClassName(this,\'tags\');if(Dom.hasClass(target,\'tag\') && target.tagName.toUpperCase()==\'A\' && tags && tags.editor){ tags.editor.removeTag(target.innerHTML);if(target.usr_tt) target.usr_tt.hidePP();}return false;"></span><input type="hidden" name="'+(this.options.fld_name||"tags")+'" value=""/>',e=this.tgt(),d=e.firstChild;html2el(c).each(function(){e.insertBefore(this,d)});return e.firstChild},input:function(){var c=Dom.getElementBy(function(d){return d.name=="newtag"},"input",this.tgt());if(typeof(c.length)!="undefined"){if(c.length){return c[0]}}else{if(c){return c}}},addTagValue:function(c){var d=this.input();if(typeof(c)=="undefined"){return d?d.value:undefined}else{if(d){d.value=c}}},_last_value:"",_ac_req:null,_ac_tag:null,_ac_tags:null,abortSuggestions:function(){if(YAHOO.util.Connect.isCallInProgress(this._ac_req)){try{YAHOO.util.Connect.abort(this._ac_req)}catch(c){}}},inputKeyUp:function(g,h){var d=new a();d.tag(g.value);d.sanitize();var c=d.tag();if(this._last_value!=c){if(d.valid()&&c.length>=3){this.abortSuggestions();this._ac_req=djp.getinfo("tags","autocomplete",{quiet:1,vals:{q:c},editor:this,onAfterFail:function(j){var e=j.argument[0].editor},onAfterSave:function(l){var k=l.argument[0].editor,e=l.argument[0].vals.q;var j=[];djp.gebtn(l.responseXML,"djtag").each(function(n){var m=new DJTopic();m.from_xml(this);j.push(m)});k._ac_sel_index=-1;k._ac_suggestions=j;k.suggestions()}})}else{this.suggestions(c,[])}this._last_value=c}},addCurrentSuggestion:function(){if(this._ac_sel_index>=0){var c=this._sugg_cnt.getEl().children[this._ac_sel_index];if(c){this.addTagValue(c.innerHTML.replace(/<b>(.*?)<\/b>/gi,"$1"))}this._ac_suggestions=[]}this.addTagClick()},inputKeyDown:function(d,h){var g=Ev.getCharCode(h),c=true;switch(g){case 188:this.addTagClick();Ev.stopEvent(h);c=false;break;case 13:this.addCurrentSuggestion();Ev.stopEvent(h);c=false;break;case 38:this._ac_sel_index=(this._ac_sel_index>0?this._ac_sel_index-1:0);this.suggestions();break;case 40:this._ac_sel_index++;this.suggestions();break}},createAddTag:function(){var c='<span class="addtag"><input size=12 autocomplete="off" type="text" name="newtag" value="" onkeyup="var tags=Dom.getAncestorByClassName(this,\'tags\');if(tags && tags.editor) tags.editor.inputKeyUp(this,event);" onkeydown="var tags=Dom.getAncestorByClassName(this,\'tags\');if(tags && tags.editor) return tags.editor.inputKeyDown(this,event);"/> <a href="" onclick="var tags=Dom.getAncestorByClassName(this,\'tags\');if(tags && tags.editor) try{ tags.editor.addTagClick();} catch(err){ djp.error(err);}return false;" class="fancy-button">Add a Tag</a></span>';var e=this.tgt(),d=html2el(c)[0];e.appendChild(d)},addTagEl:function(){return Dom.getElementsByClassName("addtag","span",this.tgt())[0]},addTagClick:function(){this.abortSuggestions();var c=new a();c.tag(this.addTagValue());if(!this.addTag(c)){djp.error("Invalid tag")}return false}};djp.TagEditor=b;djp.Tag=a})();window.djp=djp;var kplgin=function(){var b=djp.user;var d="",a=djp.sched_views,c=djp.get_cookie("user[imp]");if(!c){if(a&&!c){djp.sched_views=null;d=a.join(",")}if(b.is_loggedin()){djp.editobj("user","lastvisit",b.get_id(),{silent:1,vals:{addviews:d}});b.keep_loggedin()}else{if(d){djp.editobj("page","addviews","",{silent:1,vals:{addviews:d}})}}}setTimeout(kplgin,180000)};djp.execution_queue=[];var in_queue=function(){var c=false,b=djp.execution_queue;for(var a=0;a<b.length;a++){if(YAHOO.util.Connect.isCallInProgress(b[a])){c=true;break}}return c};Ev.addListener(window,"beforeunload",function(b){var g=djp.last_click,a=(g?(new Date()-g.time<200):-1);if(djp.execution_queue.length){var e=new Date();while(!in_queue()&&new Date()-e<1000){}}if(YAHOO.env.ua.ie){var d=window.__flash__removeCallback;window.__flash__removeCallback=function(h,c){try{d(h,c)}catch(j){}}}});var editMoneypotAmount=function(a,c){var b=$(["Enter moneypot amount (example: 3000)","Enter bonus amount (example: 1000)","Enter how many top users split the bonus (example: 10)"]).map(function(){var d=parseInt(prompt(this,""));if(d){if(!isNaN(d)){return d}}return null}).filter(function(d,e){return e?true:false}).get();if(b.length==3&&confirm("Are you sure you want to change the moneypot to $"+b[0]+", with $"+b[1]+" bonus devided among "+b[2]+" people?")){djp.editobj("moneypot",a?"edit":"save",a,{vals:{amount:b[0],bonus:b[1],num_people:b[2]},onAfterSave:function(d){if(c&&c.onAfterSave){c.onAfterSave(d)}},quiet:1})}else{alert("At least one of the entered values was invalid. Try again.");djp.console(b)}return false};$(function(){var c=$("#header").parent(),b={top:c.offset().top,height:c.height()},a=function(){var d=$(document).scrollTop()-b.top;if(d>=0&&c.css("position")!="fixed"){c.css({position:"fixed",width:"100%",top:0,zIndex:1000});c.parent().css({height:b.height})}else{if(d<0&&c.css("position")!="static"){c.css({position:"static"});c.parent().css({height:"auto"})}}};$(window).on("scroll",a);a()});$(function(){if(typeof(FB)!="undefined"){FB.Event.subscribe("edge.create",function(a){ga("send","social","facebook","like",a)});FB.Event.subscribe("edge.remove",function(a){ga("send","social","facebook","unlike",a)})}if(typeof(twttr)!="undefined"){$(["click","tweet","follow","retweet","favorite"]).each(function(a,b){twttr.events.bind(b,function(c){ga("send","social","twitter",b)})})}if(typeof(twttr)!="undefined"){$(["click","tweet","follow","retweet","favorite"]).each(function(a,b){twttr.events.bind(b,function(c){ga("send","social","twitter",b)})})}});$(function(){var c=null,d=30000,e=0,b=3;var a=function(){setTimeout(function(){if(typeof(ga)=="function"&&c&&new Date().getTime()-c<d){ga("send","event","page","read");e=0}else{e++}if(e<2){a()}},d)};$(window).on("scroll",function(){c=new Date().getTime()});a()});$(function(){var b=window.location.hash;if(b&&b.match(/^#hv[0-9]+$/)&&ga_targeting["article-id"]){var a=parseInt(b.replace("#hv",""));ga("send","event","headline",ga_targeting["article-id"],a)}});